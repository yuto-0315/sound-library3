{"ast":null,"code":"var _jsxFileName = \"/Users/nakataniyuutomo/Desktop/Programing/\\u30BB\\u3099\\u30DF\\u958B\\u767A/sound-library2/src/pages/DAWPage.js\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$(),\n  _s3 = $RefreshSig$(),\n  _s4 = $RefreshSig$();\nimport React, { useState, useRef, useEffect, useCallback } from 'react';\nimport './DAWPage.css';\n\n// DAWの定数\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst BEAT_WIDTH = 100; // 1拍の幅（px）\nconst BEATS_PER_MEASURE = 4; // 1小節あたりの拍数\nconst MEASURE_WIDTH = BEAT_WIDTH * BEATS_PER_MEASURE; // 1小節の幅（400px）\nconst SUB_BEAT_WIDTH = BEAT_WIDTH / 2; // 8分音符の幅（50px）\nconst TOTAL_MEASURES = 16; // 表示する小節数\nconst TOTAL_BEATS = TOTAL_MEASURES * BEATS_PER_MEASURE; // 総拍数\n\n// 時間モードの定数\nconst TIME_MODE_TOTAL_SECONDS = 60; // 表示する総秒数\nconst PIXELS_PER_SECOND = 100; // 1秒あたりのピクセル数\n\nconst DAWPage = () => {\n  _s();\n  // ユニークID生成用のカウンター\n  const trackIdCounterRef = useRef(1);\n  // トラック名の番号管理用カウンター\n  const trackNameCounterRef = useRef(1);\n\n  // LocalStorageからの自動復元機能\n  const loadAutoSavedProject = () => {\n    try {\n      const autoSavedData = localStorage.getItem('dawProjectAutoSave');\n      if (autoSavedData) {\n        const projectData = JSON.parse(autoSavedData);\n\n        // トラックカウンターの復元\n        if (projectData.trackNameCounter) {\n          trackNameCounterRef.current = projectData.trackNameCounter;\n        }\n        if (projectData.trackIdCounter) {\n          trackIdCounterRef.current = projectData.trackIdCounter;\n        }\n\n        // 無効なクリップをフィルタリング\n        const validTracks = (projectData.tracks || []).map(track => ({\n          ...track,\n          clips: (track.clips || []).filter(clip => {\n            if (!clip.soundData || !clip.soundData.name) {\n              console.warn('自動保存データから無効なクリップを除外:', clip);\n              return false;\n            }\n            return true;\n          })\n        }));\n        return {\n          tracks: validTracks.length > 0 ? validTracks : [{\n            id: Date.now(),\n            name: 'トラック 1',\n            clips: []\n          }],\n          bpm: projectData.bpm || 120,\n          isTimeMode: projectData.isTimeMode || false,\n          secondsPerBeat: projectData.secondsPerBeat || 0.5\n        };\n      }\n    } catch (error) {\n      console.error('自動保存データの復元に失敗:', error);\n    }\n    return {\n      tracks: [{\n        id: Date.now(),\n        name: 'トラック 1',\n        clips: []\n      }],\n      bpm: 120,\n      isTimeMode: false,\n      secondsPerBeat: 0.5\n    };\n  };\n  const initialData = loadAutoSavedProject();\n  const [tracks, setTracks] = useState(initialData.tracks);\n  const [bpm, setBpm] = useState(initialData.bpm);\n  const [isPlaying, setIsPlaying] = useState(false);\n  const [currentTime, setCurrentTime] = useState(0);\n  const [audioContext, setAudioContext] = useState(null);\n  const [trackHeight] = useState(80);\n  const [playingAudios, setPlayingAudios] = useState(new Map());\n  const [startPlayTime, setStartPlayTime] = useState(null);\n  const [error, setError] = useState(null);\n  const [sounds, setSounds] = useState([]);\n  const [showSoundPanel, setShowSoundPanel] = useState(true);\n  const [draggedClip, setDraggedClip] = useState(null);\n  const [dragPreview, setDragPreview] = useState(null);\n  const [draggedSoundDuration, setDraggedSoundDuration] = useState(400); // ドラッグ中の音素材の長さ\n  const [dragOffset, setDragOffset] = useState(0); // ドラッグ開始時のクリップ内オフセット\n\n  // 時間モード関連の状態\n  const [isTimeMode, setIsTimeMode] = useState(initialData.isTimeMode); // false: 拍子モード, true: 秒数モード\n  const [secondsPerBeat, setSecondsPerBeat] = useState(initialData.secondsPerBeat); // 秒数モード時の1拍あたりの秒数\n  const [isExporting, setIsExporting] = useState(false); // 音源出力中フラグ\n  const timelineRef = useRef(null);\n  const animationFrameRef = useRef(null);\n  const dragOverTimeoutRef = useRef(null);\n  useEffect(() => {\n    // Web Audio API の初期化\n    const ctx = new (window.AudioContext || window.webkitAudioContext)();\n    setAudioContext(ctx);\n\n    // LocalStorageから音素材を読み込み\n    const savedSounds = JSON.parse(localStorage.getItem('soundRecordings') || '[]');\n\n    // audioDataからBlobを復元\n    const soundsWithBlob = savedSounds.map(sound => {\n      if (sound.audioData) {\n        try {\n          // Base64データの検証\n          if (!sound.audioData.includes(',')) {\n            console.error('無効なBase64フォーマット:', sound.name);\n            return sound;\n          }\n          const base64Data = sound.audioData.split(',')[1];\n          if (!base64Data || base64Data.length === 0) {\n            console.error('Base64データが空です:', sound.name);\n            return sound;\n          }\n          const byteCharacters = atob(base64Data);\n          const byteNumbers = new Array(byteCharacters.length);\n          for (let i = 0; i < byteCharacters.length; i++) {\n            byteNumbers[i] = byteCharacters.charCodeAt(i);\n          }\n          const byteArray = new Uint8Array(byteNumbers);\n\n          // Blobサイズの検証\n          if (byteArray.length === 0) {\n            console.error('Blobデータが空です:', sound.name);\n            return sound;\n          }\n          const blob = new Blob([byteArray], {\n            type: 'audio/wav'\n          });\n\n          // Blobの有効性を確認\n          if (blob.size === 0) {\n            console.error('作成されたBlobのサイズが0です:', sound.name);\n            return sound;\n          }\n          return {\n            ...sound,\n            audioBlob: blob\n          };\n        } catch (error) {\n          console.error('音声データの復元に失敗:', sound.name, error);\n          return sound;\n        }\n      }\n      return sound;\n    });\n\n    // 有効な音素材のみをフィルタリング\n    const validSounds = soundsWithBlob.filter(sound => {\n      if (!sound.audioBlob) {\n        console.warn('audioBlobが存在しない音素材をスキップ:', sound.name);\n        return false;\n      }\n      if (!(sound.audioBlob instanceof Blob)) {\n        console.warn('無効なBlob形式の音素材をスキップ:', sound.name);\n        return false;\n      }\n      if (sound.audioBlob.size === 0) {\n        console.warn('サイズが0のBlob音素材をスキップ:', sound.name);\n        return false;\n      }\n      return true;\n    });\n    setSounds(validSounds);\n\n    // 無効な音素材があった場合はLocalStorageを更新\n    if (validSounds.length !== soundsWithBlob.length) {\n      const validSoundsForStorage = validSounds.map(sound => ({\n        ...sound,\n        audioBlob: undefined // Blobは保存しない\n      }));\n      localStorage.setItem('soundRecordings', JSON.stringify(validSoundsForStorage));\n    }\n    return () => {\n      if (ctx && ctx.state !== 'closed') {\n        ctx.close().catch(error => {\n          console.warn('初期AudioContext のクローズに失敗:', error);\n        });\n      }\n      if (animationFrameRef.current) {\n        cancelAnimationFrame(animationFrameRef.current);\n      }\n      if (dragOverTimeoutRef.current) {\n        clearTimeout(dragOverTimeoutRef.current);\n      }\n      // 再生中の音声をすべて停止・クリーンアップ\n      // useEffect内でplayingAudiosの最新値を取得\n      setPlayingAudios(currentPlayingAudios => {\n        currentPlayingAudios.forEach(({\n          audio,\n          timeoutId,\n          audioUrl\n        }) => {\n          if (timeoutId) {\n            clearTimeout(timeoutId);\n          }\n          if (audio) {\n            audio.pause();\n            audio.src = '';\n          }\n          if (audioUrl) {\n            URL.revokeObjectURL(audioUrl);\n          }\n        });\n        return new Map(); // 空のMapを返す\n      });\n      // グローバル変数をクリーンアップ\n      if (window.currentDraggedSoundBlob) {\n        window.currentDraggedSoundBlob = null;\n      }\n      if (window.currentDraggedSound) {\n        window.currentDraggedSound = null;\n      }\n    };\n  }, []);\n\n  // 音声ファイルの継続時間を取得してピクセル幅に変換\n  const getAudioDuration = useCallback((audioBlob, currentBpm = bpm, currentSecondsPerBeat = secondsPerBeat) => {\n    return new Promise(async resolve => {\n      if (!audioBlob || !(audioBlob instanceof Blob)) {\n        resolve(400);\n        return;\n      }\n\n      // AudioContextを使用した方法を優先\n      if (audioContext) {\n        try {\n          const arrayBuffer = await audioBlob.arrayBuffer();\n          const audioBuffer = await audioContext.decodeAudioData(arrayBuffer);\n          const durationInSeconds = audioBuffer.duration;\n          if (isFinite(durationInSeconds) && durationInSeconds > 0) {\n            let pixelsPerSecond;\n            if (isTimeMode) {\n              // 秒数モード：1拍の秒数に基づいてピクセル/秒を計算\n              const beatWidthInPixels = currentSecondsPerBeat * PIXELS_PER_SECOND;\n              pixelsPerSecond = PIXELS_PER_SECOND;\n            } else {\n              // 拍子モード：BPMベース\n              pixelsPerSecond = currentBpm / 60 * 100;\n            }\n            const widthInPixels = durationInSeconds * pixelsPerSecond;\n            resolve(widthInPixels);\n            return;\n          }\n        } catch (error) {\n          console.error('AudioContext方式でエラー:', error);\n        }\n      }\n      resolve(400);\n    });\n  }, [audioContext, bpm, isTimeMode, secondsPerBeat]);\n\n  // 時間モードとBPMモードを切り替える関数\n  const toggleTimeMode = useCallback(async () => {\n    const newTimeMode = !isTimeMode;\n    setIsTimeMode(newTimeMode);\n\n    // 既存のクリップのdurationを新しいモードで再計算\n    const updatedTracks = await Promise.all(tracks.map(async track => {\n      const updatedClips = await Promise.all(track.clips.map(async clip => {\n        if (clip.soundData && clip.soundData.audioBlob) {\n          try {\n            const arrayBuffer = await clip.soundData.audioBlob.arrayBuffer();\n            const audioBuffer = await audioContext.decodeAudioData(arrayBuffer);\n            const durationInSeconds = audioBuffer.duration;\n            let pixelsPerSecond;\n            if (newTimeMode) {\n              pixelsPerSecond = PIXELS_PER_SECOND;\n            } else {\n              pixelsPerSecond = bpm / 60 * 100;\n            }\n            const newDuration = durationInSeconds * pixelsPerSecond;\n            return {\n              ...clip,\n              duration: newDuration\n            };\n          } catch (error) {\n            console.warn('クリップのduration再計算に失敗:', error);\n            return clip;\n          }\n        }\n        return clip;\n      }));\n      return {\n        ...track,\n        clips: updatedClips\n      };\n    }));\n    setTracks(updatedTracks);\n  }, [isTimeMode, tracks, audioContext, bpm]);\n\n  // 秒数モードでの1拍あたりの秒数を変更する関数\n  const handleSecondsPerBeatChange = useCallback(async newSecondsPerBeat => {\n    setSecondsPerBeat(newSecondsPerBeat);\n\n    // 秒数モードの場合、既存のクリップのdurationを再計算\n    if (isTimeMode) {\n      const updatedTracks = await Promise.all(tracks.map(async track => {\n        const updatedClips = await Promise.all(track.clips.map(async clip => {\n          if (clip.soundData && clip.soundData.audioBlob) {\n            try {\n              const newDuration = await getAudioDuration(clip.soundData.audioBlob, bpm);\n              return {\n                ...clip,\n                duration: newDuration\n              };\n            } catch (error) {\n              console.warn('クリップのduration再計算に失敗:', error);\n              return clip;\n            }\n          }\n          return clip;\n        }));\n        return {\n          ...track,\n          clips: updatedClips\n        };\n      }));\n      setTracks(updatedTracks);\n    }\n  }, [isTimeMode, tracks, getAudioDuration, bpm]);\n\n  // スナップ処理（拍子モード vs 秒数モード）\n  const getSnapPosition = useCallback(position => {\n    if (isTimeMode) {\n      // 秒数モード：1拍（秒数）単位でスナップ\n      const beatWidthInPixels = secondsPerBeat * PIXELS_PER_SECOND;\n      const subBeatWidth = beatWidthInPixels / 2; // 半拍でスナップ\n      return Math.round(position / subBeatWidth) * subBeatWidth;\n    } else {\n      // 拍子モード：8分音符単位でスナップ\n      return Math.round(position / SUB_BEAT_WIDTH) * SUB_BEAT_WIDTH;\n    }\n  }, [isTimeMode, secondsPerBeat]);\n\n  // プレイヘッドのアニメーション更新\n  const updatePlayhead = useCallback(() => {\n    const animate = () => {\n      if (isPlaying && startPlayTime) {\n        const elapsed = (Date.now() - startPlayTime) / 1000; // 経過時間（秒）\n\n        let pixelsPerSecond;\n        if (isTimeMode) {\n          // 秒数モード：直接1秒 = PIXELS_PER_SECONDピクセル\n          pixelsPerSecond = PIXELS_PER_SECOND;\n        } else {\n          // 拍子モード：BPMに基づいたピクセル/秒\n          pixelsPerSecond = bpm / 60 * 100;\n        }\n        const newCurrentTime = elapsed * pixelsPerSecond;\n\n        // 有効な数値かチェック\n        if (isFinite(newCurrentTime) && newCurrentTime >= 0) {\n          setCurrentTime(newCurrentTime);\n        } else {\n          console.warn('無効なcurrentTime:', newCurrentTime, 'elapsed:', elapsed, 'pixelsPerSecond:', pixelsPerSecond);\n        }\n\n        // 次のフレームを要求\n        animationFrameRef.current = requestAnimationFrame(animate);\n      }\n    };\n    if (isPlaying && startPlayTime) {\n      animate();\n    }\n  }, [isPlaying, startPlayTime, bpm, isTimeMode]);\n  useEffect(() => {\n    if (isPlaying) {\n      if (!startPlayTime) {\n        // 再生開始時にstartPlayTimeを設定\n        let pixelsPerSecond;\n        if (isTimeMode) {\n          pixelsPerSecond = PIXELS_PER_SECOND;\n        } else {\n          pixelsPerSecond = bpm / 60 * 100;\n        }\n        if (isFinite(pixelsPerSecond) && pixelsPerSecond > 0) {\n          const timeInSeconds = currentTime / pixelsPerSecond;\n          if (isFinite(timeInSeconds) && timeInSeconds >= 0) {\n            setStartPlayTime(Date.now() - timeInSeconds * 1000);\n          } else {\n            setStartPlayTime(Date.now());\n          }\n        } else {\n          setStartPlayTime(Date.now());\n        }\n      }\n    } else {\n      // 再生停止時にアニメーションをクリア\n      if (animationFrameRef.current) {\n        cancelAnimationFrame(animationFrameRef.current);\n        animationFrameRef.current = null;\n      }\n      setStartPlayTime(null);\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [isPlaying, bpm, currentTime, isTimeMode]);\n\n  // startPlayTimeが設定されたときにアニメーションを開始\n  useEffect(() => {\n    if (isPlaying && startPlayTime) {\n      updatePlayhead();\n    }\n  }, [isPlaying, startPlayTime, updatePlayhead]);\n\n  // BPM変更時のハンドラー\n  const handleBpmChange = useCallback(async newBpm => {\n    setBpm(newBpm);\n\n    // 既存のクリップのdurationを新しいBPMで再計算\n    const updatedTracks = await Promise.all(tracks.map(async track => {\n      const updatedClips = await Promise.all(track.clips.map(async clip => {\n        if (clip.soundData && clip.soundData.audioBlob) {\n          try {\n            const newDuration = await getAudioDuration(clip.soundData.audioBlob, newBpm);\n            return {\n              ...clip,\n              duration: newDuration\n            };\n          } catch (error) {\n            console.warn('クリップのduration更新に失敗:', error);\n            return clip;\n          }\n        }\n        return clip;\n      }));\n      return {\n        ...track,\n        clips: updatedClips\n      };\n    }));\n    setTracks(updatedTracks);\n  }, [tracks, getAudioDuration]);\n\n  // プロジェクト保存機能\n  const saveProject = () => {\n    try {\n      const projectData = {\n        version: '1.0',\n        bpm: bpm,\n        tracks: tracks,\n        sounds: sounds.map(sound => ({\n          ...sound,\n          audioBlob: null,\n          // Blobは別途保存\n          audioData: sound.audioData // base64データを保持\n        })),\n        timestamp: Date.now(),\n        trackNameCounter: trackNameCounterRef.current,\n        trackIdCounter: trackIdCounterRef.current,\n        isTimeMode: isTimeMode,\n        secondsPerBeat: secondsPerBeat\n      };\n      const projectJson = JSON.stringify(projectData, null, 2);\n      const blob = new Blob([projectJson], {\n        type: 'application/json'\n      });\n      const url = URL.createObjectURL(blob);\n      const link = document.createElement('a');\n      link.href = url;\n      link.download = `music-project-${new Date().toISOString().slice(0, 19).replace(/:/g, '-')}.json`;\n      document.body.appendChild(link);\n      link.click();\n      document.body.removeChild(link);\n      URL.revokeObjectURL(url);\n    } catch (error) {\n      console.error('プロジェクト保存エラー:', error);\n      setError('プロジェクトの保存に失敗しました。');\n    }\n  };\n\n  // プロジェクト読み込み機能\n  const loadProject = event => {\n    const file = event.target.files[0];\n    if (!file) return;\n    const reader = new FileReader();\n    reader.onload = e => {\n      try {\n        const projectData = JSON.parse(e.target.result);\n\n        // バージョンチェック\n        if (!projectData.version) {\n          throw new Error('不正なプロジェクトファイルです');\n        }\n\n        // 音声データ復元用のヘルパー関数\n        const restoreAudioBlob = soundData => {\n          if (soundData && soundData.audioData) {\n            try {\n              const byteCharacters = atob(soundData.audioData.split(',')[1]);\n              const byteNumbers = new Array(byteCharacters.length);\n              for (let i = 0; i < byteCharacters.length; i++) {\n                byteNumbers[i] = byteCharacters.charCodeAt(i);\n              }\n              const byteArray = new Uint8Array(byteNumbers);\n              const blob = new Blob([byteArray], {\n                type: 'audio/wav'\n              });\n              return {\n                ...soundData,\n                audioBlob: blob\n              };\n            } catch (error) {\n              console.error('音声データの復元に失敗:', soundData.name || 'unknown', error);\n              return soundData;\n            }\n          }\n          return soundData;\n        };\n\n        // BPMを復元\n        setBpm(projectData.bpm || 120);\n\n        // 時間モード設定を復元\n        setIsTimeMode(projectData.isTimeMode || false);\n        setSecondsPerBeat(projectData.secondsPerBeat || 0.5);\n\n        // トラックを復元（クリップ内の音声データも復元）\n        if (projectData.tracks) {\n          const restoredTracks = projectData.tracks.map(track => ({\n            ...track,\n            clips: track.clips.map(clip => ({\n              ...clip,\n              soundData: restoreAudioBlob(clip.soundData)\n            })).filter(clip => {\n              // 無効なクリップを除外\n              if (!clip.soundData || !clip.soundData.name) {\n                console.warn('無効なクリップを除外:', clip);\n                return false;\n              }\n              return true;\n            })\n          }));\n          setTracks(restoredTracks);\n        }\n\n        // カウンターを復元\n        if (projectData.trackNameCounter) {\n          trackNameCounterRef.current = projectData.trackNameCounter;\n        }\n        if (projectData.trackIdCounter) {\n          trackIdCounterRef.current = projectData.trackIdCounter;\n        }\n\n        // 音素材を復元（既存の音素材に追加）\n        if (projectData.sounds) {\n          const restoredSounds = projectData.sounds.map(sound => restoreAudioBlob(sound));\n\n          // 既存の音素材と読み込んだ音素材を結合\n          setSounds(prevSounds => {\n            const maxId = prevSounds.length > 0 ? Math.max(...prevSounds.map(s => s.id)) : 0;\n            const existingNames = new Set(prevSounds.map(s => s.name));\n            const newSounds = restoredSounds.map((sound, index) => {\n              let newName = sound.name;\n              let counter = 1;\n\n              // 名前の重複をチェックして、重複する場合は番号を付ける\n              while (existingNames.has(newName)) {\n                newName = `${sound.name} (${counter})`;\n                counter++;\n              }\n              existingNames.add(newName);\n              return {\n                ...sound,\n                id: maxId + index + 1,\n                // 新しいIDを割り当て\n                name: newName // 重複しない名前を設定\n              };\n            });\n            return [...prevSounds, ...newSounds];\n          });\n        }\n        setError(null);\n\n        // 読み込み後に自動保存データも更新\n        setTimeout(() => {\n          const autoSaveData = {\n            version: '1.0',\n            bpm: projectData.bpm || 120,\n            tracks: projectData.tracks || [],\n            timestamp: Date.now(),\n            trackNameCounter: projectData.trackNameCounter || 1,\n            trackIdCounter: projectData.trackIdCounter || 1\n          };\n          localStorage.setItem('dawProjectAutoSave', JSON.stringify(autoSaveData));\n        }, 100);\n      } catch (error) {\n        console.error('プロジェクト読み込みエラー:', error);\n        setError('プロジェクトファイルの読み込みに失敗しました。ファイルが正しいか確認してください。');\n      }\n    };\n    reader.readAsText(file);\n    // ファイル選択をリセット\n    event.target.value = '';\n  };\n\n  // 音源出力機能\n  const exportAudio = async () => {\n    if (!audioContext) {\n      setError('AudioContextが初期化されていません。');\n      return;\n    }\n    setIsExporting(true);\n    try {\n      // 全トラックの全クリップの最大終了時間を計算\n      let maxDuration = 0;\n      tracks.forEach(track => {\n        track.clips.forEach(clip => {\n          const pixelsPerSecond = bpm / 60 * 100;\n          const clipStartTimeInSeconds = clip.startTime / pixelsPerSecond;\n          const clipDurationInSeconds = clip.duration / pixelsPerSecond;\n          const clipEndTime = clipStartTimeInSeconds + clipDurationInSeconds;\n          maxDuration = Math.max(maxDuration, clipEndTime);\n        });\n      });\n      if (maxDuration === 0) {\n        setError('出力する音声がありません。音素材を配置してください。');\n        setIsExporting(false);\n        return;\n      }\n\n      // 出力用AudioContextを作成（44.1kHz）\n      const exportContext = new AudioContext({\n        sampleRate: 44100\n      });\n      const bufferLength = Math.ceil(maxDuration * exportContext.sampleRate);\n      const outputBuffer = exportContext.createBuffer(2, bufferLength, exportContext.sampleRate);\n      const leftChannel = outputBuffer.getChannelData(0);\n      const rightChannel = outputBuffer.getChannelData(1);\n\n      // 各トラックの各クリップを処理\n      for (const track of tracks) {\n        for (const clip of track.clips) {\n          if (clip.soundData && clip.soundData.audioBlob) {\n            try {\n              const arrayBuffer = await clip.soundData.audioBlob.arrayBuffer();\n              const audioBuffer = await exportContext.decodeAudioData(arrayBuffer);\n              const pixelsPerSecond = bpm / 60 * 100;\n              const startTimeInSamples = Math.floor(clip.startTime / pixelsPerSecond * exportContext.sampleRate);\n\n              // 音声をミックス\n              for (let channel = 0; channel < Math.min(audioBuffer.numberOfChannels, 2); channel++) {\n                const sourceData = audioBuffer.getChannelData(channel);\n                const targetData = channel === 0 ? leftChannel : rightChannel;\n                for (let i = 0; i < sourceData.length && startTimeInSamples + i < targetData.length; i++) {\n                  targetData[startTimeInSamples + i] += sourceData[i];\n                }\n              }\n\n              // モノラル音源の場合は両チャンネルにコピー\n              if (audioBuffer.numberOfChannels === 1) {\n                const sourceData = audioBuffer.getChannelData(0);\n                for (let i = 0; i < sourceData.length && startTimeInSamples + i < rightChannel.length; i++) {\n                  rightChannel[startTimeInSamples + i] += sourceData[i];\n                }\n              }\n            } catch (error) {\n              console.error('クリップの処理エラー:', error);\n            }\n          }\n        }\n      }\n\n      // WAVファイルとして出力\n      const wavBlob = audioBufferToWav(outputBuffer);\n      const url = URL.createObjectURL(wavBlob);\n      const link = document.createElement('a');\n      link.href = url;\n      link.download = `exported-music-${new Date().toISOString().slice(0, 19).replace(/:/g, '-')}.wav`;\n      document.body.appendChild(link);\n      link.click();\n      document.body.removeChild(link);\n      URL.revokeObjectURL(url);\n      if (exportContext && exportContext.state !== 'closed') {\n        await exportContext.close().catch(error => {\n          console.warn('Export AudioContext のクローズに失敗:', error);\n        });\n      }\n    } catch (error) {\n      console.error('音源出力エラー:', error);\n      setError('音源の出力に失敗しました。');\n    } finally {\n      setIsExporting(false);\n    }\n  };\n\n  // AudioBufferをWAVファイルに変換\n  const audioBufferToWav = buffer => {\n    const length = buffer.length;\n    const numberOfChannels = buffer.numberOfChannels;\n    const sampleRate = buffer.sampleRate;\n    const bytesPerSample = 2;\n    const blockAlign = numberOfChannels * bytesPerSample;\n    const byteRate = sampleRate * blockAlign;\n    const dataSize = length * blockAlign;\n    const bufferSize = 44 + dataSize;\n    const arrayBuffer = new ArrayBuffer(bufferSize);\n    const view = new DataView(arrayBuffer);\n\n    // WAVファイルヘッダー\n    const writeString = (offset, string) => {\n      for (let i = 0; i < string.length; i++) {\n        view.setUint8(offset + i, string.charCodeAt(i));\n      }\n    };\n    writeString(0, 'RIFF');\n    view.setUint32(4, bufferSize - 8, true);\n    writeString(8, 'WAVE');\n    writeString(12, 'fmt ');\n    view.setUint32(16, 16, true);\n    view.setUint16(20, 1, true);\n    view.setUint16(22, numberOfChannels, true);\n    view.setUint32(24, sampleRate, true);\n    view.setUint32(28, byteRate, true);\n    view.setUint16(32, blockAlign, true);\n    view.setUint16(34, bytesPerSample * 8, true);\n    writeString(36, 'data');\n    view.setUint32(40, dataSize, true);\n\n    // 音声データ\n    let offset = 44;\n    for (let i = 0; i < length; i++) {\n      for (let channel = 0; channel < numberOfChannels; channel++) {\n        const sample = buffer.getChannelData(channel)[i];\n        const intSample = Math.max(-1, Math.min(1, sample)) * 0x7FFF;\n        view.setInt16(offset, intSample, true);\n        offset += 2;\n      }\n    }\n    return new Blob([arrayBuffer], {\n      type: 'audio/wav'\n    });\n  };\n  const addTrack = () => {\n    // より確実にユニークなIDを生成\n    trackIdCounterRef.current += 1;\n    const uniqueId = Date.now() + trackIdCounterRef.current;\n\n    // トラック名の番号を増加（削除されても番号は戻らない）\n    trackNameCounterRef.current += 1;\n    const trackName = `トラック ${trackNameCounterRef.current}`;\n    const newTrack = {\n      id: uniqueId,\n      name: trackName,\n      clips: []\n    };\n    setTracks(prevTracks => [...prevTracks, newTrack]);\n  };\n  const removeTrack = trackId => {\n    setTracks(prevTracks => {\n      if (prevTracks.length > 1) {\n        return prevTracks.filter(track => track.id !== trackId);\n      }\n      return prevTracks;\n    });\n  };\n  const handleDrop = async (e, trackId, timePosition) => {\n    e.preventDefault();\n    setDragPreview(null);\n    try {\n      // 既存のクリップの移動かどうかチェック\n      if (draggedClip) {\n        // ドラッグオフセットを考慮した新しい開始位置を計算\n        const adjustedPosition = timePosition - dragOffset;\n        // 拍または秒に合わせて位置を調整\n        const snappedPosition = Math.max(0, getSnapPosition(adjustedPosition));\n\n        // 既存クリップの移動\n        const updatedClip = {\n          ...draggedClip,\n          startTime: snappedPosition,\n          trackId: trackId\n        };\n        setTracks(prevTracks => prevTracks.map(track => {\n          if (track.id === draggedClip.originalTrackId && track.id === trackId) {\n            // 同じトラック内での移動\n            return {\n              ...track,\n              clips: track.clips.map(clip => clip.id === draggedClip.id ? updatedClip : clip)\n            };\n          } else if (track.id === draggedClip.originalTrackId) {\n            // 元のトラックからクリップを削除\n            return {\n              ...track,\n              clips: track.clips.filter(clip => clip.id !== draggedClip.id)\n            };\n          } else if (track.id === trackId) {\n            // 新しいトラックにクリップを追加\n            return {\n              ...track,\n              clips: [...track.clips, updatedClip]\n            };\n          }\n          return track;\n        }));\n        setDraggedClip(null);\n        setDragOffset(0);\n        return;\n      }\n\n      // 新しい音素材の配置\n      let soundData;\n      try {\n        // dataTransferからデータを取得\n        const jsonData = e.dataTransfer ? e.dataTransfer.getData('application/json') : '';\n        if (jsonData) {\n          soundData = JSON.parse(jsonData);\n        } else {\n          // モバイルの場合はグローバル変数から取得\n          soundData = window.currentDraggedSound;\n        }\n      } catch (error) {\n        console.error('ドラッグデータの取得に失敗:', error);\n        soundData = window.currentDraggedSound; // フォールバック\n      }\n      if (!soundData) {\n        console.error('音素材データが見つかりません');\n        setError('音素材データが見つかりません。再度お試しください。');\n        return;\n      }\n\n      // soundDataの必要なプロパティをチェック\n      if (!soundData.name) {\n        console.error('音素材の名前が見つかりません:', soundData);\n        setError('音素材の名前が不正です。再度お試しください。');\n        return;\n      }\n\n      // グローバル変数からaudioBlobを復元\n      if (window.currentDraggedSoundBlob) {\n        soundData.audioBlob = window.currentDraggedSoundBlob;\n        window.currentDraggedSoundBlob = null; // クリーンアップ\n      }\n\n      // グローバル変数をクリア\n      window.currentDraggedSound = null;\n\n      // 音声の実際の継続時間を取得（現在のBPMに基づいて）\n      let duration = 400; // デフォルト値（1小節）\n      if (soundData.audioBlob) {\n        try {\n          duration = await getAudioDuration(soundData.audioBlob, bpm);\n        } catch (error) {\n          console.warn('音声継続時間の取得に失敗しました:', error);\n        }\n      }\n\n      // durationが有効な値かチェック\n      if (!isFinite(duration) || duration <= 0) {\n        console.warn('無効なduration:', duration, 'デフォルト値を使用');\n        duration = 400; // 1小節分\n      }\n\n      // 新しい音素材の場合は通常のスナップ処理\n      const snappedPosition = getSnapPosition(timePosition);\n      const newClip = {\n        id: Date.now() + Math.random(),\n        // より確実にユニークなIDを生成\n        soundData: soundData,\n        startTime: snappedPosition,\n        duration: duration,\n        trackId: trackId\n      };\n\n      // 関数型更新を使用して最新の状態を確実に取得\n      setTracks(prevTracks => {\n        const updatedTracks = prevTracks.map(track => track.id === trackId ? {\n          ...track,\n          clips: [...track.clips, newClip]\n        } : track);\n        return updatedTracks;\n      });\n    } catch (error) {\n      console.error('ドロップエラー:', error);\n      setError('音素材の配置に失敗しました。再度お試しください。');\n    }\n  };\n  const handleDragOver = e => {\n    e.preventDefault();\n\n    // ドラッグされているのが既存クリップか新しい音素材かで処理を分ける\n    if (draggedClip) {\n      e.dataTransfer.dropEffect = 'move';\n    } else {\n      e.dataTransfer.dropEffect = 'copy';\n    }\n\n    // スロットリング - 16ms（60FPS）間隔で実行を制限\n    if (dragOverTimeoutRef.current) {\n      return;\n    }\n\n    // 必要な情報を事前に抽出\n    const clientX = e.clientX;\n    const currentTarget = e.currentTarget;\n    dragOverTimeoutRef.current = setTimeout(() => {\n      dragOverTimeoutRef.current = null;\n      updateDragPreview(clientX, currentTarget);\n    }, 16);\n  };\n  const updateDragPreview = (clientX, trackElement) => {\n    // null チェックを追加\n    if (!trackElement || !timelineRef.current) {\n      return;\n    }\n\n    // 初回ドラッグプレビュー表示時に強制クリーンアップタイマーを設定\n    if (!window.dragCleanupTimer) {\n      window.dragCleanupTimer = setTimeout(() => {\n        cleanupDragState();\n      }, 10000); // 10秒後に強制クリーンアップ\n    }\n    try {\n      // ドラッグプレビューの更新\n      const rect = trackElement.getBoundingClientRect();\n      const timePosition = clientX - rect.left;\n      let snappedPosition;\n      if (draggedClip) {\n        // 既存クリップの場合：ドラッグオフセットを考慮\n        const adjustedPosition = timePosition - dragOffset;\n        snappedPosition = Math.max(0, getSnapPosition(adjustedPosition));\n      } else {\n        // 新しい音素材の場合：通常の処理\n        snappedPosition = getSnapPosition(timePosition);\n      }\n      const trackRect = trackElement.getBoundingClientRect();\n      const tracksAreaRect = timelineRef.current.getBoundingClientRect();\n      if (tracksAreaRect && trackElement.dataset && trackElement.dataset.trackId) {\n        const relativeTop = trackRect.top - tracksAreaRect.top;\n        const trackId = parseInt(trackElement.dataset.trackId);\n\n        // trackIdが有効な数値かチェック\n        if (isNaN(trackId)) {\n          return;\n        }\n\n        // プレビュー幅を決定\n        let previewWidth = 400; // デフォルト値（1小節）\n\n        if (draggedClip) {\n          // 既存クリップの場合\n          previewWidth = isFinite(draggedClip.duration) && draggedClip.duration > 0 ? draggedClip.duration : 400;\n        } else {\n          // 新しい音素材の場合、事前に計算された長さを使用\n          previewWidth = draggedSoundDuration;\n        }\n        setDragPreview({\n          left: snappedPosition,\n          top: relativeTop + 10,\n          width: previewWidth,\n          trackId: trackId\n        });\n      }\n    } catch (error) {\n      console.warn('ドラッグプレビュー更新エラー:', error);\n      // エラーが発生した場合はプレビューをクリア\n      setDragPreview(null);\n    }\n  };\n  const removeClip = (trackId, clipId) => {\n    setTracks(prevTracks => prevTracks.map(track => track.id === trackId ? {\n      ...track,\n      clips: track.clips.filter(clip => clip.id !== clipId)\n    } : track));\n  };\n\n  // クリップのドラッグ開始\n  const handleClipDragStart = (clip, originalTrackId, mouseX, clipElement) => {\n    // クリップ内でのマウス位置のオフセットを計算\n    const clipRect = clipElement.getBoundingClientRect();\n    const offsetInClip = mouseX - clipRect.left;\n    setDraggedClip({\n      ...clip,\n      originalTrackId\n    });\n    setDragOffset(offsetInClip);\n  };\n\n  // ドラッグ状態の完全なクリーンアップ\n  const cleanupDragState = useCallback(() => {\n    // ドラッグオーバーのタイムアウトをクリア\n    if (dragOverTimeoutRef.current) {\n      clearTimeout(dragOverTimeoutRef.current);\n      dragOverTimeoutRef.current = null;\n    }\n\n    // 強制クリーンアップタイマーをクリア\n    if (window.dragCleanupTimer) {\n      clearTimeout(window.dragCleanupTimer);\n      window.dragCleanupTimer = null;\n    }\n\n    // すべてのドラッグ関連の状態をリセット\n    setDraggedClip(null);\n    setDragPreview(null);\n    setDraggedSoundDuration(400);\n    setDragOffset(0);\n\n    // DOM要素のクリーンアップ\n    document.querySelectorAll('.track').forEach(track => {\n      track.classList.remove('drag-over');\n    });\n\n    // モバイル用のドラッグプレビューを削除\n    const mobileDragPreview = document.querySelector('.mobile-drag-preview');\n    if (mobileDragPreview) {\n      mobileDragPreview.remove();\n    }\n\n    // グローバル変数のクリーンアップ\n    if (window.currentDraggedSoundBlob) {\n      window.currentDraggedSoundBlob = null;\n    }\n    if (window.currentDraggedSound) {\n      window.currentDraggedSound = null;\n    }\n\n    // ボディクラスのクリーンアップ\n    document.body.classList.remove('dragging');\n  }, []);\n\n  // コンポーネントマウント時にグローバルコールバックを設定\n  useEffect(() => {\n    window.cleanupDragStateCallback = cleanupDragState;\n\n    // グローバルなドラッグ終了イベントリスナーを追加\n    const handleGlobalDragEnd = () => {\n      cleanupDragState();\n    };\n    const handleGlobalDragLeave = e => {\n      // ドキュメント外にドラッグが出た場合\n      if (!e.relatedTarget || e.relatedTarget.nodeName === 'HTML') {\n        cleanupDragState();\n      }\n    };\n\n    // ドキュメントレベルでイベントリスナーを設定\n    document.addEventListener('dragend', handleGlobalDragEnd);\n    document.addEventListener('dragleave', handleGlobalDragLeave);\n\n    // クリーンアップ関数\n    return () => {\n      if (window.cleanupDragStateCallback === cleanupDragState) {\n        window.cleanupDragStateCallback = null;\n      }\n      document.removeEventListener('dragend', handleGlobalDragEnd);\n      document.removeEventListener('dragleave', handleGlobalDragLeave);\n    };\n  }, [cleanupDragState]);\n\n  // ドラッグ終了時のクリーンアップ\n  const handleDragEnd = e => {\n    // ドロップが正常に処理されなかった場合、元の状態を保持\n    if (draggedClip && e && e.dataTransfer && e.dataTransfer.dropEffect === 'none') {}\n\n    // 完全なクリーンアップ\n    cleanupDragState();\n  };\n  const play = async () => {\n    try {\n      // AudioContextが中断されている場合は再開\n      if (audioContext && audioContext.state === 'suspended') {\n        await audioContext.resume();\n      }\n      setIsPlaying(true);\n\n      // 現在の時間位置に基づいて、再生すべきクリップを見つける\n      let pixelsPerSecond;\n      if (isTimeMode) {\n        pixelsPerSecond = PIXELS_PER_SECOND;\n      } else {\n        pixelsPerSecond = bpm / 60 * 100;\n      }\n      const currentTimeInSeconds = currentTime / pixelsPerSecond;\n\n      // 各トラックのクリップを再生\n      const newPlayingAudios = new Map();\n      tracks.forEach(track => {\n        track.clips.forEach(clip => {\n          // clip.durationが有効な値かチェック\n          if (!isFinite(clip.duration) || clip.duration <= 0) {\n            console.warn('無効なclip.duration:', clip.duration, 'クリップをスキップします');\n            return;\n          }\n          const clipStartTimeInSeconds = clip.startTime / pixelsPerSecond;\n          const clipEndTimeInSeconds = clipStartTimeInSeconds + clip.duration / pixelsPerSecond;\n\n          // 計算結果が有効かチェック\n          if (!isFinite(clipStartTimeInSeconds) || !isFinite(clipEndTimeInSeconds)) {\n            console.warn('無効な時間計算:', {\n              clipStartTimeInSeconds,\n              clipEndTimeInSeconds\n            });\n            return;\n          }\n\n          // 現在の時間位置がクリップの範囲内または今後再生される場合\n          if (clipEndTimeInSeconds > currentTimeInSeconds) {\n            const delay = Math.max(0, clipStartTimeInSeconds - currentTimeInSeconds);\n            if (isFinite(delay) && delay >= 0) {\n              scheduleClipPlayback(clip, delay * 1000, newPlayingAudios);\n            }\n          }\n        });\n      });\n      setPlayingAudios(newPlayingAudios);\n    } catch (error) {\n      console.error('再生エラー:', error);\n      setError('音声の再生に失敗しました。ブラウザで音声が有効になっているか確認してください。');\n    }\n  };\n  const scheduleClipPlayback = (clip, delayMs, playingAudiosMap) => {\n    if (clip.soundData && clip.soundData.audioBlob && clip.soundData.audioBlob instanceof Blob) {\n      try {\n        const audio = new Audio();\n        const audioUrl = URL.createObjectURL(clip.soundData.audioBlob);\n        audio.src = audioUrl;\n        const timeoutId = setTimeout(() => {\n          audio.play().catch(error => {\n            console.error('音声再生エラー:', error);\n            URL.revokeObjectURL(audioUrl); // メモリリークを防ぐ\n          });\n        }, delayMs);\n\n        // 音声終了時にURLを解放\n        audio.addEventListener('ended', () => {\n          URL.revokeObjectURL(audioUrl);\n        });\n        playingAudiosMap.set(clip.id, {\n          audio,\n          timeoutId,\n          audioUrl\n        });\n      } catch (error) {\n        console.error('createObjectURL エラー:', error, 'audioBlob:', clip.soundData.audioBlob);\n      }\n    } else {\n      var _clip$soundData, _clip$soundData2, _clip$soundData3, _clip$soundData4, _clip$soundData5;\n      console.warn('audioBlobが無効です。クリップ情報:', {\n        clipId: clip.id,\n        soundDataName: (_clip$soundData = clip.soundData) === null || _clip$soundData === void 0 ? void 0 : _clip$soundData.name,\n        hasAudioData: !!((_clip$soundData2 = clip.soundData) !== null && _clip$soundData2 !== void 0 && _clip$soundData2.audioData),\n        hasAudioBlob: !!((_clip$soundData3 = clip.soundData) !== null && _clip$soundData3 !== void 0 && _clip$soundData3.audioBlob),\n        audioBlobType: typeof ((_clip$soundData4 = clip.soundData) === null || _clip$soundData4 === void 0 ? void 0 : _clip$soundData4.audioBlob),\n        isInstanceOfBlob: ((_clip$soundData5 = clip.soundData) === null || _clip$soundData5 === void 0 ? void 0 : _clip$soundData5.audioBlob) instanceof Blob\n      });\n\n      // AudioBlobが無効な場合、audioDataから復元を試行\n      if (clip.soundData && clip.soundData.audioData && !clip.soundData.audioBlob) {\n        try {\n          const byteCharacters = atob(clip.soundData.audioData.split(',')[1]);\n          const byteNumbers = new Array(byteCharacters.length);\n          for (let i = 0; i < byteCharacters.length; i++) {\n            byteNumbers[i] = byteCharacters.charCodeAt(i);\n          }\n          const byteArray = new Uint8Array(byteNumbers);\n          const blob = new Blob([byteArray], {\n            type: 'audio/wav'\n          });\n\n          // クリップのsoundDataを更新\n          clip.soundData.audioBlob = blob;\n\n          // 再帰的に再試行\n          scheduleClipPlayback(clip, delayMs, playingAudiosMap);\n          return;\n        } catch (restoreError) {\n          console.error('audioDataからのBlob復元に失敗:', restoreError);\n        }\n      }\n    }\n  };\n  const pause = () => {\n    setIsPlaying(false);\n\n    // 再生中の音声を一時停止\n    playingAudios.forEach(({\n      audio,\n      timeoutId,\n      audioUrl\n    }) => {\n      if (timeoutId) {\n        clearTimeout(timeoutId);\n      }\n      if (!audio.paused) {\n        audio.pause();\n      }\n      // URLを解放\n      if (audioUrl) {\n        URL.revokeObjectURL(audioUrl);\n      }\n    });\n  };\n  const stop = () => {\n    setIsPlaying(false);\n    setCurrentTime(0);\n\n    // 再生中の音声を停止\n    playingAudios.forEach(({\n      audio,\n      timeoutId,\n      audioUrl\n    }) => {\n      if (timeoutId) {\n        clearTimeout(timeoutId);\n      }\n      audio.pause();\n      audio.currentTime = 0;\n      // URLを解放\n      if (audioUrl) {\n        URL.revokeObjectURL(audioUrl);\n      }\n    });\n    setPlayingAudios(new Map());\n  };\n\n  // タイムラインデータの自動保存機能\n  useEffect(() => {\n    const autoSaveProject = () => {\n      try {\n        const projectData = {\n          version: '1.0',\n          bpm: bpm,\n          tracks: tracks,\n          timestamp: Date.now(),\n          trackNameCounter: trackNameCounterRef.current,\n          trackIdCounter: trackIdCounterRef.current,\n          isTimeMode: isTimeMode,\n          secondsPerBeat: secondsPerBeat\n        };\n        localStorage.setItem('dawProjectAutoSave', JSON.stringify(projectData));\n      } catch (error) {\n        console.error('プロジェクトの自動保存に失敗:', error);\n      }\n    };\n\n    // 初期化後の自動保存（tracksやbpmが変更された時）\n    if (tracks.length > 0) {\n      autoSaveProject();\n    }\n  }, [tracks, bpm, isTimeMode, secondsPerBeat]);\n\n  // 音素材の更新監視（他のページで音が追加された場合の対応）\n  useEffect(() => {\n    const handleVisibilityChange = () => {\n      if (!document.hidden) {\n        // ページが表示されたときに音素材を再読み込み\n        const savedSounds = JSON.parse(localStorage.getItem('soundRecordings') || '[]');\n\n        // 音声データ復元処理（既存のロジックを再利用）\n        const soundsWithBlob = savedSounds.map(sound => {\n          if (sound.audioData) {\n            try {\n              const base64Data = sound.audioData.split(',')[1];\n              if (!base64Data || base64Data.length === 0) {\n                return sound;\n              }\n              const byteCharacters = atob(base64Data);\n              const byteNumbers = new Array(byteCharacters.length);\n              for (let i = 0; i < byteCharacters.length; i++) {\n                byteNumbers[i] = byteCharacters.charCodeAt(i);\n              }\n              const byteArray = new Uint8Array(byteNumbers);\n              const blob = new Blob([byteArray], {\n                type: 'audio/wav'\n              });\n              return {\n                ...sound,\n                audioBlob: blob\n              };\n            } catch (error) {\n              console.error('音声データの復元に失敗:', sound.name, error);\n              return sound;\n            }\n          }\n          return sound;\n        });\n        const validSounds = soundsWithBlob.filter(sound => sound.audioBlob && sound.audioBlob instanceof Blob && sound.audioBlob.size > 0);\n        setSounds(validSounds);\n      }\n    };\n    document.addEventListener('visibilitychange', handleVisibilityChange);\n    return () => {\n      document.removeEventListener('visibilitychange', handleVisibilityChange);\n    };\n  }, []);\n\n  // 自動保存データをクリアする機能\n  const clearAutoSave = () => {\n    try {\n      localStorage.removeItem('dawProjectAutoSave');\n\n      // 初期状態にリセット\n      setTracks([{\n        id: Date.now(),\n        name: 'トラック 1',\n        clips: []\n      }]);\n      setBpm(120);\n      trackNameCounterRef.current = 1;\n      trackIdCounterRef.current = 1;\n      setError(null);\n      alert('✅ プロジェクトをリセットしました');\n    } catch (error) {\n      console.error('自動保存データのクリアに失敗:', error);\n      setError('プロジェクトのリセットに失敗しました');\n    }\n  };\n\n  // 無効なクリップを除外する関数\n  const cleanupInvalidClips = () => {\n    setTracks(prevTracks => {\n      const cleanedTracks = prevTracks.map(track => ({\n        ...track,\n        clips: track.clips.filter(clip => {\n          if (!clip.soundData || !clip.soundData.name) {\n            console.warn('無効なクリップを除外:', clip);\n            return false;\n          }\n          return true;\n        })\n      }));\n      const removedCount = prevTracks.reduce((total, track) => total + track.clips.length, 0) - cleanedTracks.reduce((total, track) => total + track.clips.length, 0);\n      if (removedCount > 0) {}\n      return cleanedTracks;\n    });\n  };\n\n  // 初期化時に無効なクリップをクリーンアップ\n  useEffect(() => {\n    const timer = setTimeout(() => {\n      cleanupInvalidClips();\n    }, 1000); // 1秒後に実行\n\n    return () => clearTimeout(timer);\n  }, []);\n\n  // コンポーネントアンマウント時の包括的クリーンアップ\n  useEffect(() => {\n    return () => {\n      // ドラッグ状態のクリーンアップ\n      cleanupDragState();\n\n      // 再生中の音声をすべて停止\n      setPlayingAudios(currentPlayingAudios => {\n        currentPlayingAudios.forEach(({\n          audio,\n          timeoutId,\n          audioUrl\n        }) => {\n          if (timeoutId) {\n            clearTimeout(timeoutId);\n          }\n          if (audio) {\n            audio.pause();\n            audio.src = '';\n          }\n          if (audioUrl) {\n            URL.revokeObjectURL(audioUrl);\n          }\n        });\n        return new Map();\n      });\n\n      // AudioContextをクリーンアップ\n      if (audioContext && audioContext.state !== 'closed') {\n        audioContext.close().catch(error => {\n          console.warn('AudioContext のクローズに失敗:', error);\n        });\n      }\n\n      // アニメーションフレームをクリア\n      if (animationFrameRef.current) {\n        cancelAnimationFrame(animationFrameRef.current);\n      }\n\n      // タイムアウトをクリア\n      if (dragOverTimeoutRef.current) {\n        clearTimeout(dragOverTimeoutRef.current);\n      }\n    };\n  }, [cleanupDragState, audioContext]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"daw-page\",\n    children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n      children: \"\\uD83C\\uDFB9 \\u97F3\\u697D\\u3065\\u304F\\u308A\\u30DA\\u30FC\\u30B8\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 1438,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n      children: \"\\u97F3\\u7D20\\u6750\\u3092\\u30C9\\u30E9\\u30C3\\u30B0&\\u30C9\\u30ED\\u30C3\\u30D7\\u3057\\u3066\\u97F3\\u697D\\u3092\\u4F5C\\u308A\\u307E\\u3057\\u3087\\u3046\\uFF01\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 1439,\n      columnNumber: 7\n    }, this), error && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"error-message\",\n      children: [/*#__PURE__*/_jsxDEV(\"span\", {\n        children: [\"\\u26A0\\uFE0F \", error]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1443,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: () => setError(null),\n        children: \"\\xD7\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1444,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 1442,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"daw-controls card\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"top-controls-row\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"left-controls\",\n          children: /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"button-secondary\",\n            onClick: () => setShowSoundPanel(!showSoundPanel),\n            children: showSoundPanel ? '🎵 音素材を隠す' : '🎵 音素材を表示'\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1452,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1451,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"right-controls\",\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"project-controls\",\n            children: [/*#__PURE__*/_jsxDEV(\"button\", {\n              className: \"button-secondary\",\n              onClick: saveProject,\n              children: \"\\uD83D\\uDCBE \\u30D7\\u30ED\\u30B8\\u30A7\\u30AF\\u30C8\\u4FDD\\u5B58\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1462,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n              className: \"button-secondary file-input-label\",\n              children: [\"\\uD83D\\uDCC1 \\u30D7\\u30ED\\u30B8\\u30A7\\u30AF\\u30C8\\u8AAD\\u307F\\u8FBC\\u307F\", /*#__PURE__*/_jsxDEV(\"input\", {\n                type: \"file\",\n                accept: \".json\",\n                onChange: loadProject,\n                style: {\n                  display: 'none'\n                }\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1467,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1465,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              className: \"button-warning\",\n              onClick: () => {\n                if (window.confirm('🗑️ プロジェクトをリセットしますか？\\n\\n現在の作業内容がすべて削除されます。')) {\n                  clearAutoSave();\n                }\n              },\n              title: \"\\u30D7\\u30ED\\u30B8\\u30A7\\u30AF\\u30C8\\u3092\\u30EA\\u30BB\\u30C3\\u30C8\\uFF08\\u81EA\\u52D5\\u4FDD\\u5B58\\u30C7\\u30FC\\u30BF\\u3082\\u30AF\\u30EA\\u30A2\\uFF09\",\n              children: \"\\uD83D\\uDDD1\\uFE0F \\u30EA\\u30BB\\u30C3\\u30C8\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1474,\n              columnNumber: 13\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              className: \"button-primary\",\n              onClick: exportAudio,\n              disabled: isExporting,\n              children: isExporting ? '🔄 出力中...' : '🎧 音源出力'\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1485,\n              columnNumber: 13\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1461,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1460,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1450,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"bottom-controls-row\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"transport-controls\",\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            className: `transport-btn play-btn ${isPlaying ? 'playing' : ''}`,\n            onClick: isPlaying ? pause : play,\n            children: isPlaying ? '⏸️' : '▶️'\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1499,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"transport-btn stop-btn\",\n            onClick: stop,\n            children: \"\\u23F9\\uFE0F\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1505,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1498,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"timing-controls\",\n          children: [!isTimeMode && /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"bpm-control\",\n            children: [/*#__PURE__*/_jsxDEV(\"label\", {\n              htmlFor: \"bpm\",\n              children: \"\\uD83C\\uDFB5 BPM:\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1513,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n              id: \"bpm\",\n              type: \"number\",\n              value: bpm,\n              onChange: e => handleBpmChange(parseInt(e.target.value)),\n              min: \"60\",\n              max: \"200\",\n              className: \"bpm-input\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1514,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1512,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"time-mode-control\",\n            children: [/*#__PURE__*/_jsxDEV(\"button\", {\n              className: `time-mode-toggle ${isTimeMode ? 'active' : ''}`,\n              onClick: toggleTimeMode,\n              title: isTimeMode ? '拍子モードに切り替え' : '秒数モードに切り替え',\n              children: [\"\\u23F0 \", isTimeMode ? '秒数モード' : '拍子モード']\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1527,\n              columnNumber: 15\n            }, this), isTimeMode && /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"seconds-per-beat-control\",\n              children: [/*#__PURE__*/_jsxDEV(\"label\", {\n                htmlFor: \"secondsPerBeat\",\n                children: \"1\\u62CD:\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1537,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n                id: \"secondsPerBeat\",\n                type: \"number\",\n                value: secondsPerBeat,\n                onChange: e => handleSecondsPerBeatChange(parseFloat(e.target.value)),\n                min: \"0.1\",\n                max: \"5.0\",\n                step: \"0.1\",\n                className: \"seconds-input\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1538,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                children: \"\\u79D2\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1548,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1536,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1526,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1510,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1497,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 1448,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"daw-main-area\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: `sound-panel ${!showSoundPanel ? 'panel-hidden' : ''}`,\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"sound-panel-header\",\n          children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n            children: \"\\uD83C\\uDFB5 \\u97F3\\u7D20\\u6750\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1559,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"sound-panel-close\",\n            onClick: () => setShowSoundPanel(false),\n            title: \"\\u97F3\\u7D20\\u6750\\u30D1\\u30CD\\u30EB\\u3092\\u9589\\u3058\\u308B\",\n            children: \"\\u2715\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1560,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1558,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"sound-list\",\n          children: sounds.length > 0 ? sounds.map(sound => /*#__PURE__*/_jsxDEV(SoundItem, {\n            sound: sound,\n            onDragStart: async sound => {\n              // ドラッグ開始時に音声の長さを計算\n              if (sound.audioBlob) {\n                try {\n                  const duration = await getAudioDuration(sound.audioBlob, bpm);\n                  setDraggedSoundDuration(duration);\n                } catch (error) {\n                  console.warn('ドラッグ時の音声長さ計算に失敗:', error);\n                  setDraggedSoundDuration(400);\n                }\n              } else {\n                setDraggedSoundDuration(400);\n              }\n            }\n          }, sound.id, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1571,\n            columnNumber: 17\n          }, this)) : /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"no-sounds\",\n            children: [/*#__PURE__*/_jsxDEV(\"p\", {\n              children: \"\\u97F3\\u7D20\\u6750\\u304C\\u3042\\u308A\\u307E\\u305B\\u3093\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1592,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n              children: \"\\u300C\\u97F3\\u3042\\u3064\\u3081\\u300D\\u30DA\\u30FC\\u30B8\\u3067\\u97F3\\u3092\\u9332\\u97F3\\u3057\\u3066\\u304F\\u3060\\u3055\\u3044\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1593,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1591,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1568,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1557,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: `daw-workspace ${!showSoundPanel ? 'panel-hidden' : ''}`,\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"track-headers\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"timeline-header-spacer\",\n            children: \"\\u30BF\\u30A4\\u30E0\\u30E9\\u30A4\\u30F3\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1601,\n            columnNumber: 13\n          }, this), tracks.map((track, index) => /*#__PURE__*/_jsxDEV(TrackHeader, {\n            track: track,\n            trackIndex: index,\n            onRemove: removeTrack,\n            trackHeight: trackHeight\n          }, track.id, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1605,\n            columnNumber: 15\n          }, this)), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"track-add-button-container\",\n            style: {\n              height: trackHeight\n            },\n            children: /*#__PURE__*/_jsxDEV(\"button\", {\n              className: \"button-primary track-add-btn\",\n              onClick: addTrack,\n              children: \"\\u2795 \\u30C8\\u30E9\\u30C3\\u30AF\\u8FFD\\u52A0\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1614,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1613,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1600,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"timeline-container\",\n          children: [/*#__PURE__*/_jsxDEV(Timeline, {\n            bpm: bpm,\n            isTimeMode: isTimeMode,\n            secondsPerBeat: secondsPerBeat\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1621,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"tracks-area\",\n            ref: timelineRef,\n            style: {\n              minWidth: isTimeMode ? TIME_MODE_TOTAL_SECONDS * PIXELS_PER_SECOND : TOTAL_MEASURES * MEASURE_WIDTH\n            },\n            children: [/*#__PURE__*/_jsxDEV(Playhead, {\n              currentTime: currentTime\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1631,\n              columnNumber: 15\n            }, this), dragPreview && /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"drag-preview\",\n              style: {\n                left: dragPreview.left,\n                top: dragPreview.top,\n                width: dragPreview.width\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1633,\n              columnNumber: 17\n            }, this), tracks.map(track => /*#__PURE__*/_jsxDEV(Track, {\n              track: track,\n              onDrop: handleDrop,\n              onDragOver: handleDragOver,\n              onRemoveClip: removeClip,\n              onClipDragStart: handleClipDragStart,\n              onDragEnd: handleDragEnd,\n              trackHeight: trackHeight,\n              updateDragPreview: updateDragPreview,\n              isTimeMode: isTimeMode,\n              secondsPerBeat: secondsPerBeat\n            }, track.id, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1643,\n              columnNumber: 17\n            }, this))]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1622,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1620,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1599,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 1556,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"instructions card\",\n      children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n        children: \"\\uD83D\\uDCD6 \\u4F7F\\u3044\\u65B9\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1663,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"ul\", {\n        children: [/*#__PURE__*/_jsxDEV(\"li\", {\n          children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n            children: \"\\uD83D\\uDDA5\\uFE0F PC:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1665,\n            columnNumber: 15\n          }, this), \" \\u5DE6\\u5074\\u306E\\u97F3\\u7D20\\u6750\\u30D1\\u30CD\\u30EB\\u304B\\u3089\\u97F3\\u7D20\\u6750\\u3092\\u30C8\\u30E9\\u30C3\\u30AF\\u306B\\u30C9\\u30E9\\u30C3\\u30B0&\\u30C9\\u30ED\\u30C3\\u30D7\\u3057\\u3066\\u914D\\u7F6E\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1665,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n          children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n            children: \"\\uD83D\\uDCF1 \\u30B9\\u30DE\\u30DB/\\u30BF\\u30D6\\u30EC\\u30C3\\u30C8:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1666,\n            columnNumber: 15\n          }, this), \" \\u97F3\\u7D20\\u6750\\u3092\\u9577\\u62BC\\u3057\\u3057\\u3066\\u304B\\u3089\\u30C8\\u30E9\\u30C3\\u30AF\\u307E\\u3067\\u30C9\\u30E9\\u30C3\\u30B0\\u3057\\u3066\\u914D\\u7F6E\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1666,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n          children: \"\\u914D\\u7F6E\\u6E08\\u307F\\u306E\\u97F3\\u7D20\\u6750\\u3082\\u30C9\\u30E9\\u30C3\\u30B0\\u3057\\u3066\\u5225\\u306E\\u5834\\u6240\\u306B\\u79FB\\u52D5\\u3067\\u304D\\u307E\\u3059\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1667,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n          children: \"\\u30C9\\u30E9\\u30C3\\u30B0\\u4E2D\\u306F\\u914D\\u7F6E\\u4E88\\u5B9A\\u4F4D\\u7F6E\\u306B\\u9752\\u3044\\u5F71\\u304C\\u8868\\u793A\\u3055\\u308C\\u307E\\u3059\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1668,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n          children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n            children: \"\\u23F0 \\u6642\\u9593\\u30E2\\u30FC\\u30C9\\u5207\\u308A\\u66FF\\u3048:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1669,\n            columnNumber: 15\n          }, this), \" \\u300C\\u62CD\\u5B50\\u30E2\\u30FC\\u30C9\\u300D\\u3068\\u300C\\u79D2\\u6570\\u30E2\\u30FC\\u30C9\\u300D\\u3092\\u5207\\u308A\\u66FF\\u3048\\u3067\\u304D\\u307E\\u3059\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1669,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n          children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n            children: \"\\u62CD\\u5B50\\u30E2\\u30FC\\u30C9:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1670,\n            columnNumber: 15\n          }, this), \" 8\\u5206\\u97F3\\u7B26\\uFF08\\u88CF\\u62CD\\u542B\\u3080\\uFF09\\u306B\\u5408\\u308F\\u305B\\u3066\\u97F3\\u7D20\\u6750\\u304C\\u81EA\\u52D5\\u914D\\u7F6E\\u3055\\u308C\\u3001BPM\\u3067\\u901F\\u3055\\u3092\\u8ABF\\u6574\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1670,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n          children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n            children: \"\\u79D2\\u6570\\u30E2\\u30FC\\u30C9:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1671,\n            columnNumber: 15\n          }, this), \" \\u5C0F\\u7BC0\\u3084\\u62CD\\u5B50\\u306E\\u6982\\u5FF5\\u3092\\u306A\\u304F\\u3057\\u3001\\u300C\\u4F55\\u79D2\\u30671\\u62CD\\u300D\\u3068\\u3044\\u3046\\u5358\\u4F4D\\u3067\\u97F3\\u7D20\\u6750\\u3092\\u914D\\u7F6E\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1671,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n          children: \"\\u97F3\\u7D20\\u6750\\u30D1\\u30CD\\u30EB\\u306E\\u25B6\\uFE0F\\u30DC\\u30BF\\u30F3\\u3067\\u500B\\u5225\\u306B\\u97F3\\u3092\\u78BA\\u8A8D\\u3067\\u304D\\u307E\\u3059\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1672,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n          children: \"\\u25B6\\uFE0F\\u30DC\\u30BF\\u30F3\\u3067\\u518D\\u751F\\u3001\\u23F8\\uFE0F\\u30DC\\u30BF\\u30F3\\u3067\\u4E00\\u6642\\u505C\\u6B62\\u3001\\u23F9\\uFE0F\\u30DC\\u30BF\\u30F3\\u3067\\u505C\\u6B62\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1673,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n          children: \"\\u30C8\\u30E9\\u30C3\\u30AF\\u3092\\u8FFD\\u52A0\\u3057\\u3066\\u8907\\u6570\\u306E\\u97F3\\u3092\\u91CD\\u306D\\u308B\\u3053\\u3068\\u304C\\u3067\\u304D\\u307E\\u3059\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1674,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n          children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n            children: \"\\uD83D\\uDCBE \\u30D7\\u30ED\\u30B8\\u30A7\\u30AF\\u30C8\\u4FDD\\u5B58:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1675,\n            columnNumber: 15\n          }, this), \" \\u7DE8\\u96C6\\u4E2D\\u306E\\u30C7\\u30FC\\u30BF\\u3092JSON\\u30D5\\u30A1\\u30A4\\u30EB\\u3068\\u3057\\u3066\\u4FDD\\u5B58\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1675,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n          children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n            children: \"\\uD83D\\uDCC1 \\u30D7\\u30ED\\u30B8\\u30A7\\u30AF\\u30C8\\u8AAD\\u307F\\u8FBC\\u307F:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1676,\n            columnNumber: 15\n          }, this), \" \\u4FDD\\u5B58\\u3057\\u305F\\u30D7\\u30ED\\u30B8\\u30A7\\u30AF\\u30C8\\u30D5\\u30A1\\u30A4\\u30EB\\u3092\\u8AAD\\u307F\\u8FBC\\u3093\\u3067\\u7DE8\\u96C6\\u3092\\u518D\\u958B\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1676,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n          children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n            children: \"\\uD83C\\uDFA7 \\u97F3\\u6E90\\u51FA\\u529B:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1677,\n            columnNumber: 15\n          }, this), \" \\u5B8C\\u6210\\u3057\\u305F\\u697D\\u66F2\\u3092WAV\\u30D5\\u30A1\\u30A4\\u30EB\\u3068\\u3057\\u3066\\u51FA\\u529B\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1677,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n          children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n            children: \"\\uD83D\\uDDD1\\uFE0F \\u30EA\\u30BB\\u30C3\\u30C8:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1678,\n            columnNumber: 15\n          }, this), \" \\u73FE\\u5728\\u306E\\u30D7\\u30ED\\u30B8\\u30A7\\u30AF\\u30C8\\u3092\\u30EA\\u30BB\\u30C3\\u30C8\\u3057\\u3066\\u65B0\\u3057\\u304F\\u59CB\\u3081\\u308B\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1678,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1664,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"auto-save-info\",\n        children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n          children: \"\\uD83D\\uDCBE \\u81EA\\u52D5\\u4FDD\\u5B58\\u6A5F\\u80FD\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1681,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"ul\", {\n          children: [/*#__PURE__*/_jsxDEV(\"li\", {\n            children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n              children: \"\\u81EA\\u52D5\\u4FDD\\u5B58:\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1683,\n              columnNumber: 17\n            }, this), \" \\u30C8\\u30E9\\u30C3\\u30AF\\u3001BPM\\u3001\\u6642\\u9593\\u30E2\\u30FC\\u30C9\\u8A2D\\u5B9A\\u306E\\u5909\\u66F4\\u306F\\u81EA\\u52D5\\u7684\\u306B\\u4FDD\\u5B58\\u3055\\u308C\\u307E\\u3059\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1683,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n            children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n              children: \"\\u4ED6\\u30DA\\u30FC\\u30B8\\u3068\\u306E\\u9023\\u643A:\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1684,\n              columnNumber: 17\n            }, this), \" \\u300C\\u97F3\\u3042\\u3064\\u3081\\u300D\\u30DA\\u30FC\\u30B8\\u3067\\u9332\\u97F3\\u3057\\u305F\\u97F3\\u306F\\u81EA\\u52D5\\u7684\\u306B\\u53CD\\u6620\\u3055\\u308C\\u307E\\u3059\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1684,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n            children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n              children: \"\\u5FA9\\u5143\\u6A5F\\u80FD:\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1685,\n              columnNumber: 17\n            }, this), \" \\u30DA\\u30FC\\u30B8\\u3092\\u30EA\\u30ED\\u30FC\\u30C9\\u3057\\u3066\\u3082\\u4F5C\\u696D\\u5185\\u5BB9\\u304C\\u81EA\\u52D5\\u7684\\u306B\\u5FA9\\u5143\\u3055\\u308C\\u307E\\u3059\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1685,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n            children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n              children: \"\\u5B89\\u5FC3\\u3057\\u3066\\u79FB\\u52D5:\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1686,\n              columnNumber: 17\n            }, this), \" \\u4ED6\\u306E\\u30DA\\u30FC\\u30B8\\u306B\\u79FB\\u52D5\\u3057\\u3066\\u3082\\u4F5C\\u696D\\u5185\\u5BB9\\u306F\\u4FDD\\u6301\\u3055\\u308C\\u307E\\u3059\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1686,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1682,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1680,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"mobile-tips\",\n        children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n          children: \"\\uD83D\\uDCF1 \\u30B9\\u30DE\\u30FC\\u30C8\\u30D5\\u30A9\\u30F3\\u5229\\u7528\\u306E\\u30B3\\u30C4\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1690,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"ul\", {\n          children: [/*#__PURE__*/_jsxDEV(\"li\", {\n            children: \"\\u97F3\\u7D20\\u6750\\u3092\\u8EFD\\u304F\\u9577\\u62BC\\u3057\\u3059\\u308B\\u3068\\u30C9\\u30E9\\u30C3\\u30B0\\u30E2\\u30FC\\u30C9\\u306B\\u306A\\u308A\\u307E\\u3059\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1692,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n            children: \"\\u30C9\\u30E9\\u30C3\\u30B0\\u4E2D\\u306F\\u753B\\u9762\\u304C\\u30B9\\u30AF\\u30ED\\u30FC\\u30EB\\u3057\\u306A\\u3044\\u3088\\u3046\\u5236\\u5FA1\\u3055\\u308C\\u307E\\u3059\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1693,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n            children: \"\\u9752\\u304F\\u30CF\\u30A4\\u30E9\\u30A4\\u30C8\\u3055\\u308C\\u305F\\u30C8\\u30E9\\u30C3\\u30AF\\u3067\\u6307\\u3092\\u96E2\\u3059\\u3068\\u97F3\\u7D20\\u6750\\u304C\\u914D\\u7F6E\\u3055\\u308C\\u307E\\u3059\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1694,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n            children: \"\\u6A2A\\u753B\\u9762\\u8868\\u793A\\u306B\\u3059\\u308B\\u3068\\u3088\\u308A\\u4F7F\\u3044\\u3084\\u3059\\u304F\\u306A\\u308A\\u307E\\u3059\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1695,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1691,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1689,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 1662,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 1437,\n    columnNumber: 5\n  }, this);\n};\n_s(DAWPage, \"nsGHaI1M6/aYoYlz37fycSKLP8M=\");\n_c = DAWPage;\nconst SoundItem = ({\n  sound,\n  onDragStart\n}) => {\n  _s2();\n  const [isPlaying, setIsPlaying] = useState(false);\n  const [isDragging, setIsDragging] = useState(false);\n  const [touchStart, setTouchStart] = useState(null);\n  const [touchMove, setTouchMove] = useState(null);\n  const handleDragStart = e => {\n    // audioBlob以外のデータをJSON文字列として設定\n    const soundDataForTransfer = {\n      ...sound,\n      audioBlob: null // Blobは直接シリアライズできないため一時的にnullに\n    };\n    e.dataTransfer.setData('application/json', JSON.stringify(soundDataForTransfer));\n    e.dataTransfer.effectAllowed = 'copy';\n\n    // 実際のaudioBlobは別途グローバル変数で保持\n    window.currentDraggedSoundBlob = sound.audioBlob;\n\n    // 親コンポーネントのonDragStart関数を呼び出し（音声の長さを計算）\n    if (onDragStart) {\n      onDragStart(sound);\n    }\n  };\n\n  // タッチイベント対応\n  const handleTouchStart = e => {\n    const touch = e.touches[0];\n    setTouchStart({\n      x: touch.clientX,\n      y: touch.clientY\n    });\n    setIsDragging(false);\n\n    // 長押し判定用のタイマーは設定せず、移動検知でのみドラッグを開始\n  };\n  const handleTouchMove = e => {\n    if (!touchStart) return;\n    const touch = e.touches[0];\n    const currentPos = {\n      x: touch.clientX,\n      y: touch.clientY\n    };\n    setTouchMove(currentPos);\n\n    // ドラッグ開始の判定（15px以上移動）- 閾値を上げてより意図的な移動のみドラッグ扱い\n    const deltaX = Math.abs(currentPos.x - touchStart.x);\n    const deltaY = Math.abs(currentPos.y - touchStart.y);\n    if (!isDragging && (deltaX > 15 || deltaY > 15)) {\n      setIsDragging(true);\n      // スクロールを一時的に無効化（移動が確定してから）\n      document.body.classList.add('dragging');\n\n      // 親コンポーネントのonDragStart関数を呼び出し\n      if (onDragStart) {\n        onDragStart(sound);\n      }\n      // グローバル変数に設定\n      window.currentDraggedSoundBlob = sound.audioBlob;\n      window.currentDraggedSound = sound;\n    }\n    if (isDragging) {\n      // passiveイベントではpreventDefaultが使えないので、代わりにtouchActionでスクロールを制御\n\n      // ドラッグプレビューの位置を更新\n      const dragPreview = document.querySelector('.mobile-drag-preview');\n      if (dragPreview) {\n        dragPreview.style.left = `${currentPos.x - 50}px`;\n        dragPreview.style.top = `${currentPos.y - 20}px`;\n      }\n\n      // ドロップターゲットのハイライト\n      const elementBelow = document.elementFromPoint(currentPos.x, currentPos.y);\n      const trackElement = elementBelow === null || elementBelow === void 0 ? void 0 : elementBelow.closest('.track');\n\n      // 既存のハイライトを削除\n      document.querySelectorAll('.track').forEach(track => {\n        track.classList.remove('drag-over');\n      });\n\n      // 新しいハイライトを追加\n      if (trackElement) {\n        trackElement.classList.add('drag-over');\n      }\n    }\n  };\n  const handleTouchEnd = e => {\n    if (isDragging && touchMove) {\n      // ドロップ処理\n      const elementBelow = document.elementFromPoint(touchMove.x, touchMove.y);\n      const trackElement = elementBelow === null || elementBelow === void 0 ? void 0 : elementBelow.closest('.track');\n      if (trackElement) {\n        const trackId = parseInt(trackElement.dataset.trackId);\n        const rect = trackElement.getBoundingClientRect();\n        const timePosition = touchMove.x - rect.left;\n\n        // ドロップイベントを発火\n        const dropEvent = new CustomEvent('mobileDrop', {\n          detail: {\n            trackId,\n            timePosition,\n            sound: sound\n          }\n        });\n        trackElement.dispatchEvent(dropEvent);\n      }\n    }\n\n    // クリーンアップ\n    setTouchStart(null);\n    setTouchMove(null);\n    setIsDragging(false);\n\n    // SoundItem 内での直接クリーンアップ\n    document.body.classList.remove('dragging');\n\n    // ハイライトを削除\n    document.querySelectorAll('.track').forEach(track => {\n      track.classList.remove('drag-over');\n    });\n\n    // モバイル用のドラッグプレビューを削除\n    const mobileDragPreview = document.querySelector('.mobile-drag-preview');\n    if (mobileDragPreview) {\n      mobileDragPreview.remove();\n    }\n\n    // グローバル変数をクリア\n    if (window.currentDraggedSoundBlob) {\n      window.currentDraggedSoundBlob = null;\n    }\n    if (window.currentDraggedSound) {\n      window.currentDraggedSound = null;\n    }\n  };\n  const playSound = () => {\n    if (sound.audioBlob && !isPlaying && !isDragging) {\n      // Blobの有効性をチェック\n      if (!(sound.audioBlob instanceof Blob) || sound.audioBlob.size === 0) {\n        var _sound$audioBlob;\n        console.error('無効なaudioBlob:', {\n          name: sound.name,\n          isBlob: sound.audioBlob instanceof Blob,\n          size: (_sound$audioBlob = sound.audioBlob) === null || _sound$audioBlob === void 0 ? void 0 : _sound$audioBlob.size\n        });\n        return;\n      }\n      const audio = new Audio();\n      let audioUrl;\n      try {\n        audioUrl = URL.createObjectURL(sound.audioBlob);\n        audio.src = audioUrl;\n        audio.play().then(() => {\n          setIsPlaying(true);\n          const handleEnded = () => {\n            setIsPlaying(false);\n            if (audioUrl) {\n              URL.revokeObjectURL(audioUrl); // URLをクリーンアップ\n            }\n            audio.removeEventListener('ended', handleEnded);\n          };\n          audio.addEventListener('ended', handleEnded);\n\n          // 音声の読み込みエラーもハンドリング\n          audio.addEventListener('error', error => {\n            console.error('音声読み込みエラー:', error);\n            setIsPlaying(false);\n            if (audioUrl) {\n              URL.revokeObjectURL(audioUrl);\n            }\n          });\n        }).catch(error => {\n          console.error('音声再生エラー:', error);\n          if (audioUrl) {\n            URL.revokeObjectURL(audioUrl); // エラー時もクリーンアップ\n          }\n          setIsPlaying(false);\n        });\n      } catch (error) {\n        console.error('createObjectURLエラー:', error);\n        setIsPlaying(false);\n      }\n    } else {\n      console.error('再生条件不満足:', {\n        hasAudioBlob: !!sound.audioBlob,\n        isPlaying,\n        isDragging\n      });\n    }\n  };\n\n  // ドラッグプレビューを作成\n  const createDragPreview = useCallback(() => {\n    if (isDragging && touchMove) {\n      let dragPreview = document.querySelector('.mobile-drag-preview');\n      if (!dragPreview) {\n        dragPreview = document.createElement('div');\n        dragPreview.className = 'mobile-drag-preview';\n        dragPreview.textContent = sound.name;\n        dragPreview.style.cssText = `\n          position: fixed;\n          background: rgba(0, 123, 255, 0.8);\n          color: white;\n          padding: 5px 10px;\n          border-radius: 4px;\n          font-size: 12px;\n          pointer-events: none;\n          z-index: 1000;\n          left: ${touchMove.x - 50}px;\n          top: ${touchMove.y - 20}px;\n        `;\n        document.body.appendChild(dragPreview);\n      }\n    }\n  }, [isDragging, touchMove, sound.name]);\n\n  // ドラッグプレビューの更新\n  React.useEffect(() => {\n    if (isDragging) {\n      createDragPreview();\n    }\n  }, [isDragging, touchMove, createDragPreview]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: `sound-item ${isDragging ? 'dragging' : ''}`,\n    draggable: \"true\",\n    onDragStart: handleDragStart,\n    onTouchStart: handleTouchStart,\n    onTouchMove: handleTouchMove,\n    onTouchEnd: handleTouchEnd,\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"sound-info\",\n      children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n        children: sound.name\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1943,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"sound-tags\",\n        children: sound.tags.map((tag, index) => /*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"sound-tag\",\n          children: tag\n        }, index, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1946,\n          columnNumber: 13\n        }, this))\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1944,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 1942,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"sound-actions\",\n      children: /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"play-sound-btn\",\n        onClick: playSound,\n        disabled: isPlaying,\n        children: isPlaying ? '⏸️' : '▶️'\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1951,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 1950,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 1934,\n    columnNumber: 5\n  }, this);\n};\n_s2(SoundItem, \"RkxO1xburwD1wlHDqN3nCO+JHik=\");\n_c2 = SoundItem;\nconst TrackHeader = ({\n  track,\n  onRemove,\n  trackHeight,\n  trackIndex\n}) => {\n  // トラック名を表示番号と元の名前で構成\n  const displayName = `トラック ${trackIndex + 1}`;\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"track-header\",\n    style: {\n      height: trackHeight\n    },\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"track-info\",\n      children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n        children: displayName\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1970,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"track-actions\",\n        children: /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"remove-track-btn\",\n          onClick: () => onRemove(track.id),\n          title: `${displayName}を削除`,\n          \"aria-label\": `${displayName}を削除`,\n          children: \"\\uD83D\\uDDD1\\uFE0F\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1972,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1971,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 1969,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 1968,\n    columnNumber: 5\n  }, this);\n};\n_c3 = TrackHeader;\nconst Timeline = ({\n  bpm,\n  isTimeMode,\n  secondsPerBeat\n}) => {\n  if (isTimeMode) {\n    // 秒数モード: 秒単位で表示\n    const totalSeconds = TIME_MODE_TOTAL_SECONDS;\n    const secondWidth = PIXELS_PER_SECOND;\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"timeline\",\n      style: {\n        minWidth: totalSeconds * secondWidth\n      },\n      children: Array.from({\n        length: totalSeconds / 5\n      }, (_, intervalIndex) => /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"time-interval\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"time-number\",\n          children: [intervalIndex * 5, \"\\u79D2\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1996,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"time-marks\",\n          children: Array.from({\n            length: 5\n          }, (_, secondIndex) => /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"time-mark\",\n            style: {\n              width: secondWidth\n            },\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"time-main\",\n              children: intervalIndex * 5 + secondIndex\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 2004,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"time-sub\",\n              children: /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"sub-time-marker\",\n                children: \"\\u30FB\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 2008,\n                columnNumber: 21\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 2007,\n              columnNumber: 19\n            }, this)]\n          }, secondIndex, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1999,\n            columnNumber: 17\n          }, this))\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1997,\n          columnNumber: 13\n        }, this)]\n      }, intervalIndex, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1995,\n        columnNumber: 11\n      }, this))\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 1993,\n      columnNumber: 7\n    }, this);\n  } else {\n    // 拍子モード: 従来の小節・拍表示\n    const measures = TOTAL_MEASURES; // 16小節表示\n    const beatsPerMeasure = BEATS_PER_MEASURE; // 4/4拍子\n\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"timeline\",\n      style: {\n        minWidth: TOTAL_MEASURES * MEASURE_WIDTH\n      },\n      children: Array.from({\n        length: measures\n      }, (_, measureIndex) => /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"measure\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"measure-number\",\n          children: measureIndex + 1\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 2026,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"beats\",\n          children: Array.from({\n            length: beatsPerMeasure\n          }, (_, beatIndex) => /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"beat\",\n            style: {\n              width: BEAT_WIDTH\n            },\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"beat-main\",\n              children: beatIndex + 1\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 2034,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"beat-sub\",\n              children: /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"sub-beat-marker\",\n                children: \"\\u30FB\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 2038,\n                columnNumber: 21\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 2037,\n              columnNumber: 19\n            }, this)]\n          }, beatIndex, true, {\n            fileName: _jsxFileName,\n            lineNumber: 2029,\n            columnNumber: 17\n          }, this))\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 2027,\n          columnNumber: 13\n        }, this)]\n      }, measureIndex, true, {\n        fileName: _jsxFileName,\n        lineNumber: 2025,\n        columnNumber: 11\n      }, this))\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 2023,\n      columnNumber: 7\n    }, this);\n  }\n};\n_c4 = Timeline;\nconst Track = ({\n  track,\n  onDrop,\n  onDragOver,\n  onRemoveClip,\n  onClipDragStart,\n  onDragEnd,\n  trackHeight,\n  updateDragPreview,\n  isTimeMode,\n  secondsPerBeat\n}) => {\n  _s3();\n  const handleDrop = e => {\n    const rect = e.currentTarget.getBoundingClientRect();\n    const timePosition = e.clientX - rect.left;\n    onDrop(e, track.id, timePosition);\n  };\n\n  // モバイルドロップイベントの処理\n  const handleMobileDrop = useCallback(e => {\n    const {\n      trackId,\n      timePosition,\n      sound\n    } = e.detail;\n\n    // 模擬的なドロップイベントを作成\n    const mockDropEvent = {\n      preventDefault: () => {},\n      dataTransfer: {\n        getData: type => {\n          if (type === 'application/json') {\n            return JSON.stringify(sound);\n          }\n          return '';\n        }\n      }\n    };\n    onDrop(mockDropEvent, trackId, timePosition);\n  }, [onDrop]);\n\n  // モバイルクリップ移動イベントの処理\n  const handleMobileClipMove = useCallback(e => {\n    const {\n      clip,\n      newTrackId,\n      timePosition\n    } = e.detail;\n\n    // 模擬的なドロップイベントを作成\n    const mockDropEvent = {\n      preventDefault: () => {},\n      dataTransfer: {\n        getData: type => {\n          if (type === 'text/plain') {\n            return `existing-clip-${clip.id}`;\n          }\n          return '';\n        }\n      }\n    };\n    onDrop(mockDropEvent, newTrackId, timePosition);\n  }, [onDrop]);\n  const handleUpdateDragPreview = useCallback(e => {\n    const {\n      clientX,\n      trackElement\n    } = e.detail;\n    // 親コンポーネントのupdateDragPreview関数を呼び出し\n    if (typeof updateDragPreview === 'function') {\n      updateDragPreview(clientX, trackElement);\n    }\n  }, [updateDragPreview]);\n  React.useEffect(() => {\n    const trackElement = document.querySelector(`[data-track-id=\"${track.id}\"]`);\n    if (trackElement) {\n      trackElement.addEventListener('mobileDrop', handleMobileDrop);\n      trackElement.addEventListener('mobileClipMove', handleMobileClipMove);\n      trackElement.addEventListener('updateDragPreview', handleUpdateDragPreview);\n      return () => {\n        trackElement.removeEventListener('mobileDrop', handleMobileDrop);\n        trackElement.removeEventListener('mobileClipMove', handleMobileClipMove);\n        trackElement.removeEventListener('updateDragPreview', handleUpdateDragPreview);\n      };\n    }\n  }, [track.id, handleMobileDrop, handleMobileClipMove, handleUpdateDragPreview]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"track\",\n    style: {\n      height: trackHeight\n    },\n    \"data-track-id\": track.id,\n    onDrop: handleDrop,\n    onDragOver: onDragOver,\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"track-grid\",\n      children: isTimeMode ?\n      /*#__PURE__*/\n      // 秒数モード: 秒単位でグリッド線を表示\n      _jsxDEV(_Fragment, {\n        children: [Array.from({\n          length: TIME_MODE_TOTAL_SECONDS\n        }, (_, index) => /*#__PURE__*/_jsxDEV(\"div\", {\n          className: `beat-line beat-line-main ${index === 0 ? 'first-beat' : ''} ${index % 5 === 0 ? 'measure-start' : ''}`,\n          style: {\n            left: index * PIXELS_PER_SECOND\n          }\n        }, `time-main-${index}`, false, {\n          fileName: _jsxFileName,\n          lineNumber: 2133,\n          columnNumber: 15\n        }, this)), Array.from({\n          length: TIME_MODE_TOTAL_SECONDS * 2\n        }, (_, index) => {\n          if (index % 2 === 1) {\n            // 奇数のインデックス（0.5秒、1.5秒など）\n            return /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"beat-line beat-line-sub\",\n              style: {\n                left: index * PIXELS_PER_SECOND / 2\n              }\n            }, `time-sub-${index}`, false, {\n              fileName: _jsxFileName,\n              lineNumber: 2143,\n              columnNumber: 19\n            }, this);\n          }\n          return null;\n        })]\n      }, void 0, true) :\n      /*#__PURE__*/\n      // 拍子モード: 従来の拍・小節グリッド\n      _jsxDEV(_Fragment, {\n        children: [Array.from({\n          length: TOTAL_BEATS\n        }, (_, index) => {\n          const isFirstBeat = index === 0;\n          const isMeasureStart = index % BEATS_PER_MEASURE === 0;\n          const className = `beat-line beat-line-main ${isFirstBeat ? 'first-beat' : ''} ${isMeasureStart ? 'measure-start' : ''}`;\n          return /*#__PURE__*/_jsxDEV(\"div\", {\n            className: className,\n            style: {\n              left: index * BEAT_WIDTH\n            }\n          }, `main-${index}`, false, {\n            fileName: _jsxFileName,\n            lineNumber: 2162,\n            columnNumber: 17\n          }, this);\n        }), Array.from({\n          length: TOTAL_BEATS\n        }, (_, index) => /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"beat-line beat-line-sub\",\n          style: {\n            left: index * BEAT_WIDTH + SUB_BEAT_WIDTH\n          }\n        }, `sub-${index}`, false, {\n          fileName: _jsxFileName,\n          lineNumber: 2167,\n          columnNumber: 15\n        }, this))]\n      }, void 0, true)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 2127,\n      columnNumber: 7\n    }, this), track.clips.map(clip => /*#__PURE__*/_jsxDEV(AudioClip, {\n      clip: clip,\n      trackId: track.id,\n      onRemove: () => onRemoveClip(track.id, clip.id),\n      onDragStart: onClipDragStart,\n      onDragEnd: onDragEnd\n    }, clip.id, false, {\n      fileName: _jsxFileName,\n      lineNumber: 2174,\n      columnNumber: 9\n    }, this))]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 2120,\n    columnNumber: 5\n  }, this);\n};\n_s3(Track, \"0FaauKG5na1Hr/QQyJUJBzUbaJk=\");\n_c5 = Track;\nconst AudioClip = ({\n  clip,\n  trackId,\n  onRemove,\n  onDragStart,\n  onDragEnd\n}) => {\n  _s4();\n  var _clip$soundData6;\n  const [waveformData, setWaveformData] = React.useState([]);\n  const [isDragging, setIsDragging] = React.useState(false);\n  const [touchStart, setTouchStart] = React.useState(null);\n  const [touchMove, setTouchMove] = React.useState(null);\n  React.useEffect(() => {\n    // clip.soundData が存在する場合のみ波形データを生成\n    if (clip && clip.soundData) {\n      // 簡単な波形データ生成（実際の実装では音声解析が必要）\n      const generateWaveform = () => {\n        const points = 20; // 波形のポイント数\n        const data = [];\n        for (let i = 0; i < points; i++) {\n          data.push(Math.random() * 0.8 + 0.2); // 0.2-1.0の間のランダム値\n        }\n        setWaveformData(data);\n      };\n      generateWaveform();\n    }\n  }, [clip, clip === null || clip === void 0 ? void 0 : clip.soundData]);\n\n  // clip.soundData の安全性をチェック（Hooksの後で）\n  if (!clip || !clip.soundData) {\n    console.warn('無効なクリップデータ:', clip);\n    return null; // 無効なクリップは表示しない\n  }\n  const handleDragStart = e => {\n    e.stopPropagation(); // イベントバブリングを防ぐ\n\n    // ドラッグデータに既存クリップの情報を設定\n    e.dataTransfer.setData('text/plain', `existing-clip-${clip.id}`);\n    e.dataTransfer.effectAllowed = 'move';\n\n    // onDragStartコールバックを呼び出し（マウス位置とクリップ要素を渡す）\n    onDragStart(clip, trackId, e.clientX, e.currentTarget);\n  };\n  const handleDragEnd = e => {\n    // ドラッグ終了時にクリーンアップを呼び出し\n    if (onDragEnd) {\n      onDragEnd(e);\n    }\n  };\n\n  // タッチイベント対応（クリップの移動）\n  const handleTouchStart = e => {\n    e.stopPropagation();\n    const touch = e.touches[0];\n    setTouchStart({\n      x: touch.clientX,\n      y: touch.clientY\n    });\n    setIsDragging(false);\n\n    // ドラッグモードは移動が確定してから有効化\n  };\n  const handleTouchMove = e => {\n    if (!touchStart) return;\n    const touch = e.touches[0];\n    const currentPos = {\n      x: touch.clientX,\n      y: touch.clientY\n    };\n    setTouchMove(currentPos);\n\n    // ドラッグ開始の判定（10px以上移動）\n    const deltaX = Math.abs(currentPos.x - touchStart.x);\n    const deltaY = Math.abs(currentPos.y - touchStart.y);\n    if (!isDragging && (deltaX > 10 || deltaY > 10)) {\n      setIsDragging(true);\n      // スクロールを一時的に無効化（移動が確定してから）\n      document.body.classList.add('dragging');\n      onDragStart(clip, trackId, touchStart.x, e.currentTarget);\n    }\n    if (isDragging) {\n      // passiveイベントではpreventDefaultが使えないので、touchActionで制御\n\n      // ドロップターゲットのハイライト\n      const elementBelow = document.elementFromPoint(currentPos.x, currentPos.y);\n      const trackElement = elementBelow === null || elementBelow === void 0 ? void 0 : elementBelow.closest('.track');\n\n      // 既存のハイライトを削除\n      document.querySelectorAll('.track').forEach(track => {\n        track.classList.remove('drag-over');\n      });\n\n      // 新しいハイライトを追加（自分のトラック以外も含む）\n      if (trackElement) {\n        trackElement.classList.add('drag-over');\n\n        // ドラッグプレビューも更新（onDragStart時と同様のロジック）\n        if (onDragStart) {\n          // 親コンポーネントのupdateDragPreview関数を呼び出すためのカスタムイベント\n          const dragPreviewEvent = new CustomEvent('updateDragPreview', {\n            detail: {\n              clientX: currentPos.x,\n              trackElement: trackElement\n            }\n          });\n          trackElement.dispatchEvent(dragPreviewEvent);\n        }\n      }\n    }\n  };\n  const handleTouchEnd = e => {\n    if (isDragging && touchMove) {\n      // ドロップ処理\n      const elementBelow = document.elementFromPoint(touchMove.x, touchMove.y);\n      const trackElement = elementBelow === null || elementBelow === void 0 ? void 0 : elementBelow.closest('.track');\n      if (trackElement) {\n        const newTrackId = parseInt(trackElement.dataset.trackId);\n        const rect = trackElement.getBoundingClientRect();\n        const timePosition = touchMove.x - rect.left;\n\n        // 既存クリップの移動イベントを発火\n        const moveEvent = new CustomEvent('mobileClipMove', {\n          detail: {\n            clip,\n            originalTrackId: trackId,\n            newTrackId,\n            timePosition\n          }\n        });\n        trackElement.dispatchEvent(moveEvent);\n      }\n    }\n\n    // クリーンアップ\n    setTouchStart(null);\n    setTouchMove(null);\n    setIsDragging(false);\n    document.body.classList.remove('dragging');\n\n    // ハイライトを削除\n    document.querySelectorAll('.track').forEach(track => {\n      track.classList.remove('drag-over');\n    });\n\n    // ドラッグプレビューをクリア（親コンポーネントの状態もリセット）\n    if (onDragEnd) {\n      onDragEnd(null); // nullを渡してガード条件を満たす\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: `audio-clip ${isDragging ? 'dragging' : ''}`,\n    draggable: \"true\",\n    onDragStart: handleDragStart,\n    onDragEnd: handleDragEnd,\n    onTouchStart: handleTouchStart,\n    onTouchMove: handleTouchMove,\n    onTouchEnd: handleTouchEnd,\n    style: {\n      left: clip.startTime,\n      width: isFinite(clip.duration) && clip.duration > 0 ? clip.duration : 400 // デフォルト1小節\n    },\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"clip-header\",\n      children: [/*#__PURE__*/_jsxDEV(\"span\", {\n        className: \"clip-name\",\n        children: ((_clip$soundData6 = clip.soundData) === null || _clip$soundData6 === void 0 ? void 0 : _clip$soundData6.name) || '不明な音素材'\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 2349,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"remove-clip-btn\",\n        onClick: onRemove,\n        title: \"\\u30AF\\u30EA\\u30C3\\u30D7\\u3092\\u524A\\u9664\",\n        children: \"\\xD7\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 2350,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 2348,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"clip-waveform\",\n      children: waveformData.length > 0 ? /*#__PURE__*/_jsxDEV(\"svg\", {\n        className: \"waveform-svg\",\n        width: \"100%\",\n        height: \"30\",\n        children: waveformData.map((height, index) => /*#__PURE__*/_jsxDEV(\"rect\", {\n          x: `${index / waveformData.length * 100}%`,\n          y: `${(1 - height) * 15}`,\n          width: `${80 / waveformData.length}%`,\n          height: `${height * 30}`,\n          fill: \"rgba(255, 255, 255, 0.8)\"\n        }, index, false, {\n          fileName: _jsxFileName,\n          lineNumber: 2362,\n          columnNumber: 15\n        }, this))\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 2360,\n        columnNumber: 11\n      }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"waveform-placeholder\",\n        children: \"\\uD83D\\uDD0A\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 2373,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 2358,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 2335,\n    columnNumber: 5\n  }, this);\n};\n_s4(AudioClip, \"NeAysvgdzDwGIytG3p5NplFZv3M=\");\n_c6 = AudioClip;\nconst Playhead = ({\n  currentTime\n}) => {\n  // currentTimeが有効な数値かチェック\n  const safeCurrentTime = isFinite(currentTime) && currentTime >= 0 ? currentTime : 0;\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"playhead\",\n    style: {\n      left: safeCurrentTime\n    }\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 2385,\n    columnNumber: 5\n  }, this);\n};\n_c7 = Playhead;\nexport default DAWPage;\nvar _c, _c2, _c3, _c4, _c5, _c6, _c7;\n$RefreshReg$(_c, \"DAWPage\");\n$RefreshReg$(_c2, \"SoundItem\");\n$RefreshReg$(_c3, \"TrackHeader\");\n$RefreshReg$(_c4, \"Timeline\");\n$RefreshReg$(_c5, \"Track\");\n$RefreshReg$(_c6, \"AudioClip\");\n$RefreshReg$(_c7, \"Playhead\");","map":{"version":3,"names":["React","useState","useRef","useEffect","useCallback","jsxDEV","_jsxDEV","Fragment","_Fragment","BEAT_WIDTH","BEATS_PER_MEASURE","MEASURE_WIDTH","SUB_BEAT_WIDTH","TOTAL_MEASURES","TOTAL_BEATS","TIME_MODE_TOTAL_SECONDS","PIXELS_PER_SECOND","DAWPage","_s","trackIdCounterRef","trackNameCounterRef","loadAutoSavedProject","autoSavedData","localStorage","getItem","projectData","JSON","parse","trackNameCounter","current","trackIdCounter","validTracks","tracks","map","track","clips","filter","clip","soundData","name","console","warn","length","id","Date","now","bpm","isTimeMode","secondsPerBeat","error","initialData","setTracks","setBpm","isPlaying","setIsPlaying","currentTime","setCurrentTime","audioContext","setAudioContext","trackHeight","playingAudios","setPlayingAudios","Map","startPlayTime","setStartPlayTime","setError","sounds","setSounds","showSoundPanel","setShowSoundPanel","draggedClip","setDraggedClip","dragPreview","setDragPreview","draggedSoundDuration","setDraggedSoundDuration","dragOffset","setDragOffset","setIsTimeMode","setSecondsPerBeat","isExporting","setIsExporting","timelineRef","animationFrameRef","dragOverTimeoutRef","ctx","window","AudioContext","webkitAudioContext","savedSounds","soundsWithBlob","sound","audioData","includes","base64Data","split","byteCharacters","atob","byteNumbers","Array","i","charCodeAt","byteArray","Uint8Array","blob","Blob","type","size","audioBlob","validSounds","validSoundsForStorage","undefined","setItem","stringify","state","close","catch","cancelAnimationFrame","clearTimeout","currentPlayingAudios","forEach","audio","timeoutId","audioUrl","pause","src","URL","revokeObjectURL","currentDraggedSoundBlob","currentDraggedSound","getAudioDuration","currentBpm","currentSecondsPerBeat","Promise","resolve","arrayBuffer","audioBuffer","decodeAudioData","durationInSeconds","duration","isFinite","pixelsPerSecond","beatWidthInPixels","widthInPixels","toggleTimeMode","newTimeMode","updatedTracks","all","updatedClips","newDuration","handleSecondsPerBeatChange","newSecondsPerBeat","getSnapPosition","position","subBeatWidth","Math","round","updatePlayhead","animate","elapsed","newCurrentTime","requestAnimationFrame","timeInSeconds","handleBpmChange","newBpm","saveProject","version","timestamp","projectJson","url","createObjectURL","link","document","createElement","href","download","toISOString","slice","replace","body","appendChild","click","removeChild","loadProject","event","file","target","files","reader","FileReader","onload","e","result","Error","restoreAudioBlob","restoredTracks","restoredSounds","prevSounds","maxId","max","s","existingNames","Set","newSounds","index","newName","counter","has","add","setTimeout","autoSaveData","readAsText","value","exportAudio","maxDuration","clipStartTimeInSeconds","startTime","clipDurationInSeconds","clipEndTime","exportContext","sampleRate","bufferLength","ceil","outputBuffer","createBuffer","leftChannel","getChannelData","rightChannel","startTimeInSamples","floor","channel","min","numberOfChannels","sourceData","targetData","wavBlob","audioBufferToWav","buffer","bytesPerSample","blockAlign","byteRate","dataSize","bufferSize","ArrayBuffer","view","DataView","writeString","offset","string","setUint8","setUint32","setUint16","sample","intSample","setInt16","addTrack","uniqueId","trackName","newTrack","prevTracks","removeTrack","trackId","handleDrop","timePosition","preventDefault","adjustedPosition","snappedPosition","updatedClip","originalTrackId","jsonData","dataTransfer","getData","newClip","random","handleDragOver","dropEffect","clientX","currentTarget","updateDragPreview","trackElement","dragCleanupTimer","cleanupDragState","rect","getBoundingClientRect","left","trackRect","tracksAreaRect","dataset","relativeTop","top","parseInt","isNaN","previewWidth","width","removeClip","clipId","handleClipDragStart","mouseX","clipElement","clipRect","offsetInClip","querySelectorAll","classList","remove","mobileDragPreview","querySelector","cleanupDragStateCallback","handleGlobalDragEnd","handleGlobalDragLeave","relatedTarget","nodeName","addEventListener","removeEventListener","handleDragEnd","play","resume","currentTimeInSeconds","newPlayingAudios","clipEndTimeInSeconds","delay","scheduleClipPlayback","delayMs","playingAudiosMap","Audio","set","_clip$soundData","_clip$soundData2","_clip$soundData3","_clip$soundData4","_clip$soundData5","soundDataName","hasAudioData","hasAudioBlob","audioBlobType","isInstanceOfBlob","restoreError","paused","stop","autoSaveProject","handleVisibilityChange","hidden","clearAutoSave","removeItem","alert","cleanupInvalidClips","cleanedTracks","removedCount","reduce","total","timer","className","children","fileName","_jsxFileName","lineNumber","columnNumber","onClick","accept","onChange","style","display","confirm","title","disabled","htmlFor","parseFloat","step","SoundItem","onDragStart","TrackHeader","trackIndex","onRemove","height","Timeline","ref","minWidth","Playhead","Track","onDrop","onDragOver","onRemoveClip","onClipDragStart","onDragEnd","_c","_s2","isDragging","setIsDragging","touchStart","setTouchStart","touchMove","setTouchMove","handleDragStart","soundDataForTransfer","setData","effectAllowed","handleTouchStart","touch","touches","x","y","clientY","handleTouchMove","currentPos","deltaX","abs","deltaY","elementBelow","elementFromPoint","closest","handleTouchEnd","dropEvent","CustomEvent","detail","dispatchEvent","playSound","_sound$audioBlob","isBlob","then","handleEnded","createDragPreview","textContent","cssText","draggable","onTouchStart","onTouchMove","onTouchEnd","tags","tag","_c2","displayName","_c3","totalSeconds","secondWidth","from","_","intervalIndex","secondIndex","measures","beatsPerMeasure","measureIndex","beatIndex","_c4","_s3","handleMobileDrop","mockDropEvent","handleMobileClipMove","newTrackId","handleUpdateDragPreview","isFirstBeat","isMeasureStart","AudioClip","_c5","_s4","_clip$soundData6","waveformData","setWaveformData","generateWaveform","points","data","push","stopPropagation","dragPreviewEvent","moveEvent","fill","_c6","safeCurrentTime","_c7","$RefreshReg$"],"sources":["/Users/nakataniyuutomo/Desktop/Programing/ゼミ開発/sound-library2/src/pages/DAWPage.js"],"sourcesContent":["import React, { useState, useRef, useEffect, useCallback } from 'react';\nimport './DAWPage.css';\n\n// DAWの定数\nconst BEAT_WIDTH = 100; // 1拍の幅（px）\nconst BEATS_PER_MEASURE = 4; // 1小節あたりの拍数\nconst MEASURE_WIDTH = BEAT_WIDTH * BEATS_PER_MEASURE; // 1小節の幅（400px）\nconst SUB_BEAT_WIDTH = BEAT_WIDTH / 2; // 8分音符の幅（50px）\nconst TOTAL_MEASURES = 16; // 表示する小節数\nconst TOTAL_BEATS = TOTAL_MEASURES * BEATS_PER_MEASURE; // 総拍数\n\n// 時間モードの定数\nconst TIME_MODE_TOTAL_SECONDS = 60; // 表示する総秒数\nconst PIXELS_PER_SECOND = 100; // 1秒あたりのピクセル数\n\nconst DAWPage = () => {\n  // ユニークID生成用のカウンター\n  const trackIdCounterRef = useRef(1);\n  // トラック名の番号管理用カウンター\n  const trackNameCounterRef = useRef(1);\n  \n  // LocalStorageからの自動復元機能\n  const loadAutoSavedProject = () => {\n    try {\n      const autoSavedData = localStorage.getItem('dawProjectAutoSave');\n      if (autoSavedData) {\n        const projectData = JSON.parse(autoSavedData);\n        \n        // トラックカウンターの復元\n        if (projectData.trackNameCounter) {\n          trackNameCounterRef.current = projectData.trackNameCounter;\n        }\n        if (projectData.trackIdCounter) {\n          trackIdCounterRef.current = projectData.trackIdCounter;\n        }\n        \n        // 無効なクリップをフィルタリング\n        const validTracks = (projectData.tracks || []).map(track => ({\n          ...track,\n          clips: (track.clips || []).filter(clip => {\n            if (!clip.soundData || !clip.soundData.name) {\n              console.warn('自動保存データから無効なクリップを除外:', clip);\n              return false;\n            }\n            return true;\n          })\n        }));\n        \n        return {\n          tracks: validTracks.length > 0 ? validTracks : [{ \n            id: Date.now(), \n            name: 'トラック 1', \n            clips: [] \n          }],\n          bpm: projectData.bpm || 120,\n          isTimeMode: projectData.isTimeMode || false,\n          secondsPerBeat: projectData.secondsPerBeat || 0.5\n        };\n      }\n    } catch (error) {\n      console.error('自動保存データの復元に失敗:', error);\n    }\n    \n    return {\n      tracks: [{ \n        id: Date.now(), \n        name: 'トラック 1', \n        clips: [] \n      }],\n      bpm: 120,\n      isTimeMode: false,\n      secondsPerBeat: 0.5\n    };\n  };\n\n  const initialData = loadAutoSavedProject();\n  const [tracks, setTracks] = useState(initialData.tracks);\n  const [bpm, setBpm] = useState(initialData.bpm);\n  const [isPlaying, setIsPlaying] = useState(false);\n  const [currentTime, setCurrentTime] = useState(0);\n  const [audioContext, setAudioContext] = useState(null);\n  const [trackHeight] = useState(80);\n  const [playingAudios, setPlayingAudios] = useState(new Map());\n  const [startPlayTime, setStartPlayTime] = useState(null);\n  const [error, setError] = useState(null);\n  const [sounds, setSounds] = useState([]);\n  const [showSoundPanel, setShowSoundPanel] = useState(true);\n  const [draggedClip, setDraggedClip] = useState(null);\n  const [dragPreview, setDragPreview] = useState(null);\n  const [draggedSoundDuration, setDraggedSoundDuration] = useState(400); // ドラッグ中の音素材の長さ\n  const [dragOffset, setDragOffset] = useState(0); // ドラッグ開始時のクリップ内オフセット\n  \n  // 時間モード関連の状態\n  const [isTimeMode, setIsTimeMode] = useState(initialData.isTimeMode); // false: 拍子モード, true: 秒数モード\n  const [secondsPerBeat, setSecondsPerBeat] = useState(initialData.secondsPerBeat); // 秒数モード時の1拍あたりの秒数\n  const [isExporting, setIsExporting] = useState(false); // 音源出力中フラグ\n  const timelineRef = useRef(null);\n  const animationFrameRef = useRef(null);\n  const dragOverTimeoutRef = useRef(null);\n\n  useEffect(() => {\n    // Web Audio API の初期化\n    const ctx = new (window.AudioContext || window.webkitAudioContext)();\n    setAudioContext(ctx);\n    \n    // LocalStorageから音素材を読み込み\n    const savedSounds = JSON.parse(localStorage.getItem('soundRecordings') || '[]');\n    \n    // audioDataからBlobを復元\n    const soundsWithBlob = savedSounds.map(sound => {\n      if (sound.audioData) {\n        try {\n          // Base64データの検証\n          if (!sound.audioData.includes(',')) {\n            console.error('無効なBase64フォーマット:', sound.name);\n            return sound;\n          }\n          \n          const base64Data = sound.audioData.split(',')[1];\n          if (!base64Data || base64Data.length === 0) {\n            console.error('Base64データが空です:', sound.name);\n            return sound;\n          }\n          \n          const byteCharacters = atob(base64Data);\n          const byteNumbers = new Array(byteCharacters.length);\n          for (let i = 0; i < byteCharacters.length; i++) {\n            byteNumbers[i] = byteCharacters.charCodeAt(i);\n          }\n          const byteArray = new Uint8Array(byteNumbers);\n          \n          // Blobサイズの検証\n          if (byteArray.length === 0) {\n            console.error('Blobデータが空です:', sound.name);\n            return sound;\n          }\n          \n          const blob = new Blob([byteArray], { type: 'audio/wav' });\n          \n          // Blobの有効性を確認\n          if (blob.size === 0) {\n            console.error('作成されたBlobのサイズが0です:', sound.name);\n            return sound;\n          }\n          \n          return { ...sound, audioBlob: blob };\n        } catch (error) {\n          console.error('音声データの復元に失敗:', sound.name, error);\n          return sound;\n        }\n      }\n      return sound;\n    });\n    \n    // 有効な音素材のみをフィルタリング\n    const validSounds = soundsWithBlob.filter(sound => {\n      if (!sound.audioBlob) {\n        console.warn('audioBlobが存在しない音素材をスキップ:', sound.name);\n        return false;\n      }\n      if (!(sound.audioBlob instanceof Blob)) {\n        console.warn('無効なBlob形式の音素材をスキップ:', sound.name);\n        return false;\n      }\n      if (sound.audioBlob.size === 0) {\n        console.warn('サイズが0のBlob音素材をスキップ:', sound.name);\n        return false;\n      }\n      return true;\n    });\n    \n    setSounds(validSounds);\n    \n    // 無効な音素材があった場合はLocalStorageを更新\n    if (validSounds.length !== soundsWithBlob.length) {\n      const validSoundsForStorage = validSounds.map(sound => ({\n        ...sound,\n        audioBlob: undefined // Blobは保存しない\n      }));\n      localStorage.setItem('soundRecordings', JSON.stringify(validSoundsForStorage));\n    }\n    \n    return () => {\n      if (ctx && ctx.state !== 'closed') {\n        ctx.close().catch(error => {\n          console.warn('初期AudioContext のクローズに失敗:', error);\n        });\n      }\n      if (animationFrameRef.current) {\n        cancelAnimationFrame(animationFrameRef.current);\n      }\n      if (dragOverTimeoutRef.current) {\n        clearTimeout(dragOverTimeoutRef.current);\n      }\n      // 再生中の音声をすべて停止・クリーンアップ\n      // useEffect内でplayingAudiosの最新値を取得\n      setPlayingAudios(currentPlayingAudios => {\n        currentPlayingAudios.forEach(({ audio, timeoutId, audioUrl }) => {\n          if (timeoutId) {\n            clearTimeout(timeoutId);\n          }\n          if (audio) {\n            audio.pause();\n            audio.src = '';\n          }\n          if (audioUrl) {\n            URL.revokeObjectURL(audioUrl);\n          }\n        });\n        return new Map(); // 空のMapを返す\n      });\n      // グローバル変数をクリーンアップ\n      if (window.currentDraggedSoundBlob) {\n        window.currentDraggedSoundBlob = null;\n      }\n      if (window.currentDraggedSound) {\n        window.currentDraggedSound = null;\n      }\n    };\n  }, []);\n\n  // 音声ファイルの継続時間を取得してピクセル幅に変換\n  const getAudioDuration = useCallback((audioBlob, currentBpm = bpm, currentSecondsPerBeat = secondsPerBeat) => {\n    return new Promise(async (resolve) => {\n      if (!audioBlob || !(audioBlob instanceof Blob)) {\n        resolve(400);\n        return;\n      }\n\n\n      // AudioContextを使用した方法を優先\n      if (audioContext) {\n        try {\n          const arrayBuffer = await audioBlob.arrayBuffer();\n          const audioBuffer = await audioContext.decodeAudioData(arrayBuffer);\n          const durationInSeconds = audioBuffer.duration;\n          \n          \n          if (isFinite(durationInSeconds) && durationInSeconds > 0) {\n            let pixelsPerSecond;\n            if (isTimeMode) {\n              // 秒数モード：1拍の秒数に基づいてピクセル/秒を計算\n              const beatWidthInPixels = currentSecondsPerBeat * PIXELS_PER_SECOND;\n              pixelsPerSecond = PIXELS_PER_SECOND;\n            } else {\n              // 拍子モード：BPMベース\n              pixelsPerSecond = (currentBpm / 60) * 100;\n            }\n            const widthInPixels = durationInSeconds * pixelsPerSecond;\n            resolve(widthInPixels);\n            return;\n          }\n        } catch (error) {\n          console.error('AudioContext方式でエラー:', error);\n        }\n      }\n      resolve(400);\n    });\n  }, [audioContext, bpm, isTimeMode, secondsPerBeat]);\n\n  // 時間モードとBPMモードを切り替える関数\n  const toggleTimeMode = useCallback(async () => {\n    const newTimeMode = !isTimeMode;\n    setIsTimeMode(newTimeMode);\n    \n    // 既存のクリップのdurationを新しいモードで再計算\n    const updatedTracks = await Promise.all(\n      tracks.map(async (track) => {\n        const updatedClips = await Promise.all(\n          track.clips.map(async (clip) => {\n            if (clip.soundData && clip.soundData.audioBlob) {\n              try {\n                const arrayBuffer = await clip.soundData.audioBlob.arrayBuffer();\n                const audioBuffer = await audioContext.decodeAudioData(arrayBuffer);\n                const durationInSeconds = audioBuffer.duration;\n                \n                let pixelsPerSecond;\n                if (newTimeMode) {\n                  pixelsPerSecond = PIXELS_PER_SECOND;\n                } else {\n                  pixelsPerSecond = (bpm / 60) * 100;\n                }\n                const newDuration = durationInSeconds * pixelsPerSecond;\n                \n                return { ...clip, duration: newDuration };\n              } catch (error) {\n                console.warn('クリップのduration再計算に失敗:', error);\n                return clip;\n              }\n            }\n            return clip;\n          })\n        );\n        return { ...track, clips: updatedClips };\n      })\n    );\n    \n    setTracks(updatedTracks);\n  }, [isTimeMode, tracks, audioContext, bpm]);\n\n  // 秒数モードでの1拍あたりの秒数を変更する関数\n  const handleSecondsPerBeatChange = useCallback(async (newSecondsPerBeat) => {\n    setSecondsPerBeat(newSecondsPerBeat);\n    \n    // 秒数モードの場合、既存のクリップのdurationを再計算\n    if (isTimeMode) {\n      const updatedTracks = await Promise.all(\n        tracks.map(async (track) => {\n          const updatedClips = await Promise.all(\n            track.clips.map(async (clip) => {\n              if (clip.soundData && clip.soundData.audioBlob) {\n                try {\n                  const newDuration = await getAudioDuration(clip.soundData.audioBlob, bpm);\n                  return { ...clip, duration: newDuration };\n                } catch (error) {\n                  console.warn('クリップのduration再計算に失敗:', error);\n                  return clip;\n                }\n              }\n              return clip;\n            })\n          );\n          return { ...track, clips: updatedClips };\n        })\n      );\n      \n      setTracks(updatedTracks);\n    }\n  }, [isTimeMode, tracks, getAudioDuration, bpm]);\n\n  // スナップ処理（拍子モード vs 秒数モード）\n  const getSnapPosition = useCallback((position) => {\n    if (isTimeMode) {\n      // 秒数モード：1拍（秒数）単位でスナップ\n      const beatWidthInPixels = secondsPerBeat * PIXELS_PER_SECOND;\n      const subBeatWidth = beatWidthInPixels / 2; // 半拍でスナップ\n      return Math.round(position / subBeatWidth) * subBeatWidth;\n    } else {\n      // 拍子モード：8分音符単位でスナップ\n      return Math.round(position / SUB_BEAT_WIDTH) * SUB_BEAT_WIDTH;\n    }\n  }, [isTimeMode, secondsPerBeat]);\n\n  // プレイヘッドのアニメーション更新\n  const updatePlayhead = useCallback(() => {\n    const animate = () => {\n      if (isPlaying && startPlayTime) {\n        const elapsed = (Date.now() - startPlayTime) / 1000; // 経過時間（秒）\n        \n        let pixelsPerSecond;\n        if (isTimeMode) {\n          // 秒数モード：直接1秒 = PIXELS_PER_SECONDピクセル\n          pixelsPerSecond = PIXELS_PER_SECOND;\n        } else {\n          // 拍子モード：BPMに基づいたピクセル/秒\n          pixelsPerSecond = (bpm / 60) * 100;\n        }\n        \n        const newCurrentTime = elapsed * pixelsPerSecond;\n        \n        // 有効な数値かチェック\n        if (isFinite(newCurrentTime) && newCurrentTime >= 0) {\n          setCurrentTime(newCurrentTime);\n        } else {\n          console.warn('無効なcurrentTime:', newCurrentTime, 'elapsed:', elapsed, 'pixelsPerSecond:', pixelsPerSecond);\n        }\n        \n        // 次のフレームを要求\n        animationFrameRef.current = requestAnimationFrame(animate);\n      }\n    };\n    \n    if (isPlaying && startPlayTime) {\n      animate();\n    }\n  }, [isPlaying, startPlayTime, bpm, isTimeMode]);\n\n  useEffect(() => {\n    if (isPlaying) {\n      if (!startPlayTime) {\n        // 再生開始時にstartPlayTimeを設定\n        let pixelsPerSecond;\n        if (isTimeMode) {\n          pixelsPerSecond = PIXELS_PER_SECOND;\n        } else {\n          pixelsPerSecond = (bpm / 60) * 100;\n        }\n        \n        if (isFinite(pixelsPerSecond) && pixelsPerSecond > 0) {\n          const timeInSeconds = currentTime / pixelsPerSecond;\n          if (isFinite(timeInSeconds) && timeInSeconds >= 0) {\n            setStartPlayTime(Date.now() - (timeInSeconds * 1000));\n          } else {\n            setStartPlayTime(Date.now());\n          }\n        } else {\n          setStartPlayTime(Date.now());\n        }\n      }\n    } else {\n      // 再生停止時にアニメーションをクリア\n      if (animationFrameRef.current) {\n        cancelAnimationFrame(animationFrameRef.current);\n        animationFrameRef.current = null;\n      }\n      setStartPlayTime(null);\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [isPlaying, bpm, currentTime, isTimeMode]);\n\n  // startPlayTimeが設定されたときにアニメーションを開始\n  useEffect(() => {\n    if (isPlaying && startPlayTime) {\n      updatePlayhead();\n    }\n  }, [isPlaying, startPlayTime, updatePlayhead]);\n\n  // BPM変更時のハンドラー\n  const handleBpmChange = useCallback(async (newBpm) => {\n    setBpm(newBpm);\n    \n    // 既存のクリップのdurationを新しいBPMで再計算\n    const updatedTracks = await Promise.all(\n      tracks.map(async (track) => {\n        const updatedClips = await Promise.all(\n          track.clips.map(async (clip) => {\n            if (clip.soundData && clip.soundData.audioBlob) {\n              try {\n                const newDuration = await getAudioDuration(clip.soundData.audioBlob, newBpm);\n                return { ...clip, duration: newDuration };\n              } catch (error) {\n                console.warn('クリップのduration更新に失敗:', error);\n                return clip;\n              }\n            }\n            return clip;\n          })\n        );\n        return { ...track, clips: updatedClips };\n      })\n    );\n    \n    setTracks(updatedTracks);\n  }, [tracks, getAudioDuration]);\n\n  // プロジェクト保存機能\n  const saveProject = () => {\n    try {\n      const projectData = {\n        version: '1.0',\n        bpm: bpm,\n        tracks: tracks,\n        sounds: sounds.map(sound => ({\n          ...sound,\n          audioBlob: null, // Blobは別途保存\n          audioData: sound.audioData // base64データを保持\n        })),\n        timestamp: Date.now(),\n        trackNameCounter: trackNameCounterRef.current,\n        trackIdCounter: trackIdCounterRef.current,\n        isTimeMode: isTimeMode,\n        secondsPerBeat: secondsPerBeat\n      };\n\n      const projectJson = JSON.stringify(projectData, null, 2);\n      const blob = new Blob([projectJson], { type: 'application/json' });\n      const url = URL.createObjectURL(blob);\n      \n      const link = document.createElement('a');\n      link.href = url;\n      link.download = `music-project-${new Date().toISOString().slice(0, 19).replace(/:/g, '-')}.json`;\n      document.body.appendChild(link);\n      link.click();\n      document.body.removeChild(link);\n      URL.revokeObjectURL(url);\n      \n    } catch (error) {\n      console.error('プロジェクト保存エラー:', error);\n      setError('プロジェクトの保存に失敗しました。');\n    }\n  };\n\n  // プロジェクト読み込み機能\n  const loadProject = (event) => {\n    const file = event.target.files[0];\n    if (!file) return;\n\n    const reader = new FileReader();\n    reader.onload = (e) => {\n      try {\n        const projectData = JSON.parse(e.target.result);\n        \n        // バージョンチェック\n        if (!projectData.version) {\n          throw new Error('不正なプロジェクトファイルです');\n        }\n\n        // 音声データ復元用のヘルパー関数\n        const restoreAudioBlob = (soundData) => {\n          if (soundData && soundData.audioData) {\n            try {\n              const byteCharacters = atob(soundData.audioData.split(',')[1]);\n              const byteNumbers = new Array(byteCharacters.length);\n              for (let i = 0; i < byteCharacters.length; i++) {\n                byteNumbers[i] = byteCharacters.charCodeAt(i);\n              }\n              const byteArray = new Uint8Array(byteNumbers);\n              const blob = new Blob([byteArray], { type: 'audio/wav' });\n              return { ...soundData, audioBlob: blob };\n            } catch (error) {\n              console.error('音声データの復元に失敗:', soundData.name || 'unknown', error);\n              return soundData;\n            }\n          }\n          return soundData;\n        };\n\n        // BPMを復元\n        setBpm(projectData.bpm || 120);\n        \n        // 時間モード設定を復元\n        setIsTimeMode(projectData.isTimeMode || false);\n        setSecondsPerBeat(projectData.secondsPerBeat || 0.5);\n        \n        // トラックを復元（クリップ内の音声データも復元）\n        if (projectData.tracks) {\n          const restoredTracks = projectData.tracks.map(track => ({\n            ...track,\n            clips: track.clips\n              .map(clip => ({\n                ...clip,\n                soundData: restoreAudioBlob(clip.soundData)\n              }))\n              .filter(clip => {\n                // 無効なクリップを除外\n                if (!clip.soundData || !clip.soundData.name) {\n                  console.warn('無効なクリップを除外:', clip);\n                  return false;\n                }\n                return true;\n              })\n          }));\n          setTracks(restoredTracks);\n        }\n        \n        // カウンターを復元\n        if (projectData.trackNameCounter) {\n          trackNameCounterRef.current = projectData.trackNameCounter;\n        }\n        if (projectData.trackIdCounter) {\n          trackIdCounterRef.current = projectData.trackIdCounter;\n        }\n        \n        // 音素材を復元（既存の音素材に追加）\n        if (projectData.sounds) {\n          const restoredSounds = projectData.sounds.map(sound => restoreAudioBlob(sound));\n          \n          // 既存の音素材と読み込んだ音素材を結合\n          setSounds(prevSounds => {\n            const maxId = prevSounds.length > 0 ? Math.max(...prevSounds.map(s => s.id)) : 0;\n            const existingNames = new Set(prevSounds.map(s => s.name));\n            \n            const newSounds = restoredSounds.map((sound, index) => {\n              let newName = sound.name;\n              let counter = 1;\n              \n              // 名前の重複をチェックして、重複する場合は番号を付ける\n              while (existingNames.has(newName)) {\n                newName = `${sound.name} (${counter})`;\n                counter++;\n              }\n              existingNames.add(newName);\n              \n              return {\n                ...sound,\n                id: maxId + index + 1, // 新しいIDを割り当て\n                name: newName // 重複しない名前を設定\n              };\n            });\n            \n            return [...prevSounds, ...newSounds];\n          });\n        }\n        \n        setError(null);\n        \n        // 読み込み後に自動保存データも更新\n        setTimeout(() => {\n          const autoSaveData = {\n            version: '1.0',\n            bpm: projectData.bpm || 120,\n            tracks: projectData.tracks || [],\n            timestamp: Date.now(),\n            trackNameCounter: projectData.trackNameCounter || 1,\n            trackIdCounter: projectData.trackIdCounter || 1\n          };\n          localStorage.setItem('dawProjectAutoSave', JSON.stringify(autoSaveData));\n        }, 100);\n      } catch (error) {\n        console.error('プロジェクト読み込みエラー:', error);\n        setError('プロジェクトファイルの読み込みに失敗しました。ファイルが正しいか確認してください。');\n      }\n    };\n    \n    reader.readAsText(file);\n    // ファイル選択をリセット\n    event.target.value = '';\n  };\n\n  // 音源出力機能\n  const exportAudio = async () => {\n    if (!audioContext) {\n      setError('AudioContextが初期化されていません。');\n      return;\n    }\n\n    setIsExporting(true);\n    try {\n      // 全トラックの全クリップの最大終了時間を計算\n      let maxDuration = 0;\n      tracks.forEach(track => {\n        track.clips.forEach(clip => {\n          const pixelsPerSecond = (bpm / 60) * 100;\n          const clipStartTimeInSeconds = clip.startTime / pixelsPerSecond;\n          const clipDurationInSeconds = clip.duration / pixelsPerSecond;\n          const clipEndTime = clipStartTimeInSeconds + clipDurationInSeconds;\n          maxDuration = Math.max(maxDuration, clipEndTime);\n        });\n      });\n\n      if (maxDuration === 0) {\n        setError('出力する音声がありません。音素材を配置してください。');\n        setIsExporting(false);\n        return;\n      }\n\n      // 出力用AudioContextを作成（44.1kHz）\n      const exportContext = new AudioContext({ sampleRate: 44100 });\n      const bufferLength = Math.ceil(maxDuration * exportContext.sampleRate);\n      const outputBuffer = exportContext.createBuffer(2, bufferLength, exportContext.sampleRate);\n      \n      const leftChannel = outputBuffer.getChannelData(0);\n      const rightChannel = outputBuffer.getChannelData(1);\n\n      // 各トラックの各クリップを処理\n      for (const track of tracks) {\n        for (const clip of track.clips) {\n          if (clip.soundData && clip.soundData.audioBlob) {\n            try {\n              const arrayBuffer = await clip.soundData.audioBlob.arrayBuffer();\n              const audioBuffer = await exportContext.decodeAudioData(arrayBuffer);\n              \n              const pixelsPerSecond = (bpm / 60) * 100;\n              const startTimeInSamples = Math.floor((clip.startTime / pixelsPerSecond) * exportContext.sampleRate);\n              \n              // 音声をミックス\n              for (let channel = 0; channel < Math.min(audioBuffer.numberOfChannels, 2); channel++) {\n                const sourceData = audioBuffer.getChannelData(channel);\n                const targetData = channel === 0 ? leftChannel : rightChannel;\n                \n                for (let i = 0; i < sourceData.length && (startTimeInSamples + i) < targetData.length; i++) {\n                  targetData[startTimeInSamples + i] += sourceData[i];\n                }\n              }\n              \n              // モノラル音源の場合は両チャンネルにコピー\n              if (audioBuffer.numberOfChannels === 1) {\n                const sourceData = audioBuffer.getChannelData(0);\n                for (let i = 0; i < sourceData.length && (startTimeInSamples + i) < rightChannel.length; i++) {\n                  rightChannel[startTimeInSamples + i] += sourceData[i];\n                }\n              }\n            } catch (error) {\n              console.error('クリップの処理エラー:', error);\n            }\n          }\n        }\n      }\n\n      // WAVファイルとして出力\n      const wavBlob = audioBufferToWav(outputBuffer);\n      const url = URL.createObjectURL(wavBlob);\n      \n      const link = document.createElement('a');\n      link.href = url;\n      link.download = `exported-music-${new Date().toISOString().slice(0, 19).replace(/:/g, '-')}.wav`;\n      document.body.appendChild(link);\n      link.click();\n      document.body.removeChild(link);\n      URL.revokeObjectURL(url);\n      \n      if (exportContext && exportContext.state !== 'closed') {\n        await exportContext.close().catch(error => {\n          console.warn('Export AudioContext のクローズに失敗:', error);\n        });\n      }\n    } catch (error) {\n      console.error('音源出力エラー:', error);\n      setError('音源の出力に失敗しました。');\n    } finally {\n      setIsExporting(false);\n    }\n  };\n\n  // AudioBufferをWAVファイルに変換\n  const audioBufferToWav = (buffer) => {\n    const length = buffer.length;\n    const numberOfChannels = buffer.numberOfChannels;\n    const sampleRate = buffer.sampleRate;\n    const bytesPerSample = 2;\n    const blockAlign = numberOfChannels * bytesPerSample;\n    const byteRate = sampleRate * blockAlign;\n    const dataSize = length * blockAlign;\n    const bufferSize = 44 + dataSize;\n    \n    const arrayBuffer = new ArrayBuffer(bufferSize);\n    const view = new DataView(arrayBuffer);\n    \n    // WAVファイルヘッダー\n    const writeString = (offset, string) => {\n      for (let i = 0; i < string.length; i++) {\n        view.setUint8(offset + i, string.charCodeAt(i));\n      }\n    };\n    \n    writeString(0, 'RIFF');\n    view.setUint32(4, bufferSize - 8, true);\n    writeString(8, 'WAVE');\n    writeString(12, 'fmt ');\n    view.setUint32(16, 16, true);\n    view.setUint16(20, 1, true);\n    view.setUint16(22, numberOfChannels, true);\n    view.setUint32(24, sampleRate, true);\n    view.setUint32(28, byteRate, true);\n    view.setUint16(32, blockAlign, true);\n    view.setUint16(34, bytesPerSample * 8, true);\n    writeString(36, 'data');\n    view.setUint32(40, dataSize, true);\n    \n    // 音声データ\n    let offset = 44;\n    for (let i = 0; i < length; i++) {\n      for (let channel = 0; channel < numberOfChannels; channel++) {\n        const sample = buffer.getChannelData(channel)[i];\n        const intSample = Math.max(-1, Math.min(1, sample)) * 0x7FFF;\n        view.setInt16(offset, intSample, true);\n        offset += 2;\n      }\n    }\n    \n    return new Blob([arrayBuffer], { type: 'audio/wav' });\n  };\n\n  const addTrack = () => {\n    // より確実にユニークなIDを生成\n    trackIdCounterRef.current += 1;\n    const uniqueId = Date.now() + trackIdCounterRef.current;\n    \n    // トラック名の番号を増加（削除されても番号は戻らない）\n    trackNameCounterRef.current += 1;\n    const trackName = `トラック ${trackNameCounterRef.current}`;\n    \n    const newTrack = {\n      id: uniqueId,\n      name: trackName,\n      clips: []\n    };\n    setTracks(prevTracks => [...prevTracks, newTrack]);\n  };\n\n  const removeTrack = (trackId) => {\n    setTracks(prevTracks => {\n      if (prevTracks.length > 1) {\n        return prevTracks.filter(track => track.id !== trackId);\n      }\n      return prevTracks;\n    });\n  };\n\n  const handleDrop = async (e, trackId, timePosition) => {\n    e.preventDefault();\n    setDragPreview(null);\n    \n    \n    try {\n      \n      // 既存のクリップの移動かどうかチェック\n      if (draggedClip) {\n        // ドラッグオフセットを考慮した新しい開始位置を計算\n        const adjustedPosition = timePosition - dragOffset;\n        // 拍または秒に合わせて位置を調整\n        const snappedPosition = Math.max(0, getSnapPosition(adjustedPosition));\n        \n        \n        // 既存クリップの移動\n        const updatedClip = {\n          ...draggedClip,\n          startTime: snappedPosition,\n          trackId: trackId\n        };\n\n        setTracks(prevTracks => prevTracks.map(track => {\n          if (track.id === draggedClip.originalTrackId && track.id === trackId) {\n            // 同じトラック内での移動\n            return {\n              ...track,\n              clips: track.clips.map(clip => \n                clip.id === draggedClip.id ? updatedClip : clip\n              )\n            };\n          } else if (track.id === draggedClip.originalTrackId) {\n            // 元のトラックからクリップを削除\n            return {\n              ...track,\n              clips: track.clips.filter(clip => clip.id !== draggedClip.id)\n            };\n          } else if (track.id === trackId) {\n            // 新しいトラックにクリップを追加\n            return {\n              ...track,\n              clips: [...track.clips, updatedClip]\n            };\n          }\n          return track;\n        }));\n        setDraggedClip(null);\n        setDragOffset(0);\n        return;\n      }\n      \n      // 新しい音素材の配置\n      let soundData;\n      try {\n        // dataTransferからデータを取得\n        const jsonData = e.dataTransfer ? e.dataTransfer.getData('application/json') : '';\n        if (jsonData) {\n          soundData = JSON.parse(jsonData);\n        } else {\n          // モバイルの場合はグローバル変数から取得\n          soundData = window.currentDraggedSound;\n        }\n      } catch (error) {\n        console.error('ドラッグデータの取得に失敗:', error);\n        soundData = window.currentDraggedSound; // フォールバック\n      }\n      \n      if (!soundData) {\n        console.error('音素材データが見つかりません');\n        setError('音素材データが見つかりません。再度お試しください。');\n        return;\n      }\n\n      // soundDataの必要なプロパティをチェック\n      if (!soundData.name) {\n        console.error('音素材の名前が見つかりません:', soundData);\n        setError('音素材の名前が不正です。再度お試しください。');\n        return;\n      }\n      \n      // グローバル変数からaudioBlobを復元\n      if (window.currentDraggedSoundBlob) {\n        soundData.audioBlob = window.currentDraggedSoundBlob;\n        window.currentDraggedSoundBlob = null; // クリーンアップ\n      }\n      \n      // グローバル変数をクリア\n      window.currentDraggedSound = null;\n      \n      \n      // 音声の実際の継続時間を取得（現在のBPMに基づいて）\n      let duration = 400; // デフォルト値（1小節）\n      if (soundData.audioBlob) {\n        try {\n          duration = await getAudioDuration(soundData.audioBlob, bpm);\n        } catch (error) {\n          console.warn('音声継続時間の取得に失敗しました:', error);\n        }\n      }\n\n      // durationが有効な値かチェック\n      if (!isFinite(duration) || duration <= 0) {\n        console.warn('無効なduration:', duration, 'デフォルト値を使用');\n        duration = 400; // 1小節分\n      }\n\n      // 新しい音素材の場合は通常のスナップ処理\n      const snappedPosition = getSnapPosition(timePosition);\n\n      const newClip = {\n        id: Date.now() + Math.random(), // より確実にユニークなIDを生成\n        soundData: soundData,\n        startTime: snappedPosition,\n        duration: duration,\n        trackId: trackId\n      };\n\n\n      // 関数型更新を使用して最新の状態を確実に取得\n      setTracks(prevTracks => {\n        const updatedTracks = prevTracks.map(track => \n          track.id === trackId \n            ? { ...track, clips: [...track.clips, newClip] }\n            : track\n        );\n        return updatedTracks;\n      });\n    } catch (error) {\n      console.error('ドロップエラー:', error);\n      setError('音素材の配置に失敗しました。再度お試しください。');\n    }\n  };\n\n  const handleDragOver = (e) => {\n    e.preventDefault();\n    \n    // ドラッグされているのが既存クリップか新しい音素材かで処理を分ける\n    if (draggedClip) {\n      e.dataTransfer.dropEffect = 'move';\n    } else {\n      e.dataTransfer.dropEffect = 'copy';\n    }\n    \n    // スロットリング - 16ms（60FPS）間隔で実行を制限\n    if (dragOverTimeoutRef.current) {\n      return;\n    }\n    \n    // 必要な情報を事前に抽出\n    const clientX = e.clientX;\n    const currentTarget = e.currentTarget;\n    \n    dragOverTimeoutRef.current = setTimeout(() => {\n      dragOverTimeoutRef.current = null;\n      updateDragPreview(clientX, currentTarget);\n    }, 16);\n  };\n  \n  const updateDragPreview = (clientX, trackElement) => {\n    // null チェックを追加\n    if (!trackElement || !timelineRef.current) {\n      return;\n    }\n\n    // 初回ドラッグプレビュー表示時に強制クリーンアップタイマーを設定\n    if (!window.dragCleanupTimer) {\n      window.dragCleanupTimer = setTimeout(() => {\n        cleanupDragState();\n      }, 10000); // 10秒後に強制クリーンアップ\n    }\n    \n    try {\n      // ドラッグプレビューの更新\n      const rect = trackElement.getBoundingClientRect();\n      const timePosition = clientX - rect.left;\n      \n      let snappedPosition;\n      \n      if (draggedClip) {\n        // 既存クリップの場合：ドラッグオフセットを考慮\n        const adjustedPosition = timePosition - dragOffset;\n        snappedPosition = Math.max(0, getSnapPosition(adjustedPosition));\n      } else {\n        // 新しい音素材の場合：通常の処理\n        snappedPosition = getSnapPosition(timePosition);\n      }\n      \n      const trackRect = trackElement.getBoundingClientRect();\n      const tracksAreaRect = timelineRef.current.getBoundingClientRect();\n      \n      if (tracksAreaRect && trackElement.dataset && trackElement.dataset.trackId) {\n        const relativeTop = trackRect.top - tracksAreaRect.top;\n        const trackId = parseInt(trackElement.dataset.trackId);\n        \n        // trackIdが有効な数値かチェック\n        if (isNaN(trackId)) {\n          return;\n        }\n        \n        // プレビュー幅を決定\n        let previewWidth = 400; // デフォルト値（1小節）\n        \n        if (draggedClip) {\n          // 既存クリップの場合\n          previewWidth = isFinite(draggedClip.duration) && draggedClip.duration > 0 \n            ? draggedClip.duration \n            : 400;\n        } else {\n          // 新しい音素材の場合、事前に計算された長さを使用\n          previewWidth = draggedSoundDuration;\n        }\n        \n        setDragPreview({\n          left: snappedPosition,\n          top: relativeTop + 10,\n          width: previewWidth,\n          trackId: trackId\n        });\n      }\n    } catch (error) {\n      console.warn('ドラッグプレビュー更新エラー:', error);\n      // エラーが発生した場合はプレビューをクリア\n      setDragPreview(null);\n    }\n  };\n\n  const removeClip = (trackId, clipId) => {\n    setTracks(prevTracks => prevTracks.map(track => \n      track.id === trackId \n        ? { ...track, clips: track.clips.filter(clip => clip.id !== clipId) }\n        : track\n    ));\n  };\n\n  // クリップのドラッグ開始\n  const handleClipDragStart = (clip, originalTrackId, mouseX, clipElement) => {\n    \n    // クリップ内でのマウス位置のオフセットを計算\n    const clipRect = clipElement.getBoundingClientRect();\n    const offsetInClip = mouseX - clipRect.left;\n    \n    \n    setDraggedClip({ ...clip, originalTrackId });\n    setDragOffset(offsetInClip);\n  };\n\n  // ドラッグ状態の完全なクリーンアップ\n  const cleanupDragState = useCallback(() => {\n    \n    // ドラッグオーバーのタイムアウトをクリア\n    if (dragOverTimeoutRef.current) {\n      clearTimeout(dragOverTimeoutRef.current);\n      dragOverTimeoutRef.current = null;\n    }\n    \n    // 強制クリーンアップタイマーをクリア\n    if (window.dragCleanupTimer) {\n      clearTimeout(window.dragCleanupTimer);\n      window.dragCleanupTimer = null;\n    }\n    \n    // すべてのドラッグ関連の状態をリセット\n    setDraggedClip(null);\n    setDragPreview(null);\n    setDraggedSoundDuration(400);\n    setDragOffset(0);\n    \n    // DOM要素のクリーンアップ\n    document.querySelectorAll('.track').forEach(track => {\n      track.classList.remove('drag-over');\n    });\n    \n    // モバイル用のドラッグプレビューを削除\n    const mobileDragPreview = document.querySelector('.mobile-drag-preview');\n    if (mobileDragPreview) {\n      mobileDragPreview.remove();\n    }\n    \n    // グローバル変数のクリーンアップ\n    if (window.currentDraggedSoundBlob) {\n      window.currentDraggedSoundBlob = null;\n    }\n    if (window.currentDraggedSound) {\n      window.currentDraggedSound = null;\n    }\n    \n    // ボディクラスのクリーンアップ\n    document.body.classList.remove('dragging');\n  }, []);\n\n  // コンポーネントマウント時にグローバルコールバックを設定\n  useEffect(() => {\n    window.cleanupDragStateCallback = cleanupDragState;\n    \n    // グローバルなドラッグ終了イベントリスナーを追加\n    const handleGlobalDragEnd = () => {\n      cleanupDragState();\n    };\n\n    const handleGlobalDragLeave = (e) => {\n      // ドキュメント外にドラッグが出た場合\n      if (!e.relatedTarget || e.relatedTarget.nodeName === 'HTML') {\n        cleanupDragState();\n      }\n    };\n\n    // ドキュメントレベルでイベントリスナーを設定\n    document.addEventListener('dragend', handleGlobalDragEnd);\n    document.addEventListener('dragleave', handleGlobalDragLeave);\n    \n    // クリーンアップ関数\n    return () => {\n      if (window.cleanupDragStateCallback === cleanupDragState) {\n        window.cleanupDragStateCallback = null;\n      }\n      document.removeEventListener('dragend', handleGlobalDragEnd);\n      document.removeEventListener('dragleave', handleGlobalDragLeave);\n    };\n  }, [cleanupDragState]);\n\n  // ドラッグ終了時のクリーンアップ\n  const handleDragEnd = (e) => {\n    // ドロップが正常に処理されなかった場合、元の状態を保持\n    if (draggedClip && e && e.dataTransfer && e.dataTransfer.dropEffect === 'none') {\n    }\n    \n    // 完全なクリーンアップ\n    cleanupDragState();\n  };\n\n  const play = async () => {\n    try {\n      // AudioContextが中断されている場合は再開\n      if (audioContext && audioContext.state === 'suspended') {\n        await audioContext.resume();\n      }\n      \n      setIsPlaying(true);\n      \n      // 現在の時間位置に基づいて、再生すべきクリップを見つける\n      let pixelsPerSecond;\n      if (isTimeMode) {\n        pixelsPerSecond = PIXELS_PER_SECOND;\n      } else {\n        pixelsPerSecond = (bpm / 60) * 100;\n      }\n      \n      const currentTimeInSeconds = currentTime / pixelsPerSecond;\n      \n      // 各トラックのクリップを再生\n      const newPlayingAudios = new Map();\n      \n      tracks.forEach(track => {\n        track.clips.forEach(clip => {\n          // clip.durationが有効な値かチェック\n          if (!isFinite(clip.duration) || clip.duration <= 0) {\n            console.warn('無効なclip.duration:', clip.duration, 'クリップをスキップします');\n            return;\n          }\n          \n          const clipStartTimeInSeconds = clip.startTime / pixelsPerSecond;\n          const clipEndTimeInSeconds = clipStartTimeInSeconds + (clip.duration / pixelsPerSecond);\n          \n          // 計算結果が有効かチェック\n          if (!isFinite(clipStartTimeInSeconds) || !isFinite(clipEndTimeInSeconds)) {\n            console.warn('無効な時間計算:', { clipStartTimeInSeconds, clipEndTimeInSeconds });\n            return;\n          }\n          \n          // 現在の時間位置がクリップの範囲内または今後再生される場合\n          if (clipEndTimeInSeconds > currentTimeInSeconds) {\n            const delay = Math.max(0, clipStartTimeInSeconds - currentTimeInSeconds);\n            if (isFinite(delay) && delay >= 0) {\n              scheduleClipPlayback(clip, delay * 1000, newPlayingAudios);\n            }\n          }\n        });\n      });\n      \n      setPlayingAudios(newPlayingAudios);\n    } catch (error) {\n      console.error('再生エラー:', error);\n      setError('音声の再生に失敗しました。ブラウザで音声が有効になっているか確認してください。');\n    }\n  };\n\n  const scheduleClipPlayback = (clip, delayMs, playingAudiosMap) => {\n    \n    if (clip.soundData && clip.soundData.audioBlob && clip.soundData.audioBlob instanceof Blob) {\n      try {\n        const audio = new Audio();\n        const audioUrl = URL.createObjectURL(clip.soundData.audioBlob);\n        audio.src = audioUrl;\n        \n        const timeoutId = setTimeout(() => {\n          audio.play().catch(error => {\n            console.error('音声再生エラー:', error);\n            URL.revokeObjectURL(audioUrl); // メモリリークを防ぐ\n          });\n        }, delayMs);\n        \n        // 音声終了時にURLを解放\n        audio.addEventListener('ended', () => {\n          URL.revokeObjectURL(audioUrl);\n        });\n        \n        playingAudiosMap.set(clip.id, { audio, timeoutId, audioUrl });\n      } catch (error) {\n        console.error('createObjectURL エラー:', error, 'audioBlob:', clip.soundData.audioBlob);\n      }\n    } else {\n      console.warn('audioBlobが無効です。クリップ情報:', {\n        clipId: clip.id,\n        soundDataName: clip.soundData?.name,\n        hasAudioData: !!clip.soundData?.audioData,\n        hasAudioBlob: !!clip.soundData?.audioBlob,\n        audioBlobType: typeof clip.soundData?.audioBlob,\n        isInstanceOfBlob: clip.soundData?.audioBlob instanceof Blob\n      });\n      \n      // AudioBlobが無効な場合、audioDataから復元を試行\n      if (clip.soundData && clip.soundData.audioData && !clip.soundData.audioBlob) {\n        try {\n          const byteCharacters = atob(clip.soundData.audioData.split(',')[1]);\n          const byteNumbers = new Array(byteCharacters.length);\n          for (let i = 0; i < byteCharacters.length; i++) {\n            byteNumbers[i] = byteCharacters.charCodeAt(i);\n          }\n          const byteArray = new Uint8Array(byteNumbers);\n          const blob = new Blob([byteArray], { type: 'audio/wav' });\n          \n          // クリップのsoundDataを更新\n          clip.soundData.audioBlob = blob;\n          \n          // 再帰的に再試行\n          scheduleClipPlayback(clip, delayMs, playingAudiosMap);\n          return;\n        } catch (restoreError) {\n          console.error('audioDataからのBlob復元に失敗:', restoreError);\n        }\n      }\n    }\n  };\n\n  const pause = () => {\n    setIsPlaying(false);\n    \n    // 再生中の音声を一時停止\n    playingAudios.forEach(({ audio, timeoutId, audioUrl }) => {\n      if (timeoutId) {\n        clearTimeout(timeoutId);\n      }\n      if (!audio.paused) {\n        audio.pause();\n      }\n      // URLを解放\n      if (audioUrl) {\n        URL.revokeObjectURL(audioUrl);\n      }\n    });\n  };\n\n  const stop = () => {\n    setIsPlaying(false);\n    setCurrentTime(0);\n    \n    // 再生中の音声を停止\n    playingAudios.forEach(({ audio, timeoutId, audioUrl }) => {\n      if (timeoutId) {\n        clearTimeout(timeoutId);\n      }\n      audio.pause();\n      audio.currentTime = 0;\n      // URLを解放\n      if (audioUrl) {\n        URL.revokeObjectURL(audioUrl);\n      }\n    });\n    \n    setPlayingAudios(new Map());\n  };\n\n  // タイムラインデータの自動保存機能\n  useEffect(() => {\n    const autoSaveProject = () => {\n      try {\n        const projectData = {\n          version: '1.0',\n          bpm: bpm,\n          tracks: tracks,\n          timestamp: Date.now(),\n          trackNameCounter: trackNameCounterRef.current,\n          trackIdCounter: trackIdCounterRef.current,\n          isTimeMode: isTimeMode,\n          secondsPerBeat: secondsPerBeat\n        };\n\n        localStorage.setItem('dawProjectAutoSave', JSON.stringify(projectData));\n\n      } catch (error) {\n        console.error('プロジェクトの自動保存に失敗:', error);\n      }\n    };\n\n    // 初期化後の自動保存（tracksやbpmが変更された時）\n    if (tracks.length > 0) {\n      autoSaveProject();\n    }\n  }, [tracks, bpm, isTimeMode, secondsPerBeat]);\n\n  // 音素材の更新監視（他のページで音が追加された場合の対応）\n  useEffect(() => {\n    const handleVisibilityChange = () => {\n      if (!document.hidden) {\n        // ページが表示されたときに音素材を再読み込み\n        const savedSounds = JSON.parse(localStorage.getItem('soundRecordings') || '[]');\n        \n        // 音声データ復元処理（既存のロジックを再利用）\n        const soundsWithBlob = savedSounds.map(sound => {\n          if (sound.audioData) {\n            try {\n              const base64Data = sound.audioData.split(',')[1];\n              if (!base64Data || base64Data.length === 0) {\n                return sound;\n              }\n              \n              const byteCharacters = atob(base64Data);\n              const byteNumbers = new Array(byteCharacters.length);\n              for (let i = 0; i < byteCharacters.length; i++) {\n                byteNumbers[i] = byteCharacters.charCodeAt(i);\n              }\n              const byteArray = new Uint8Array(byteNumbers);\n              const blob = new Blob([byteArray], { type: 'audio/wav' });\n              \n              return { ...sound, audioBlob: blob };\n            } catch (error) {\n              console.error('音声データの復元に失敗:', sound.name, error);\n              return sound;\n            }\n          }\n          return sound;\n        });\n        \n        const validSounds = soundsWithBlob.filter(sound => \n          sound.audioBlob && sound.audioBlob instanceof Blob && sound.audioBlob.size > 0\n        );\n        \n        setSounds(validSounds);\n      }\n    };\n\n    document.addEventListener('visibilitychange', handleVisibilityChange);\n    \n    return () => {\n      document.removeEventListener('visibilitychange', handleVisibilityChange);\n    };\n  }, []);\n\n  // 自動保存データをクリアする機能\n  const clearAutoSave = () => {\n    try {\n      localStorage.removeItem('dawProjectAutoSave');\n      \n      // 初期状態にリセット\n      setTracks([{ \n        id: Date.now(), \n        name: 'トラック 1', \n        clips: [] \n      }]);\n      setBpm(120);\n      trackNameCounterRef.current = 1;\n      trackIdCounterRef.current = 1;\n      \n      setError(null);\n      alert('✅ プロジェクトをリセットしました');\n    } catch (error) {\n      console.error('自動保存データのクリアに失敗:', error);\n      setError('プロジェクトのリセットに失敗しました');\n    }\n  };\n\n  // 無効なクリップを除外する関数\n  const cleanupInvalidClips = () => {\n    setTracks(prevTracks => {\n      const cleanedTracks = prevTracks.map(track => ({\n        ...track,\n        clips: track.clips.filter(clip => {\n          if (!clip.soundData || !clip.soundData.name) {\n            console.warn('無効なクリップを除外:', clip);\n            return false;\n          }\n          return true;\n        })\n      }));\n      \n      const removedCount = prevTracks.reduce((total, track) => total + track.clips.length, 0) - \n                          cleanedTracks.reduce((total, track) => total + track.clips.length, 0);\n      \n      if (removedCount > 0) {\n      }\n      \n      return cleanedTracks;\n    });\n  };\n\n  // 初期化時に無効なクリップをクリーンアップ\n  useEffect(() => {\n    const timer = setTimeout(() => {\n      cleanupInvalidClips();\n    }, 1000); // 1秒後に実行\n\n    return () => clearTimeout(timer);\n  }, []);\n\n  // コンポーネントアンマウント時の包括的クリーンアップ\n  useEffect(() => {\n    return () => {\n      // ドラッグ状態のクリーンアップ\n      cleanupDragState();\n      \n      // 再生中の音声をすべて停止\n      setPlayingAudios(currentPlayingAudios => {\n        currentPlayingAudios.forEach(({ audio, timeoutId, audioUrl }) => {\n          if (timeoutId) {\n            clearTimeout(timeoutId);\n          }\n          if (audio) {\n            audio.pause();\n            audio.src = '';\n          }\n          if (audioUrl) {\n            URL.revokeObjectURL(audioUrl);\n          }\n        });\n        return new Map();\n      });\n      \n      // AudioContextをクリーンアップ\n      if (audioContext && audioContext.state !== 'closed') {\n        audioContext.close().catch(error => {\n          console.warn('AudioContext のクローズに失敗:', error);\n        });\n      }\n      \n      // アニメーションフレームをクリア\n      if (animationFrameRef.current) {\n        cancelAnimationFrame(animationFrameRef.current);\n      }\n      \n      // タイムアウトをクリア\n      if (dragOverTimeoutRef.current) {\n        clearTimeout(dragOverTimeoutRef.current);\n      }\n    };\n  }, [cleanupDragState, audioContext]);\n\n  return (\n    <div className=\"daw-page\">\n      <h2>🎹 音楽づくりページ</h2>\n      <p>音素材をドラッグ&ドロップして音楽を作りましょう！</p>\n\n      {error && (\n        <div className=\"error-message\">\n          <span>⚠️ {error}</span>\n          <button onClick={() => setError(null)}>×</button>\n        </div>\n      )}\n\n      <div className=\"daw-controls card\">\n        {/* 上段：音素材表示切り替え、保存関連機能 */}\n        <div className=\"top-controls-row\">\n          <div className=\"left-controls\">\n            <button \n              className=\"button-secondary\" \n              onClick={() => setShowSoundPanel(!showSoundPanel)}\n            >\n              {showSoundPanel ? '🎵 音素材を隠す' : '🎵 音素材を表示'}\n            </button>\n          </div>\n\n          <div className=\"right-controls\">\n            <div className=\"project-controls\">\n              <button className=\"button-secondary\" onClick={saveProject}>\n                💾 プロジェクト保存\n              </button>\n              <label className=\"button-secondary file-input-label\">\n                📁 プロジェクト読み込み\n                <input\n                  type=\"file\"\n                  accept=\".json\"\n                  onChange={loadProject}\n                  style={{ display: 'none' }}\n                />\n              </label>\n            <button \n              className=\"button-warning\" \n              onClick={() => {\n                if (window.confirm('🗑️ プロジェクトをリセットしますか？\\n\\n現在の作業内容がすべて削除されます。')) {\n                  clearAutoSave();\n                }\n              }}\n              title=\"プロジェクトをリセット（自動保存データもクリア）\"\n            >\n              🗑️ リセット\n            </button>\n            <button \n              className=\"button-primary\" \n              onClick={exportAudio}\n              disabled={isExporting}\n            >\n              {isExporting ? '🔄 出力中...' : '🎧 音源出力'}\n            </button>\n            </div>\n          </div>\n        </div>\n\n        {/* 下段：再生コントロール、BPM、モード設定 */}\n        <div className=\"bottom-controls-row\">\n          <div className=\"transport-controls\">\n            <button \n              className={`transport-btn play-btn ${isPlaying ? 'playing' : ''}`}\n              onClick={isPlaying ? pause : play}\n            >\n              {isPlaying ? '⏸️' : '▶️'}\n            </button>\n            <button className=\"transport-btn stop-btn\" onClick={stop}>\n              ⏹️\n            </button>\n          </div>\n\n          <div className=\"timing-controls\">\n            {!isTimeMode && (\n              <div className=\"bpm-control\">\n                <label htmlFor=\"bpm\">🎵 BPM:</label>\n                <input\n                  id=\"bpm\"\n                  type=\"number\"\n                  value={bpm}\n                  onChange={(e) => handleBpmChange(parseInt(e.target.value))}\n                  min=\"60\"\n                  max=\"200\"\n                  className=\"bpm-input\"\n                />\n              </div>\n            )}\n\n            <div className=\"time-mode-control\">\n              <button \n                className={`time-mode-toggle ${isTimeMode ? 'active' : ''}`}\n                onClick={toggleTimeMode}\n                title={isTimeMode ? '拍子モードに切り替え' : '秒数モードに切り替え'}\n              >\n                ⏰ {isTimeMode ? '秒数モード' : '拍子モード'}\n              </button>\n              \n              {isTimeMode && (\n                <div className=\"seconds-per-beat-control\">\n                  <label htmlFor=\"secondsPerBeat\">1拍:</label>\n                  <input\n                    id=\"secondsPerBeat\"\n                    type=\"number\"\n                    value={secondsPerBeat}\n                    onChange={(e) => handleSecondsPerBeatChange(parseFloat(e.target.value))}\n                    min=\"0.1\"\n                    max=\"5.0\"\n                    step=\"0.1\"\n                    className=\"seconds-input\"\n                  />\n                  <span>秒</span>\n                </div>\n              )}\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"daw-main-area\">\n        <div className={`sound-panel ${!showSoundPanel ? 'panel-hidden' : ''}`}>\n          <div className=\"sound-panel-header\">\n            <h3>🎵 音素材</h3>\n            <button \n              className=\"sound-panel-close\"\n              onClick={() => setShowSoundPanel(false)}\n              title=\"音素材パネルを閉じる\"\n            >\n              ✕\n            </button>\n          </div>\n          <div className=\"sound-list\">\n            {sounds.length > 0 ? (\n              sounds.map(sound => (\n                <SoundItem \n                  key={sound.id} \n                  sound={sound} \n                  onDragStart={async (sound) => {\n                    // ドラッグ開始時に音声の長さを計算\n                    if (sound.audioBlob) {\n                      try {\n                        const duration = await getAudioDuration(sound.audioBlob, bpm);\n                        setDraggedSoundDuration(duration);\n                      } catch (error) {\n                        console.warn('ドラッグ時の音声長さ計算に失敗:', error);\n                        setDraggedSoundDuration(400);\n                      }\n                    } else {\n                      setDraggedSoundDuration(400);\n                    }\n                  }}\n                />\n              ))\n            ) : (\n              <div className=\"no-sounds\">\n                <p>音素材がありません</p>\n                <p>「音あつめ」ページで音を録音してください</p>\n              </div>\n            )}\n          </div>\n        </div>\n\n        <div className={`daw-workspace ${!showSoundPanel ? 'panel-hidden' : ''}`}>\n          <div className=\"track-headers\">\n            <div className=\"timeline-header-spacer\">\n              タイムライン\n            </div>\n            {tracks.map((track, index) => (\n              <TrackHeader \n                key={track.id} \n                track={track} \n                trackIndex={index}\n                onRemove={removeTrack}\n                trackHeight={trackHeight}\n              />\n            ))}\n            <div className=\"track-add-button-container\" style={{ height: trackHeight }}>\n              <button className=\"button-primary track-add-btn\" onClick={addTrack}>\n                ➕ トラック追加\n              </button>\n            </div>\n          </div>\n\n          <div className=\"timeline-container\">\n            <Timeline bpm={bpm} isTimeMode={isTimeMode} secondsPerBeat={secondsPerBeat} />\n            <div \n              className=\"tracks-area\" \n              ref={timelineRef} \n              style={{ \n                minWidth: isTimeMode \n                  ? TIME_MODE_TOTAL_SECONDS * PIXELS_PER_SECOND \n                  : TOTAL_MEASURES * MEASURE_WIDTH \n              }}\n            >\n              <Playhead currentTime={currentTime} />\n              {dragPreview && (\n                <div \n                  className=\"drag-preview\"\n                  style={{\n                    left: dragPreview.left,\n                    top: dragPreview.top,\n                    width: dragPreview.width\n                  }}\n                />\n              )}\n              {tracks.map((track) => (\n                <Track\n                  key={track.id}\n                  track={track}\n                  onDrop={handleDrop}\n                  onDragOver={handleDragOver}\n                  onRemoveClip={removeClip}\n                  onClipDragStart={handleClipDragStart}\n                  onDragEnd={handleDragEnd}\n                  trackHeight={trackHeight}\n                  updateDragPreview={updateDragPreview}\n                  isTimeMode={isTimeMode}\n                  secondsPerBeat={secondsPerBeat}\n                />\n              ))}\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"instructions card\">\n        <h3>📖 使い方</h3>\n        <ul>\n          <li><strong>🖥️ PC:</strong> 左側の音素材パネルから音素材をトラックにドラッグ&ドロップして配置</li>\n          <li><strong>📱 スマホ/タブレット:</strong> 音素材を長押ししてからトラックまでドラッグして配置</li>\n          <li>配置済みの音素材もドラッグして別の場所に移動できます</li>\n          <li>ドラッグ中は配置予定位置に青い影が表示されます</li>\n          <li><strong>⏰ 時間モード切り替え:</strong> 「拍子モード」と「秒数モード」を切り替えできます</li>\n          <li><strong>拍子モード:</strong> 8分音符（裏拍含む）に合わせて音素材が自動配置され、BPMで速さを調整</li>\n          <li><strong>秒数モード:</strong> 小節や拍子の概念をなくし、「何秒で1拍」という単位で音素材を配置</li>\n          <li>音素材パネルの▶️ボタンで個別に音を確認できます</li>\n          <li>▶️ボタンで再生、⏸️ボタンで一時停止、⏹️ボタンで停止</li>\n          <li>トラックを追加して複数の音を重ねることができます</li>\n          <li><strong>💾 プロジェクト保存:</strong> 編集中のデータをJSONファイルとして保存</li>\n          <li><strong>📁 プロジェクト読み込み:</strong> 保存したプロジェクトファイルを読み込んで編集を再開</li>\n          <li><strong>🎧 音源出力:</strong> 完成した楽曲をWAVファイルとして出力</li>\n          <li><strong>🗑️ リセット:</strong> 現在のプロジェクトをリセットして新しく始める</li>\n        </ul>\n        <div className=\"auto-save-info\">\n          <h4>💾 自動保存機能</h4>\n          <ul>\n            <li><strong>自動保存:</strong> トラック、BPM、時間モード設定の変更は自動的に保存されます</li>\n            <li><strong>他ページとの連携:</strong> 「音あつめ」ページで録音した音は自動的に反映されます</li>\n            <li><strong>復元機能:</strong> ページをリロードしても作業内容が自動的に復元されます</li>\n            <li><strong>安心して移動:</strong> 他のページに移動しても作業内容は保持されます</li>\n          </ul>\n        </div>\n        <div className=\"mobile-tips\">\n          <h4>📱 スマートフォン利用のコツ</h4>\n          <ul>\n            <li>音素材を軽く長押しするとドラッグモードになります</li>\n            <li>ドラッグ中は画面がスクロールしないよう制御されます</li>\n            <li>青くハイライトされたトラックで指を離すと音素材が配置されます</li>\n            <li>横画面表示にするとより使いやすくなります</li>\n          </ul>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nconst SoundItem = ({ sound, onDragStart }) => {\n  const [isPlaying, setIsPlaying] = useState(false);\n  const [isDragging, setIsDragging] = useState(false);\n  const [touchStart, setTouchStart] = useState(null);\n  const [touchMove, setTouchMove] = useState(null);\n\n  const handleDragStart = (e) => {\n    // audioBlob以外のデータをJSON文字列として設定\n    const soundDataForTransfer = {\n      ...sound,\n      audioBlob: null // Blobは直接シリアライズできないため一時的にnullに\n    };\n    \n    e.dataTransfer.setData('application/json', JSON.stringify(soundDataForTransfer));\n    e.dataTransfer.effectAllowed = 'copy';\n    \n    // 実際のaudioBlobは別途グローバル変数で保持\n    window.currentDraggedSoundBlob = sound.audioBlob;\n    \n    // 親コンポーネントのonDragStart関数を呼び出し（音声の長さを計算）\n    if (onDragStart) {\n      onDragStart(sound);\n    }\n  };\n\n  // タッチイベント対応\n  const handleTouchStart = (e) => {\n    const touch = e.touches[0];\n    setTouchStart({ x: touch.clientX, y: touch.clientY });\n    setIsDragging(false);\n    \n    // 長押し判定用のタイマーは設定せず、移動検知でのみドラッグを開始\n  };\n\n  const handleTouchMove = (e) => {\n    if (!touchStart) return;\n    \n    const touch = e.touches[0];\n    const currentPos = { x: touch.clientX, y: touch.clientY };\n    setTouchMove(currentPos);\n    \n    // ドラッグ開始の判定（15px以上移動）- 閾値を上げてより意図的な移動のみドラッグ扱い\n    const deltaX = Math.abs(currentPos.x - touchStart.x);\n    const deltaY = Math.abs(currentPos.y - touchStart.y);\n    \n    if (!isDragging && (deltaX > 15 || deltaY > 15)) {\n      setIsDragging(true);\n      // スクロールを一時的に無効化（移動が確定してから）\n      document.body.classList.add('dragging');\n      \n      // 親コンポーネントのonDragStart関数を呼び出し\n      if (onDragStart) {\n        onDragStart(sound);\n      }\n      // グローバル変数に設定\n      window.currentDraggedSoundBlob = sound.audioBlob;\n      window.currentDraggedSound = sound;\n    }\n    \n    if (isDragging) {\n      // passiveイベントではpreventDefaultが使えないので、代わりにtouchActionでスクロールを制御\n      \n      // ドラッグプレビューの位置を更新\n      const dragPreview = document.querySelector('.mobile-drag-preview');\n      if (dragPreview) {\n        dragPreview.style.left = `${currentPos.x - 50}px`;\n        dragPreview.style.top = `${currentPos.y - 20}px`;\n      }\n      \n      // ドロップターゲットのハイライト\n      const elementBelow = document.elementFromPoint(currentPos.x, currentPos.y);\n      const trackElement = elementBelow?.closest('.track');\n      \n      // 既存のハイライトを削除\n      document.querySelectorAll('.track').forEach(track => {\n        track.classList.remove('drag-over');\n      });\n      \n      // 新しいハイライトを追加\n      if (trackElement) {\n        trackElement.classList.add('drag-over');\n      }\n    }\n  };\n\n  const handleTouchEnd = (e) => {\n    if (isDragging && touchMove) {\n      // ドロップ処理\n      const elementBelow = document.elementFromPoint(touchMove.x, touchMove.y);\n      const trackElement = elementBelow?.closest('.track');\n      \n      if (trackElement) {\n        const trackId = parseInt(trackElement.dataset.trackId);\n        const rect = trackElement.getBoundingClientRect();\n        const timePosition = touchMove.x - rect.left;\n        \n        // ドロップイベントを発火\n        const dropEvent = new CustomEvent('mobileDrop', {\n          detail: {\n            trackId,\n            timePosition,\n            sound: sound\n          }\n        });\n        trackElement.dispatchEvent(dropEvent);\n      }\n    }\n    \n    // クリーンアップ\n    setTouchStart(null);\n    setTouchMove(null);\n    setIsDragging(false);\n    \n    // SoundItem 内での直接クリーンアップ\n    document.body.classList.remove('dragging');\n    \n    // ハイライトを削除\n    document.querySelectorAll('.track').forEach(track => {\n      track.classList.remove('drag-over');\n    });\n    \n    // モバイル用のドラッグプレビューを削除\n    const mobileDragPreview = document.querySelector('.mobile-drag-preview');\n    if (mobileDragPreview) {\n      mobileDragPreview.remove();\n    }\n    \n    // グローバル変数をクリア\n    if (window.currentDraggedSoundBlob) {\n      window.currentDraggedSoundBlob = null;\n    }\n    if (window.currentDraggedSound) {\n      window.currentDraggedSound = null;\n    }\n  };\n\n  const playSound = () => {\n    if (sound.audioBlob && !isPlaying && !isDragging) {\n      // Blobの有効性をチェック\n      if (!(sound.audioBlob instanceof Blob) || sound.audioBlob.size === 0) {\n        console.error('無効なaudioBlob:', {\n          name: sound.name,\n          isBlob: sound.audioBlob instanceof Blob,\n          size: sound.audioBlob?.size\n        });\n        return;\n      }\n      \n      const audio = new Audio();\n      let audioUrl;\n      \n      try {\n        audioUrl = URL.createObjectURL(sound.audioBlob);\n        audio.src = audioUrl;\n        \n        audio.play()\n          .then(() => {\n            setIsPlaying(true);\n            \n            const handleEnded = () => {\n              setIsPlaying(false);\n              if (audioUrl) {\n                URL.revokeObjectURL(audioUrl); // URLをクリーンアップ\n              }\n              audio.removeEventListener('ended', handleEnded);\n            };\n            \n            audio.addEventListener('ended', handleEnded);\n            \n            // 音声の読み込みエラーもハンドリング\n            audio.addEventListener('error', (error) => {\n              console.error('音声読み込みエラー:', error);\n              setIsPlaying(false);\n              if (audioUrl) {\n                URL.revokeObjectURL(audioUrl);\n              }\n            });\n          })\n          .catch(error => {\n            console.error('音声再生エラー:', error);\n            if (audioUrl) {\n              URL.revokeObjectURL(audioUrl); // エラー時もクリーンアップ\n            }\n            setIsPlaying(false);\n          });\n      } catch (error) {\n        console.error('createObjectURLエラー:', error);\n        setIsPlaying(false);\n      }\n    } else {\n      console.error('再生条件不満足:', {\n        hasAudioBlob: !!sound.audioBlob,\n        isPlaying,\n        isDragging\n      });\n    }\n  };\n\n  // ドラッグプレビューを作成\n  const createDragPreview = useCallback(() => {\n    if (isDragging && touchMove) {\n      let dragPreview = document.querySelector('.mobile-drag-preview');\n      if (!dragPreview) {\n        dragPreview = document.createElement('div');\n        dragPreview.className = 'mobile-drag-preview';\n        dragPreview.textContent = sound.name;\n        dragPreview.style.cssText = `\n          position: fixed;\n          background: rgba(0, 123, 255, 0.8);\n          color: white;\n          padding: 5px 10px;\n          border-radius: 4px;\n          font-size: 12px;\n          pointer-events: none;\n          z-index: 1000;\n          left: ${touchMove.x - 50}px;\n          top: ${touchMove.y - 20}px;\n        `;\n        document.body.appendChild(dragPreview);\n      }\n    }\n  }, [isDragging, touchMove, sound.name]);\n\n  // ドラッグプレビューの更新\n  React.useEffect(() => {\n    if (isDragging) {\n      createDragPreview();\n    }\n  }, [isDragging, touchMove, createDragPreview]);\n\n  return (\n    <div\n      className={`sound-item ${isDragging ? 'dragging' : ''}`}\n      draggable=\"true\"\n      onDragStart={handleDragStart}\n      onTouchStart={handleTouchStart}\n      onTouchMove={handleTouchMove}\n      onTouchEnd={handleTouchEnd}\n    >\n      <div className=\"sound-info\">\n        <h4>{sound.name}</h4>\n        <div className=\"sound-tags\">\n          {sound.tags.map((tag, index) => (\n            <span key={index} className=\"sound-tag\">{tag}</span>\n          ))}\n        </div>\n      </div>\n      <div className=\"sound-actions\">\n        <button \n          className=\"play-sound-btn\"\n          onClick={playSound}\n          disabled={isPlaying}\n        >\n          {isPlaying ? '⏸️' : '▶️'}\n        </button>\n      </div>\n    </div>\n  );\n};\n\nconst TrackHeader = ({ track, onRemove, trackHeight, trackIndex }) => {\n  // トラック名を表示番号と元の名前で構成\n  const displayName = `トラック ${trackIndex + 1}`;\n  \n  return (\n    <div className=\"track-header\" style={{ height: trackHeight }}>\n      <div className=\"track-info\">\n        <h4>{displayName}</h4>\n        <div className=\"track-actions\">\n          <button \n            className=\"remove-track-btn\"\n            onClick={() => onRemove(track.id)}\n            title={`${displayName}を削除`}\n            aria-label={`${displayName}を削除`}\n          >\n            🗑️\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nconst Timeline = ({ bpm, isTimeMode, secondsPerBeat }) => {\n  if (isTimeMode) {\n    // 秒数モード: 秒単位で表示\n    const totalSeconds = TIME_MODE_TOTAL_SECONDS;\n    const secondWidth = PIXELS_PER_SECOND;\n    \n    return (\n      <div className=\"timeline\" style={{ minWidth: totalSeconds * secondWidth }}>\n        {Array.from({ length: totalSeconds / 5 }, (_, intervalIndex) => (\n          <div key={intervalIndex} className=\"time-interval\">\n            <div className=\"time-number\">{intervalIndex * 5}秒</div>\n            <div className=\"time-marks\">\n              {Array.from({ length: 5 }, (_, secondIndex) => (\n                <div \n                  key={secondIndex} \n                  className=\"time-mark\"\n                  style={{ width: secondWidth }}\n                >\n                  <div className=\"time-main\">\n                    {intervalIndex * 5 + secondIndex}\n                  </div>\n                  <div className=\"time-sub\">\n                    <div className=\"sub-time-marker\">・</div>\n                  </div>\n                </div>\n              ))}\n            </div>\n          </div>\n        ))}\n      </div>\n    );\n  } else {\n    // 拍子モード: 従来の小節・拍表示\n    const measures = TOTAL_MEASURES; // 16小節表示\n    const beatsPerMeasure = BEATS_PER_MEASURE; // 4/4拍子\n\n    return (\n      <div className=\"timeline\" style={{ minWidth: TOTAL_MEASURES * MEASURE_WIDTH }}>\n        {Array.from({ length: measures }, (_, measureIndex) => (\n          <div key={measureIndex} className=\"measure\">\n            <div className=\"measure-number\">{measureIndex + 1}</div>\n            <div className=\"beats\">\n              {Array.from({ length: beatsPerMeasure }, (_, beatIndex) => (\n                <div \n                  key={beatIndex} \n                  className=\"beat\"\n                  style={{ width: BEAT_WIDTH }}\n                >\n                  <div className=\"beat-main\">\n                    {beatIndex + 1}\n                  </div>\n                  <div className=\"beat-sub\">\n                    <div className=\"sub-beat-marker\">・</div>\n                  </div>\n                </div>\n              ))}\n            </div>\n          </div>\n        ))}\n      </div>\n    );\n  }\n};\n\nconst Track = ({ track, onDrop, onDragOver, onRemoveClip, onClipDragStart, onDragEnd, trackHeight, updateDragPreview, isTimeMode, secondsPerBeat }) => {\n  const handleDrop = (e) => {\n    const rect = e.currentTarget.getBoundingClientRect();\n    const timePosition = e.clientX - rect.left;\n    onDrop(e, track.id, timePosition);\n  };\n\n  // モバイルドロップイベントの処理\n  const handleMobileDrop = useCallback((e) => {\n    const { trackId, timePosition, sound } = e.detail;\n    \n    // 模擬的なドロップイベントを作成\n    const mockDropEvent = {\n      preventDefault: () => {},\n      dataTransfer: {\n        getData: (type) => {\n          if (type === 'application/json') {\n            return JSON.stringify(sound);\n          }\n          return '';\n        }\n      }\n    };\n    \n    onDrop(mockDropEvent, trackId, timePosition);\n  }, [onDrop]);\n\n  // モバイルクリップ移動イベントの処理\n  const handleMobileClipMove = useCallback((e) => {\n    const { clip, newTrackId, timePosition } = e.detail;\n    \n    // 模擬的なドロップイベントを作成\n    const mockDropEvent = {\n      preventDefault: () => {},\n      dataTransfer: {\n        getData: (type) => {\n          if (type === 'text/plain') {\n            return `existing-clip-${clip.id}`;\n          }\n          return '';\n        }\n      }\n    };\n    \n    onDrop(mockDropEvent, newTrackId, timePosition);\n  }, [onDrop]);\n\n  const handleUpdateDragPreview = useCallback((e) => {\n    const { clientX, trackElement } = e.detail;\n    // 親コンポーネントのupdateDragPreview関数を呼び出し\n    if (typeof updateDragPreview === 'function') {\n      updateDragPreview(clientX, trackElement);\n    }\n  }, [updateDragPreview]);\n\n  React.useEffect(() => {\n    const trackElement = document.querySelector(`[data-track-id=\"${track.id}\"]`);\n    if (trackElement) {\n      trackElement.addEventListener('mobileDrop', handleMobileDrop);\n      trackElement.addEventListener('mobileClipMove', handleMobileClipMove);\n      trackElement.addEventListener('updateDragPreview', handleUpdateDragPreview);\n      return () => {\n        trackElement.removeEventListener('mobileDrop', handleMobileDrop);\n        trackElement.removeEventListener('mobileClipMove', handleMobileClipMove);\n        trackElement.removeEventListener('updateDragPreview', handleUpdateDragPreview);\n      };\n    }\n  }, [track.id, handleMobileDrop, handleMobileClipMove, handleUpdateDragPreview]);\n\n  return (\n    <div \n      className=\"track\"\n      style={{ height: trackHeight }}\n      data-track-id={track.id}\n      onDrop={handleDrop}\n      onDragOver={onDragOver}\n    >\n      <div className=\"track-grid\">\n        {isTimeMode ? (\n          // 秒数モード: 秒単位でグリッド線を表示\n          <>\n            {/* 1秒ごとの主要な境界線 */}\n            {Array.from({ length: TIME_MODE_TOTAL_SECONDS }, (_, index) => (\n              <div \n                key={`time-main-${index}`} \n                className={`beat-line beat-line-main ${index === 0 ? 'first-beat' : ''} ${index % 5 === 0 ? 'measure-start' : ''}`} \n                style={{ left: index * PIXELS_PER_SECOND }} \n              />\n            ))}\n            {/* 0.5秒ごとの副次的な境界線 */}\n            {Array.from({ length: TIME_MODE_TOTAL_SECONDS * 2 }, (_, index) => {\n              if (index % 2 === 1) { // 奇数のインデックス（0.5秒、1.5秒など）\n                return (\n                  <div \n                    key={`time-sub-${index}`} \n                    className=\"beat-line beat-line-sub\" \n                    style={{ left: (index * PIXELS_PER_SECOND) / 2 }} \n                  />\n                );\n              }\n              return null;\n            })}\n          </>\n        ) : (\n          // 拍子モード: 従来の拍・小節グリッド\n          <>\n            {/* 表拍（主要な拍）の境界線を表示 */}\n            {Array.from({ length: TOTAL_BEATS }, (_, index) => {\n              const isFirstBeat = index === 0;\n              const isMeasureStart = index % BEATS_PER_MEASURE === 0;\n              const className = `beat-line beat-line-main ${isFirstBeat ? 'first-beat' : ''} ${isMeasureStart ? 'measure-start' : ''}`;\n              return (\n                <div key={`main-${index}`} className={className} style={{ left: index * BEAT_WIDTH }} />\n              );\n            })}\n            {/* 裏拍（8分音符）の境界線を表示 */}\n            {Array.from({ length: TOTAL_BEATS }, (_, index) => (\n              <div key={`sub-${index}`} className=\"beat-line beat-line-sub\" style={{ left: index * BEAT_WIDTH + SUB_BEAT_WIDTH }} />\n            ))}\n          </>\n        )}\n      </div>\n      \n      {track.clips.map(clip => (\n        <AudioClip\n          key={clip.id}\n          clip={clip}\n          trackId={track.id}\n          onRemove={() => onRemoveClip(track.id, clip.id)}\n          onDragStart={onClipDragStart}\n          onDragEnd={onDragEnd}\n        />\n      ))}\n    </div>\n  );\n};\n\nconst AudioClip = ({ clip, trackId, onRemove, onDragStart, onDragEnd }) => {\n  const [waveformData, setWaveformData] = React.useState([]);\n  const [isDragging, setIsDragging] = React.useState(false);\n  const [touchStart, setTouchStart] = React.useState(null);\n  const [touchMove, setTouchMove] = React.useState(null);\n\n  React.useEffect(() => {\n    // clip.soundData が存在する場合のみ波形データを生成\n    if (clip && clip.soundData) {\n      // 簡単な波形データ生成（実際の実装では音声解析が必要）\n      const generateWaveform = () => {\n        const points = 20; // 波形のポイント数\n        const data = [];\n        for (let i = 0; i < points; i++) {\n          data.push(Math.random() * 0.8 + 0.2); // 0.2-1.0の間のランダム値\n        }\n        setWaveformData(data);\n      };\n\n      generateWaveform();\n    }\n  }, [clip, clip?.soundData]);\n\n  // clip.soundData の安全性をチェック（Hooksの後で）\n  if (!clip || !clip.soundData) {\n    console.warn('無効なクリップデータ:', clip);\n    return null; // 無効なクリップは表示しない\n  }\n\n  const handleDragStart = (e) => {\n    e.stopPropagation(); // イベントバブリングを防ぐ\n    \n    // ドラッグデータに既存クリップの情報を設定\n    e.dataTransfer.setData('text/plain', `existing-clip-${clip.id}`);\n    e.dataTransfer.effectAllowed = 'move';\n    \n    // onDragStartコールバックを呼び出し（マウス位置とクリップ要素を渡す）\n    onDragStart(clip, trackId, e.clientX, e.currentTarget);\n  };\n\n  const handleDragEnd = (e) => {\n    // ドラッグ終了時にクリーンアップを呼び出し\n    if (onDragEnd) {\n      onDragEnd(e);\n    }\n  };\n\n  // タッチイベント対応（クリップの移動）\n  const handleTouchStart = (e) => {\n    e.stopPropagation();\n    const touch = e.touches[0];\n    setTouchStart({ x: touch.clientX, y: touch.clientY });\n    setIsDragging(false);\n    \n    // ドラッグモードは移動が確定してから有効化\n  };\n\n  const handleTouchMove = (e) => {\n    if (!touchStart) return;\n    \n    const touch = e.touches[0];\n    const currentPos = { x: touch.clientX, y: touch.clientY };\n    setTouchMove(currentPos);\n    \n    // ドラッグ開始の判定（10px以上移動）\n    const deltaX = Math.abs(currentPos.x - touchStart.x);\n    const deltaY = Math.abs(currentPos.y - touchStart.y);\n    \n    if (!isDragging && (deltaX > 10 || deltaY > 10)) {\n      setIsDragging(true);\n      // スクロールを一時的に無効化（移動が確定してから）\n      document.body.classList.add('dragging');\n      onDragStart(clip, trackId, touchStart.x, e.currentTarget);\n    }\n    \n    if (isDragging) {\n      // passiveイベントではpreventDefaultが使えないので、touchActionで制御\n      \n      // ドロップターゲットのハイライト\n      const elementBelow = document.elementFromPoint(currentPos.x, currentPos.y);\n      const trackElement = elementBelow?.closest('.track');\n      \n      // 既存のハイライトを削除\n      document.querySelectorAll('.track').forEach(track => {\n        track.classList.remove('drag-over');\n      });\n      \n      // 新しいハイライトを追加（自分のトラック以外も含む）\n      if (trackElement) {\n        trackElement.classList.add('drag-over');\n        \n        // ドラッグプレビューも更新（onDragStart時と同様のロジック）\n        if (onDragStart) {\n          // 親コンポーネントのupdateDragPreview関数を呼び出すためのカスタムイベント\n          const dragPreviewEvent = new CustomEvent('updateDragPreview', {\n            detail: {\n              clientX: currentPos.x,\n              trackElement: trackElement\n            }\n          });\n          trackElement.dispatchEvent(dragPreviewEvent);\n        }\n      }\n    }\n  };\n\n  const handleTouchEnd = (e) => {\n    if (isDragging && touchMove) {\n      // ドロップ処理\n      const elementBelow = document.elementFromPoint(touchMove.x, touchMove.y);\n      const trackElement = elementBelow?.closest('.track');\n      \n      if (trackElement) {\n        const newTrackId = parseInt(trackElement.dataset.trackId);\n        const rect = trackElement.getBoundingClientRect();\n        const timePosition = touchMove.x - rect.left;\n        \n        // 既存クリップの移動イベントを発火\n        const moveEvent = new CustomEvent('mobileClipMove', {\n          detail: {\n            clip,\n            originalTrackId: trackId,\n            newTrackId,\n            timePosition\n          }\n        });\n        trackElement.dispatchEvent(moveEvent);\n      }\n    }\n    \n    // クリーンアップ\n    setTouchStart(null);\n    setTouchMove(null);\n    setIsDragging(false);\n    document.body.classList.remove('dragging');\n    \n    // ハイライトを削除\n    document.querySelectorAll('.track').forEach(track => {\n      track.classList.remove('drag-over');\n    });\n    \n    // ドラッグプレビューをクリア（親コンポーネントの状態もリセット）\n    if (onDragEnd) {\n      onDragEnd(null); // nullを渡してガード条件を満たす\n    }\n  };\n\n  return (\n    <div \n      className={`audio-clip ${isDragging ? 'dragging' : ''}`}\n      draggable=\"true\"\n      onDragStart={handleDragStart}\n      onDragEnd={handleDragEnd}\n      onTouchStart={handleTouchStart}\n      onTouchMove={handleTouchMove}\n      onTouchEnd={handleTouchEnd}\n      style={{\n        left: clip.startTime,\n        width: isFinite(clip.duration) && clip.duration > 0 ? clip.duration : 400 // デフォルト1小節\n      }}\n    >\n      <div className=\"clip-header\">\n        <span className=\"clip-name\">{clip.soundData?.name || '不明な音素材'}</span>\n        <button \n          className=\"remove-clip-btn\"\n          onClick={onRemove}\n          title=\"クリップを削除\"\n        >\n          ×\n        </button>\n      </div>\n      <div className=\"clip-waveform\">\n        {waveformData.length > 0 ? (\n          <svg className=\"waveform-svg\" width=\"100%\" height=\"30\">\n            {waveformData.map((height, index) => (\n              <rect\n                key={index}\n                x={`${(index / waveformData.length) * 100}%`}\n                y={`${(1 - height) * 15}`}\n                width={`${80 / waveformData.length}%`}\n                height={`${height * 30}`}\n                fill=\"rgba(255, 255, 255, 0.8)\"\n              />\n            ))}\n          </svg>\n        ) : (\n          <div className=\"waveform-placeholder\">🔊</div>\n        )}\n      </div>\n    </div>\n  );\n};\n\nconst Playhead = ({ currentTime }) => {\n  // currentTimeが有効な数値かチェック\n  const safeCurrentTime = isFinite(currentTime) && currentTime >= 0 ? currentTime : 0;\n  \n  return (\n    <div \n      className=\"playhead\"\n      style={{ left: safeCurrentTime }}\n    />\n  );\n};\n\nexport default DAWPage;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}