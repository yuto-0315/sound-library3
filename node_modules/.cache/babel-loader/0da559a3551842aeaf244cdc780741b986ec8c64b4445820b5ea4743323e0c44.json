{"ast":null,"code":"var _jsxFileName = \"/Users/nakataniyuutomo/Desktop/Programing/\\u30BB\\u3099\\u30DF\\u958B\\u767A/sound-library2/src/pages/DAWPage.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useRef, useEffect } from 'react';\nimport './DAWPage.css';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst DAWPage = () => {\n  _s();\n  const [tracks, setTracks] = useState([{\n    id: 1,\n    name: 'トラック 1',\n    clips: []\n  }]);\n  const [bpm, setBpm] = useState(120);\n  const [isPlaying, setIsPlaying] = useState(false);\n  const [currentTime, setCurrentTime] = useState(0);\n  const [audioContext, setAudioContext] = useState(null);\n  const [trackHeight] = useState(80);\n  const [playingAudios, setPlayingAudios] = useState(new Map());\n  const [startPlayTime, setStartPlayTime] = useState(null);\n  const timelineRef = useRef(null);\n  const playheadRef = useRef(null);\n  const animationFrameRef = useRef(null);\n  useEffect(() => {\n    // Web Audio API の初期化\n    const ctx = new (window.AudioContext || window.webkitAudioContext)();\n    setAudioContext(ctx);\n    return () => {\n      if (ctx) {\n        ctx.close();\n      }\n      if (animationFrameRef.current) {\n        cancelAnimationFrame(animationFrameRef.current);\n      }\n    };\n  }, []);\n\n  // 音声ファイルの継続時間を取得\n  const getAudioDuration = audioBlob => {\n    return new Promise(resolve => {\n      const audio = new Audio();\n      audio.addEventListener('loadedmetadata', () => {\n        resolve(audio.duration * 100); // 秒からピクセルに変換（1秒=100px）\n      });\n      audio.addEventListener('error', () => {\n        resolve(200); // エラーの場合はデフォルト値\n      });\n      audio.src = URL.createObjectURL(audioBlob);\n    });\n  };\n\n  // プレイヘッドのアニメーション更新\n  const updatePlayhead = () => {\n    if (isPlaying && startPlayTime) {\n      const elapsed = (Date.now() - startPlayTime) / 1000; // 経過時間（秒）\n      const pixelsPerSecond = bpm / 60 * 100; // BPMに基づいたピクセル/秒\n      setCurrentTime(elapsed * pixelsPerSecond);\n      animationFrameRef.current = requestAnimationFrame(updatePlayhead);\n    }\n  };\n  useEffect(() => {\n    if (isPlaying) {\n      setStartPlayTime(Date.now() - currentTime / (bpm / 60 * 100) * 1000);\n      updatePlayhead();\n    } else {\n      if (animationFrameRef.current) {\n        cancelAnimationFrame(animationFrameRef.current);\n      }\n    }\n  }, [isPlaying, bpm]);\n  const addTrack = () => {\n    const newTrack = {\n      id: tracks.length + 1,\n      name: `トラック ${tracks.length + 1}`,\n      clips: []\n    };\n    setTracks([...tracks, newTrack]);\n  };\n  const removeTrack = trackId => {\n    if (tracks.length > 1) {\n      setTracks(tracks.filter(track => track.id !== trackId));\n    }\n  };\n  const handleDrop = async (e, trackId, timePosition) => {\n    e.preventDefault();\n    try {\n      const soundData = JSON.parse(e.dataTransfer.getData('application/json'));\n\n      // 拍に合わせて位置を調整\n      const beatWidth = 100; // 1拍の幅（px）\n      const snappedPosition = Math.round(timePosition / beatWidth) * beatWidth;\n\n      // 音声の実際の継続時間を取得\n      let duration = 200; // デフォルト値\n      if (soundData.audioBlob) {\n        try {\n          duration = await getAudioDuration(soundData.audioBlob);\n        } catch (error) {\n          console.warn('音声継続時間の取得に失敗しました:', error);\n        }\n      }\n      const newClip = {\n        id: Date.now(),\n        soundData: soundData,\n        startTime: snappedPosition,\n        duration: duration,\n        trackId: trackId\n      };\n      setTracks(tracks.map(track => track.id === trackId ? {\n        ...track,\n        clips: [...track.clips, newClip]\n      } : track));\n    } catch (error) {\n      console.error('ドロップエラー:', error);\n      // ユーザーにエラーを表示\n      alert('音素材の配置に失敗しました。再度お試しください。');\n    }\n  };\n  const handleDragOver = e => {\n    e.preventDefault();\n    e.dataTransfer.dropEffect = 'copy';\n  };\n  const removeClip = (trackId, clipId) => {\n    setTracks(tracks.map(track => track.id === trackId ? {\n      ...track,\n      clips: track.clips.filter(clip => clip.id !== clipId)\n    } : track));\n  };\n  const play = async () => {\n    try {\n      // AudioContextが中断されている場合は再開\n      if (audioContext && audioContext.state === 'suspended') {\n        await audioContext.resume();\n      }\n      setIsPlaying(true);\n\n      // 現在の時間位置に基づいて、再生すべきクリップを見つける\n      const pixelsPerSecond = bpm / 60 * 100;\n      const currentTimeInSeconds = currentTime / pixelsPerSecond;\n\n      // 各トラックのクリップを再生\n      const newPlayingAudios = new Map();\n      tracks.forEach(track => {\n        track.clips.forEach(clip => {\n          const clipStartTimeInSeconds = clip.startTime / pixelsPerSecond;\n          const clipEndTimeInSeconds = clipStartTimeInSeconds + clip.duration / pixelsPerSecond;\n\n          // 現在の時間位置がクリップの範囲内または今後再生される場合\n          if (clipEndTimeInSeconds > currentTimeInSeconds) {\n            const delay = Math.max(0, clipStartTimeInSeconds - currentTimeInSeconds);\n            scheduleClipPlayback(clip, delay * 1000, newPlayingAudios);\n          }\n        });\n      });\n      setPlayingAudios(newPlayingAudios);\n    } catch (error) {\n      console.error('再生エラー:', error);\n      alert('音声の再生に失敗しました。ブラウザで音声が有効になっているか確認してください。');\n    }\n  };\n  const scheduleClipPlayback = (clip, delayMs, playingAudiosMap) => {\n    if (clip.soundData.audioBlob) {\n      const audio = new Audio();\n      audio.src = URL.createObjectURL(clip.soundData.audioBlob);\n      const timeoutId = setTimeout(() => {\n        audio.play().catch(error => {\n          console.error('音声再生エラー:', error);\n        });\n      }, delayMs);\n      playingAudiosMap.set(clip.id, {\n        audio,\n        timeoutId\n      });\n    }\n  };\n  const pause = () => {\n    setIsPlaying(false);\n\n    // 再生中の音声を一時停止\n    playingAudios.forEach(({\n      audio,\n      timeoutId\n    }) => {\n      if (timeoutId) {\n        clearTimeout(timeoutId);\n      }\n      if (!audio.paused) {\n        audio.pause();\n      }\n    });\n  };\n  const stop = () => {\n    setIsPlaying(false);\n    setCurrentTime(0);\n\n    // 再生中の音声を停止\n    playingAudios.forEach(({\n      audio,\n      timeoutId\n    }) => {\n      if (timeoutId) {\n        clearTimeout(timeoutId);\n      }\n      audio.pause();\n      audio.currentTime = 0;\n    });\n    setPlayingAudios(new Map());\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"daw-page\",\n    children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n      children: \"\\uD83C\\uDFB9 \\u97F3\\u697D\\u3065\\u304F\\u308A\\u30DA\\u30FC\\u30B8\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 217,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n      children: \"\\u97F3\\u7D20\\u6750\\u3092\\u30C9\\u30E9\\u30C3\\u30B0&\\u30C9\\u30ED\\u30C3\\u30D7\\u3057\\u3066\\u97F3\\u697D\\u3092\\u4F5C\\u308A\\u307E\\u3057\\u3087\\u3046\\uFF01\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 218,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"daw-controls card\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"transport-controls\",\n        children: [/*#__PURE__*/_jsxDEV(\"button\", {\n          className: `transport-btn play-btn ${isPlaying ? 'playing' : ''}`,\n          onClick: isPlaying ? pause : play,\n          children: isPlaying ? '⏸️' : '▶️'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 222,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"transport-btn stop-btn\",\n          onClick: stop,\n          children: \"\\u23F9\\uFE0F\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 228,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 221,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"bpm-control\",\n        children: [/*#__PURE__*/_jsxDEV(\"label\", {\n          htmlFor: \"bpm\",\n          children: \"\\uD83C\\uDFB5 BPM:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 234,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          id: \"bpm\",\n          type: \"number\",\n          value: bpm,\n          onChange: e => setBpm(parseInt(e.target.value)),\n          min: \"60\",\n          max: \"200\",\n          className: \"bpm-input\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 235,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 233,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"track-controls\",\n        children: /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"button-primary\",\n          onClick: addTrack,\n          children: \"\\u2795 \\u30C8\\u30E9\\u30C3\\u30AF\\u8FFD\\u52A0\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 247,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 246,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 220,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"daw-workspace\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"track-headers\",\n        children: tracks.map(track => /*#__PURE__*/_jsxDEV(TrackHeader, {\n          track: track,\n          onRemove: removeTrack,\n          trackHeight: trackHeight\n        }, track.id, false, {\n          fileName: _jsxFileName,\n          lineNumber: 256,\n          columnNumber: 13\n        }, this))\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 254,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"timeline-container\",\n        children: [/*#__PURE__*/_jsxDEV(Timeline, {\n          bpm: bpm\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 266,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"tracks-area\",\n          ref: timelineRef,\n          children: [/*#__PURE__*/_jsxDEV(Playhead, {\n            currentTime: currentTime\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 268,\n            columnNumber: 13\n          }, this), tracks.map(track => /*#__PURE__*/_jsxDEV(Track, {\n            track: track,\n            onDrop: handleDrop,\n            onDragOver: handleDragOver,\n            onRemoveClip: removeClip,\n            trackHeight: trackHeight,\n            bpm: bpm\n          }, track.id, false, {\n            fileName: _jsxFileName,\n            lineNumber: 270,\n            columnNumber: 15\n          }, this))]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 267,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 265,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 253,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"instructions card\",\n      children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n        children: \"\\uD83D\\uDCD6 \\u4F7F\\u3044\\u65B9\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 285,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"ul\", {\n        children: [/*#__PURE__*/_jsxDEV(\"li\", {\n          children: \"\\u97F3\\u30E9\\u30A4\\u30D6\\u30E9\\u30EA\\u304B\\u3089\\u97F3\\u7D20\\u6750\\u3092\\u30C8\\u30E9\\u30C3\\u30AF\\u306B\\u30C9\\u30E9\\u30C3\\u30B0&\\u30C9\\u30ED\\u30C3\\u30D7\\u3057\\u3066\\u914D\\u7F6E\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 287,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n          children: \"\\u97F3\\u7D20\\u6750\\u306F\\u62CD\\u306B\\u5408\\u308F\\u305B\\u3066\\u81EA\\u52D5\\u7684\\u306B\\u914D\\u7F6E\\u3055\\u308C\\u307E\\u3059\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 288,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n          children: \"\\u25B6\\uFE0F\\u30DC\\u30BF\\u30F3\\u3067\\u518D\\u751F\\u3001\\u23F8\\uFE0F\\u30DC\\u30BF\\u30F3\\u3067\\u4E00\\u6642\\u505C\\u6B62\\u3001\\u23F9\\uFE0F\\u30DC\\u30BF\\u30F3\\u3067\\u505C\\u6B62\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 289,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n          children: \"BPM\\u3092\\u5909\\u66F4\\u3057\\u3066\\u97F3\\u697D\\u306E\\u901F\\u3055\\u3092\\u8ABF\\u6574\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 290,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n          children: \"\\u30C8\\u30E9\\u30C3\\u30AF\\u3092\\u8FFD\\u52A0\\u3057\\u3066\\u8907\\u6570\\u306E\\u97F3\\u3092\\u91CD\\u306D\\u308B\\u3053\\u3068\\u304C\\u3067\\u304D\\u307E\\u3059\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 291,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 286,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 284,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 216,\n    columnNumber: 5\n  }, this);\n};\n_s(DAWPage, \"JsMy+lCbwhaV9KpXrbKVN1VqGLk=\");\n_c = DAWPage;\nconst TrackHeader = ({\n  track,\n  onRemove,\n  trackHeight\n}) => {\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"track-header\",\n    style: {\n      height: trackHeight\n    },\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"track-info\",\n      children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n        children: track.name\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 302,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"track-actions\",\n        children: /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"remove-track-btn\",\n          onClick: () => onRemove(track.id),\n          title: \"\\u30C8\\u30E9\\u30C3\\u30AF\\u3092\\u524A\\u9664\",\n          children: \"\\uD83D\\uDDD1\\uFE0F\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 304,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 303,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 301,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 300,\n    columnNumber: 5\n  }, this);\n};\n_c2 = TrackHeader;\nconst Timeline = ({\n  bpm\n}) => {\n  const measures = 16; // 16小節表示\n  const beatsPerMeasure = 4; // 4/4拍子\n  const beatWidth = 100; // 1拍の幅\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"timeline\",\n    children: Array.from({\n      length: measures\n    }, (_, measureIndex) => /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"measure\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"measure-number\",\n        children: measureIndex + 1\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 326,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"beats\",\n        children: Array.from({\n          length: beatsPerMeasure\n        }, (_, beatIndex) => /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"beat\",\n          style: {\n            width: beatWidth\n          },\n          children: beatIndex + 1\n        }, beatIndex, false, {\n          fileName: _jsxFileName,\n          lineNumber: 329,\n          columnNumber: 15\n        }, this))\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 327,\n        columnNumber: 11\n      }, this)]\n    }, measureIndex, true, {\n      fileName: _jsxFileName,\n      lineNumber: 325,\n      columnNumber: 9\n    }, this))\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 323,\n    columnNumber: 5\n  }, this);\n};\n_c3 = Timeline;\nconst Track = ({\n  track,\n  onDrop,\n  onDragOver,\n  onRemoveClip,\n  trackHeight,\n  bpm\n}) => {\n  const handleDrop = e => {\n    const rect = e.currentTarget.getBoundingClientRect();\n    const timePosition = e.clientX - rect.left;\n    onDrop(e, track.id, timePosition);\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"track\",\n    style: {\n      height: trackHeight\n    },\n    onDrop: handleDrop,\n    onDragOver: onDragOver,\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"track-grid\",\n      children: Array.from({\n        length: 64\n      }, (_, index) => /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"beat-line\",\n        style: {\n          left: index * 100\n        }\n      }, index, false, {\n        fileName: _jsxFileName,\n        lineNumber: 361,\n        columnNumber: 11\n      }, this))\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 358,\n      columnNumber: 7\n    }, this), track.clips.map(clip => /*#__PURE__*/_jsxDEV(AudioClip, {\n      clip: clip,\n      onRemove: () => onRemoveClip(track.id, clip.id)\n    }, clip.id, false, {\n      fileName: _jsxFileName,\n      lineNumber: 366,\n      columnNumber: 9\n    }, this))]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 352,\n    columnNumber: 5\n  }, this);\n};\n_c4 = Track;\nconst AudioClip = ({\n  clip,\n  onRemove\n}) => {\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"audio-clip\",\n    style: {\n      left: clip.startTime,\n      width: clip.duration\n    },\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"clip-header\",\n      children: [/*#__PURE__*/_jsxDEV(\"span\", {\n        className: \"clip-name\",\n        children: clip.soundData.name\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 386,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"remove-clip-btn\",\n        onClick: onRemove,\n        children: \"\\xD7\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 387,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 385,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"clip-waveform\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"waveform-placeholder\",\n        children: \"\\uD83D\\uDD0A\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 396,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 394,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 378,\n    columnNumber: 5\n  }, this);\n};\n_c5 = AudioClip;\nconst Playhead = ({\n  currentTime\n}) => {\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"playhead\",\n    style: {\n      left: currentTime\n    }\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 404,\n    columnNumber: 5\n  }, this);\n};\n_c6 = Playhead;\nexport default DAWPage;\nvar _c, _c2, _c3, _c4, _c5, _c6;\n$RefreshReg$(_c, \"DAWPage\");\n$RefreshReg$(_c2, \"TrackHeader\");\n$RefreshReg$(_c3, \"Timeline\");\n$RefreshReg$(_c4, \"Track\");\n$RefreshReg$(_c5, \"AudioClip\");\n$RefreshReg$(_c6, \"Playhead\");","map":{"version":3,"names":["React","useState","useRef","useEffect","jsxDEV","_jsxDEV","DAWPage","_s","tracks","setTracks","id","name","clips","bpm","setBpm","isPlaying","setIsPlaying","currentTime","setCurrentTime","audioContext","setAudioContext","trackHeight","playingAudios","setPlayingAudios","Map","startPlayTime","setStartPlayTime","timelineRef","playheadRef","animationFrameRef","ctx","window","AudioContext","webkitAudioContext","close","current","cancelAnimationFrame","getAudioDuration","audioBlob","Promise","resolve","audio","Audio","addEventListener","duration","src","URL","createObjectURL","updatePlayhead","elapsed","Date","now","pixelsPerSecond","requestAnimationFrame","addTrack","newTrack","length","removeTrack","trackId","filter","track","handleDrop","e","timePosition","preventDefault","soundData","JSON","parse","dataTransfer","getData","beatWidth","snappedPosition","Math","round","error","console","warn","newClip","startTime","map","alert","handleDragOver","dropEffect","removeClip","clipId","clip","play","state","resume","currentTimeInSeconds","newPlayingAudios","forEach","clipStartTimeInSeconds","clipEndTimeInSeconds","delay","max","scheduleClipPlayback","delayMs","playingAudiosMap","timeoutId","setTimeout","catch","set","pause","clearTimeout","paused","stop","className","children","fileName","_jsxFileName","lineNumber","columnNumber","onClick","htmlFor","type","value","onChange","parseInt","target","min","TrackHeader","onRemove","Timeline","ref","Playhead","Track","onDrop","onDragOver","onRemoveClip","_c","style","height","title","_c2","measures","beatsPerMeasure","Array","from","_","measureIndex","beatIndex","width","_c3","rect","currentTarget","getBoundingClientRect","clientX","left","index","AudioClip","_c4","_c5","_c6","$RefreshReg$"],"sources":["/Users/nakataniyuutomo/Desktop/Programing/ゼミ開発/sound-library2/src/pages/DAWPage.js"],"sourcesContent":["import React, { useState, useRef, useEffect } from 'react';\nimport './DAWPage.css';\n\nconst DAWPage = () => {\n  const [tracks, setTracks] = useState([{ id: 1, name: 'トラック 1', clips: [] }]);\n  const [bpm, setBpm] = useState(120);\n  const [isPlaying, setIsPlaying] = useState(false);\n  const [currentTime, setCurrentTime] = useState(0);\n  const [audioContext, setAudioContext] = useState(null);\n  const [trackHeight] = useState(80);\n  const [playingAudios, setPlayingAudios] = useState(new Map());\n  const [startPlayTime, setStartPlayTime] = useState(null);\n  const timelineRef = useRef(null);\n  const playheadRef = useRef(null);\n  const animationFrameRef = useRef(null);\n\n  useEffect(() => {\n    // Web Audio API の初期化\n    const ctx = new (window.AudioContext || window.webkitAudioContext)();\n    setAudioContext(ctx);\n    \n    return () => {\n      if (ctx) {\n        ctx.close();\n      }\n      if (animationFrameRef.current) {\n        cancelAnimationFrame(animationFrameRef.current);\n      }\n    };\n  }, []);\n\n  // 音声ファイルの継続時間を取得\n  const getAudioDuration = (audioBlob) => {\n    return new Promise((resolve) => {\n      const audio = new Audio();\n      audio.addEventListener('loadedmetadata', () => {\n        resolve(audio.duration * 100); // 秒からピクセルに変換（1秒=100px）\n      });\n      audio.addEventListener('error', () => {\n        resolve(200); // エラーの場合はデフォルト値\n      });\n      audio.src = URL.createObjectURL(audioBlob);\n    });\n  };\n\n  // プレイヘッドのアニメーション更新\n  const updatePlayhead = () => {\n    if (isPlaying && startPlayTime) {\n      const elapsed = (Date.now() - startPlayTime) / 1000; // 経過時間（秒）\n      const pixelsPerSecond = (bpm / 60) * 100; // BPMに基づいたピクセル/秒\n      setCurrentTime(elapsed * pixelsPerSecond);\n      animationFrameRef.current = requestAnimationFrame(updatePlayhead);\n    }\n  };\n\n  useEffect(() => {\n    if (isPlaying) {\n      setStartPlayTime(Date.now() - (currentTime / ((bpm / 60) * 100)) * 1000);\n      updatePlayhead();\n    } else {\n      if (animationFrameRef.current) {\n        cancelAnimationFrame(animationFrameRef.current);\n      }\n    }\n  }, [isPlaying, bpm]);\n\n  const addTrack = () => {\n    const newTrack = {\n      id: tracks.length + 1,\n      name: `トラック ${tracks.length + 1}`,\n      clips: []\n    };\n    setTracks([...tracks, newTrack]);\n  };\n\n  const removeTrack = (trackId) => {\n    if (tracks.length > 1) {\n      setTracks(tracks.filter(track => track.id !== trackId));\n    }\n  };\n\n  const handleDrop = async (e, trackId, timePosition) => {\n    e.preventDefault();\n    try {\n      const soundData = JSON.parse(e.dataTransfer.getData('application/json'));\n      \n      // 拍に合わせて位置を調整\n      const beatWidth = 100; // 1拍の幅（px）\n      const snappedPosition = Math.round(timePosition / beatWidth) * beatWidth;\n      \n      // 音声の実際の継続時間を取得\n      let duration = 200; // デフォルト値\n      if (soundData.audioBlob) {\n        try {\n          duration = await getAudioDuration(soundData.audioBlob);\n        } catch (error) {\n          console.warn('音声継続時間の取得に失敗しました:', error);\n        }\n      }\n      \n      const newClip = {\n        id: Date.now(),\n        soundData: soundData,\n        startTime: snappedPosition,\n        duration: duration,\n        trackId: trackId\n      };\n\n      setTracks(tracks.map(track => \n        track.id === trackId \n          ? { ...track, clips: [...track.clips, newClip] }\n          : track\n      ));\n    } catch (error) {\n      console.error('ドロップエラー:', error);\n      // ユーザーにエラーを表示\n      alert('音素材の配置に失敗しました。再度お試しください。');\n    }\n  };\n\n  const handleDragOver = (e) => {\n    e.preventDefault();\n    e.dataTransfer.dropEffect = 'copy';\n  };\n\n  const removeClip = (trackId, clipId) => {\n    setTracks(tracks.map(track => \n      track.id === trackId \n        ? { ...track, clips: track.clips.filter(clip => clip.id !== clipId) }\n        : track\n    ));\n  };\n\n  const play = async () => {\n    try {\n      // AudioContextが中断されている場合は再開\n      if (audioContext && audioContext.state === 'suspended') {\n        await audioContext.resume();\n      }\n      \n      setIsPlaying(true);\n      \n      // 現在の時間位置に基づいて、再生すべきクリップを見つける\n      const pixelsPerSecond = (bpm / 60) * 100;\n      const currentTimeInSeconds = currentTime / pixelsPerSecond;\n      \n      // 各トラックのクリップを再生\n      const newPlayingAudios = new Map();\n      \n      tracks.forEach(track => {\n        track.clips.forEach(clip => {\n          const clipStartTimeInSeconds = clip.startTime / pixelsPerSecond;\n          const clipEndTimeInSeconds = clipStartTimeInSeconds + (clip.duration / pixelsPerSecond);\n          \n          // 現在の時間位置がクリップの範囲内または今後再生される場合\n          if (clipEndTimeInSeconds > currentTimeInSeconds) {\n            const delay = Math.max(0, clipStartTimeInSeconds - currentTimeInSeconds);\n            scheduleClipPlayback(clip, delay * 1000, newPlayingAudios);\n          }\n        });\n      });\n      \n      setPlayingAudios(newPlayingAudios);\n    } catch (error) {\n      console.error('再生エラー:', error);\n      alert('音声の再生に失敗しました。ブラウザで音声が有効になっているか確認してください。');\n    }\n  };\n\n  const scheduleClipPlayback = (clip, delayMs, playingAudiosMap) => {\n    if (clip.soundData.audioBlob) {\n      const audio = new Audio();\n      audio.src = URL.createObjectURL(clip.soundData.audioBlob);\n      \n      const timeoutId = setTimeout(() => {\n        audio.play().catch(error => {\n          console.error('音声再生エラー:', error);\n        });\n      }, delayMs);\n      \n      playingAudiosMap.set(clip.id, { audio, timeoutId });\n    }\n  };\n\n  const pause = () => {\n    setIsPlaying(false);\n    \n    // 再生中の音声を一時停止\n    playingAudios.forEach(({ audio, timeoutId }) => {\n      if (timeoutId) {\n        clearTimeout(timeoutId);\n      }\n      if (!audio.paused) {\n        audio.pause();\n      }\n    });\n  };\n\n  const stop = () => {\n    setIsPlaying(false);\n    setCurrentTime(0);\n    \n    // 再生中の音声を停止\n    playingAudios.forEach(({ audio, timeoutId }) => {\n      if (timeoutId) {\n        clearTimeout(timeoutId);\n      }\n      audio.pause();\n      audio.currentTime = 0;\n    });\n    \n    setPlayingAudios(new Map());\n  };\n\n  return (\n    <div className=\"daw-page\">\n      <h2>🎹 音楽づくりページ</h2>\n      <p>音素材をドラッグ&ドロップして音楽を作りましょう！</p>\n\n      <div className=\"daw-controls card\">\n        <div className=\"transport-controls\">\n          <button \n            className={`transport-btn play-btn ${isPlaying ? 'playing' : ''}`}\n            onClick={isPlaying ? pause : play}\n          >\n            {isPlaying ? '⏸️' : '▶️'}\n          </button>\n          <button className=\"transport-btn stop-btn\" onClick={stop}>\n            ⏹️\n          </button>\n        </div>\n\n        <div className=\"bpm-control\">\n          <label htmlFor=\"bpm\">🎵 BPM:</label>\n          <input\n            id=\"bpm\"\n            type=\"number\"\n            value={bpm}\n            onChange={(e) => setBpm(parseInt(e.target.value))}\n            min=\"60\"\n            max=\"200\"\n            className=\"bpm-input\"\n          />\n        </div>\n\n        <div className=\"track-controls\">\n          <button className=\"button-primary\" onClick={addTrack}>\n            ➕ トラック追加\n          </button>\n        </div>\n      </div>\n\n      <div className=\"daw-workspace\">\n        <div className=\"track-headers\">\n          {tracks.map(track => (\n            <TrackHeader \n              key={track.id} \n              track={track} \n              onRemove={removeTrack}\n              trackHeight={trackHeight}\n            />\n          ))}\n        </div>\n\n        <div className=\"timeline-container\">\n          <Timeline bpm={bpm} />\n          <div className=\"tracks-area\" ref={timelineRef}>\n            <Playhead currentTime={currentTime} />\n            {tracks.map(track => (\n              <Track\n                key={track.id}\n                track={track}\n                onDrop={handleDrop}\n                onDragOver={handleDragOver}\n                onRemoveClip={removeClip}\n                trackHeight={trackHeight}\n                bpm={bpm}\n              />\n            ))}\n          </div>\n        </div>\n      </div>\n\n      <div className=\"instructions card\">\n        <h3>📖 使い方</h3>\n        <ul>\n          <li>音ライブラリから音素材をトラックにドラッグ&ドロップして配置</li>\n          <li>音素材は拍に合わせて自動的に配置されます</li>\n          <li>▶️ボタンで再生、⏸️ボタンで一時停止、⏹️ボタンで停止</li>\n          <li>BPMを変更して音楽の速さを調整</li>\n          <li>トラックを追加して複数の音を重ねることができます</li>\n        </ul>\n      </div>\n    </div>\n  );\n};\n\nconst TrackHeader = ({ track, onRemove, trackHeight }) => {\n  return (\n    <div className=\"track-header\" style={{ height: trackHeight }}>\n      <div className=\"track-info\">\n        <h4>{track.name}</h4>\n        <div className=\"track-actions\">\n          <button \n            className=\"remove-track-btn\"\n            onClick={() => onRemove(track.id)}\n            title=\"トラックを削除\"\n          >\n            🗑️\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nconst Timeline = ({ bpm }) => {\n  const measures = 16; // 16小節表示\n  const beatsPerMeasure = 4; // 4/4拍子\n  const beatWidth = 100; // 1拍の幅\n\n  return (\n    <div className=\"timeline\">\n      {Array.from({ length: measures }, (_, measureIndex) => (\n        <div key={measureIndex} className=\"measure\">\n          <div className=\"measure-number\">{measureIndex + 1}</div>\n          <div className=\"beats\">\n            {Array.from({ length: beatsPerMeasure }, (_, beatIndex) => (\n              <div \n                key={beatIndex} \n                className=\"beat\"\n                style={{ width: beatWidth }}\n              >\n                {beatIndex + 1}\n              </div>\n            ))}\n          </div>\n        </div>\n      ))}\n    </div>\n  );\n};\n\nconst Track = ({ track, onDrop, onDragOver, onRemoveClip, trackHeight, bpm }) => {\n  const handleDrop = (e) => {\n    const rect = e.currentTarget.getBoundingClientRect();\n    const timePosition = e.clientX - rect.left;\n    onDrop(e, track.id, timePosition);\n  };\n\n  return (\n    <div \n      className=\"track\"\n      style={{ height: trackHeight }}\n      onDrop={handleDrop}\n      onDragOver={onDragOver}\n    >\n      <div className=\"track-grid\">\n        {/* 拍の境界線を表示 */}\n        {Array.from({ length: 64 }, (_, index) => (\n          <div key={index} className=\"beat-line\" style={{ left: index * 100 }} />\n        ))}\n      </div>\n      \n      {track.clips.map(clip => (\n        <AudioClip\n          key={clip.id}\n          clip={clip}\n          onRemove={() => onRemoveClip(track.id, clip.id)}\n        />\n      ))}\n    </div>\n  );\n};\n\nconst AudioClip = ({ clip, onRemove }) => {\n  return (\n    <div \n      className=\"audio-clip\"\n      style={{\n        left: clip.startTime,\n        width: clip.duration\n      }}\n    >\n      <div className=\"clip-header\">\n        <span className=\"clip-name\">{clip.soundData.name}</span>\n        <button \n          className=\"remove-clip-btn\"\n          onClick={onRemove}\n        >\n          ×\n        </button>\n      </div>\n      <div className=\"clip-waveform\">\n        {/* 波形表示のプレースホルダー */}\n        <div className=\"waveform-placeholder\">🔊</div>\n      </div>\n    </div>\n  );\n};\n\nconst Playhead = ({ currentTime }) => {\n  return (\n    <div \n      className=\"playhead\"\n      style={{ left: currentTime }}\n    />\n  );\n};\n\nexport default DAWPage;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}