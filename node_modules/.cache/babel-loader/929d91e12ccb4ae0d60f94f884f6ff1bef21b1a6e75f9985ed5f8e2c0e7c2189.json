{"ast":null,"code":"var _jsxFileName = \"/Users/nakataniyuutomo/Desktop/Programing/\\u30BB\\u3099\\u30DF\\u958B\\u767A/sound-library2/src/pages/DAWPage.js\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$(),\n  _s3 = $RefreshSig$(),\n  _s4 = $RefreshSig$();\nimport React, { useState, useRef, useEffect, useCallback } from 'react';\nimport './DAWPage.css';\n\n// DAWã®å®šæ•°\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst BEAT_WIDTH = 100; // 1æ‹ã®å¹…ï¼ˆpxï¼‰\nconst BEATS_PER_MEASURE = 4; // 1å°ç¯€ã‚ãŸã‚Šã®æ‹æ•°\nconst MEASURE_WIDTH = BEAT_WIDTH * BEATS_PER_MEASURE; // 1å°ç¯€ã®å¹…ï¼ˆ400pxï¼‰\nconst SUB_BEAT_WIDTH = BEAT_WIDTH / 2; // 8åˆ†éŸ³ç¬¦ã®å¹…ï¼ˆ50pxï¼‰\nconst TOTAL_MEASURES = 16; // è¡¨ç¤ºã™ã‚‹å°ç¯€æ•°\nconst TOTAL_BEATS = TOTAL_MEASURES * BEATS_PER_MEASURE; // ç·æ‹æ•°\n\nconst DAWPage = () => {\n  _s();\n  // ãƒ¦ãƒ‹ãƒ¼ã‚¯IDç”Ÿæˆç”¨ã®ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼\n  const trackIdCounterRef = useRef(1);\n  // ãƒˆãƒ©ãƒƒã‚¯åã®ç•ªå·ç®¡ç†ç”¨ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼\n  const trackNameCounterRef = useRef(1);\n  const [tracks, setTracks] = useState(() => [{\n    id: Date.now(),\n    name: 'ãƒˆãƒ©ãƒƒã‚¯ 1',\n    clips: []\n  }]);\n  const [bpm, setBpm] = useState(120);\n  const [isPlaying, setIsPlaying] = useState(false);\n  const [currentTime, setCurrentTime] = useState(0);\n  const [audioContext, setAudioContext] = useState(null);\n  const [trackHeight] = useState(80);\n  const [playingAudios, setPlayingAudios] = useState(new Map());\n  const [startPlayTime, setStartPlayTime] = useState(null);\n  const [error, setError] = useState(null);\n  const [sounds, setSounds] = useState([]);\n  const [showSoundPanel, setShowSoundPanel] = useState(true);\n  const [draggedClip, setDraggedClip] = useState(null);\n  const [dragPreview, setDragPreview] = useState(null);\n  const [draggedSoundDuration, setDraggedSoundDuration] = useState(400); // ãƒ‰ãƒ©ãƒƒã‚°ä¸­ã®éŸ³ç´ æã®é•·ã•\n  const [isExporting, setIsExporting] = useState(false); // éŸ³æºå‡ºåŠ›ä¸­ãƒ•ãƒ©ã‚°\n  const timelineRef = useRef(null);\n  const animationFrameRef = useRef(null);\n  useEffect(() => {\n    // Web Audio API ã®åˆæœŸåŒ–\n    const ctx = new (window.AudioContext || window.webkitAudioContext)();\n    setAudioContext(ctx);\n\n    // LocalStorageã‹ã‚‰éŸ³ç´ æã‚’èª­ã¿è¾¼ã¿\n    const savedSounds = JSON.parse(localStorage.getItem('soundRecordings') || '[]');\n    console.log('LocalStorageã‹ã‚‰èª­ã¿è¾¼ã‚“ã éŸ³ç´ ææ•°:', savedSounds.length);\n\n    // audioDataã‹ã‚‰Blobã‚’å¾©å…ƒ\n    const soundsWithBlob = savedSounds.map(sound => {\n      if (sound.audioData) {\n        try {\n          console.log('éŸ³å£°ãƒ‡ãƒ¼ã‚¿å¾©å…ƒä¸­:', sound.name, 'ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚º:', sound.audioData.length);\n          const byteCharacters = atob(sound.audioData.split(',')[1]);\n          const byteNumbers = new Array(byteCharacters.length);\n          for (let i = 0; i < byteCharacters.length; i++) {\n            byteNumbers[i] = byteCharacters.charCodeAt(i);\n          }\n          const byteArray = new Uint8Array(byteNumbers);\n          const blob = new Blob([byteArray], {\n            type: 'audio/wav'\n          });\n          console.log('Blobå¾©å…ƒæˆåŠŸ:', sound.name, 'ã‚µã‚¤ã‚º:', blob.size, 'ã‚¿ã‚¤ãƒ—:', blob.type);\n          return {\n            ...sound,\n            audioBlob: blob\n          };\n        } catch (error) {\n          console.error('éŸ³å£°ãƒ‡ãƒ¼ã‚¿ã®å¾©å…ƒã«å¤±æ•—:', sound.name, error);\n          return sound;\n        }\n      }\n      return sound;\n    });\n    setSounds(soundsWithBlob);\n    return () => {\n      if (ctx) {\n        ctx.close();\n      }\n      if (animationFrameRef.current) {\n        cancelAnimationFrame(animationFrameRef.current);\n      }\n      // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã‚’ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—\n      if (window.currentDraggedSoundBlob) {\n        window.currentDraggedSoundBlob = null;\n      }\n    };\n  }, []);\n\n  // éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã®ç¶™ç¶šæ™‚é–“ã‚’å–å¾—ã—ã¦ãƒ”ã‚¯ã‚»ãƒ«å¹…ã«å¤‰æ›\n  const getAudioDuration = useCallback((audioBlob, currentBpm = bpm) => {\n    return new Promise(async resolve => {\n      if (!audioBlob || !(audioBlob instanceof Blob)) {\n        console.log('ç„¡åŠ¹ãªaudioBlob - ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’ä½¿ç”¨');\n        resolve(400);\n        return;\n      }\n      console.log('audioBlobè©³ç´°:', {\n        size: audioBlob.size,\n        type: audioBlob.type,\n        bpm: currentBpm\n      });\n\n      // AudioContextã‚’ä½¿ç”¨ã—ãŸæ–¹æ³•ã‚’å„ªå…ˆ\n      if (audioContext) {\n        try {\n          console.log('AudioContextæ–¹å¼ã§éŸ³å£°é•·ã•ã‚’å–å¾—ä¸­...');\n          const arrayBuffer = await audioBlob.arrayBuffer();\n          const audioBuffer = await audioContext.decodeAudioData(arrayBuffer);\n          const durationInSeconds = audioBuffer.duration;\n          console.log('AudioContextæ–¹å¼ã§å–å¾—ã—ãŸé•·ã•:', durationInSeconds, 'ç§’');\n          if (isFinite(durationInSeconds) && durationInSeconds > 0) {\n            const pixelsPerSecond = currentBpm / 60 * 100;\n            const widthInPixels = durationInSeconds * pixelsPerSecond;\n            console.log('AudioContextè¨ˆç®—çµæœ - BPM:', currentBpm, 'æ‹/ç§’:', currentBpm / 60, 'ãƒ”ã‚¯ã‚»ãƒ«/ç§’:', pixelsPerSecond, 'æœ€çµ‚å¹…:', widthInPixels, 'px');\n            resolve(widthInPixels);\n            return;\n          }\n        } catch (error) {\n          console.log('AudioContextæ–¹å¼ã§ã‚¨ãƒ©ãƒ¼:', error);\n        }\n      }\n\n      // AudioContextãŒå¤±æ•—ã—ãŸå ´åˆã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’ä½¿ç”¨\n      console.log('AudioContextãŒåˆ©ç”¨ã§ããªã„ãŸã‚ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’ä½¿ç”¨');\n      resolve(400);\n    });\n  }, [audioContext, bpm]);\n\n  // ãƒ—ãƒ¬ã‚¤ãƒ˜ãƒƒãƒ‰ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³æ›´æ–°\n  const updatePlayhead = useCallback(() => {\n    const animate = () => {\n      if (isPlaying && startPlayTime) {\n        const elapsed = (Date.now() - startPlayTime) / 1000; // çµŒéæ™‚é–“ï¼ˆç§’ï¼‰\n        const pixelsPerSecond = bpm / 60 * 100; // BPMã«åŸºã¥ã„ãŸãƒ”ã‚¯ã‚»ãƒ«/ç§’\n        const newCurrentTime = elapsed * pixelsPerSecond;\n\n        // æœ‰åŠ¹ãªæ•°å€¤ã‹ãƒã‚§ãƒƒã‚¯\n        if (isFinite(newCurrentTime) && newCurrentTime >= 0) {\n          setCurrentTime(newCurrentTime);\n        } else {\n          console.warn('ç„¡åŠ¹ãªcurrentTime:', newCurrentTime, 'elapsed:', elapsed, 'pixelsPerSecond:', pixelsPerSecond);\n        }\n\n        // æ¬¡ã®ãƒ•ãƒ¬ãƒ¼ãƒ ã‚’è¦æ±‚\n        animationFrameRef.current = requestAnimationFrame(animate);\n      }\n    };\n    if (isPlaying && startPlayTime) {\n      animate();\n    }\n  }, [isPlaying, startPlayTime, bpm]);\n  useEffect(() => {\n    if (isPlaying) {\n      if (!startPlayTime) {\n        // å†ç”Ÿé–‹å§‹æ™‚ã«startPlayTimeã‚’è¨­å®š\n        const pixelsPerSecond = bpm / 60 * 100;\n        if (isFinite(pixelsPerSecond) && pixelsPerSecond > 0) {\n          const timeInSeconds = currentTime / pixelsPerSecond;\n          if (isFinite(timeInSeconds) && timeInSeconds >= 0) {\n            setStartPlayTime(Date.now() - timeInSeconds * 1000);\n          } else {\n            setStartPlayTime(Date.now());\n          }\n        } else {\n          setStartPlayTime(Date.now());\n        }\n      }\n    } else {\n      // å†ç”Ÿåœæ­¢æ™‚ã«ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ã‚¯ãƒªã‚¢\n      if (animationFrameRef.current) {\n        cancelAnimationFrame(animationFrameRef.current);\n        animationFrameRef.current = null;\n      }\n      setStartPlayTime(null);\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [isPlaying, bpm, currentTime]);\n\n  // startPlayTimeãŒè¨­å®šã•ã‚ŒãŸã¨ãã«ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é–‹å§‹\n  useEffect(() => {\n    if (isPlaying && startPlayTime) {\n      updatePlayhead();\n    }\n  }, [isPlaying, startPlayTime, updatePlayhead]);\n\n  // BPMå¤‰æ›´æ™‚ã®ãƒãƒ³ãƒ‰ãƒ©ãƒ¼\n  const handleBpmChange = useCallback(async newBpm => {\n    setBpm(newBpm);\n\n    // æ—¢å­˜ã®ã‚¯ãƒªãƒƒãƒ—ã®durationã‚’æ–°ã—ã„BPMã§å†è¨ˆç®—\n    const updatedTracks = await Promise.all(tracks.map(async track => {\n      const updatedClips = await Promise.all(track.clips.map(async clip => {\n        if (clip.soundData && clip.soundData.audioBlob) {\n          try {\n            const newDuration = await getAudioDuration(clip.soundData.audioBlob, newBpm);\n            return {\n              ...clip,\n              duration: newDuration\n            };\n          } catch (error) {\n            console.warn('ã‚¯ãƒªãƒƒãƒ—ã®durationæ›´æ–°ã«å¤±æ•—:', error);\n            return clip;\n          }\n        }\n        return clip;\n      }));\n      return {\n        ...track,\n        clips: updatedClips\n      };\n    }));\n    setTracks(updatedTracks);\n  }, [tracks, getAudioDuration]);\n\n  // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¿å­˜æ©Ÿèƒ½\n  const saveProject = () => {\n    try {\n      const projectData = {\n        version: '1.0',\n        bpm: bpm,\n        tracks: tracks,\n        sounds: sounds.map(sound => ({\n          ...sound,\n          audioBlob: null,\n          // Blobã¯åˆ¥é€”ä¿å­˜\n          audioData: sound.audioData // base64ãƒ‡ãƒ¼ã‚¿ã‚’ä¿æŒ\n        })),\n        timestamp: Date.now(),\n        trackNameCounter: trackNameCounterRef.current,\n        trackIdCounter: trackIdCounterRef.current\n      };\n      const projectJson = JSON.stringify(projectData, null, 2);\n      const blob = new Blob([projectJson], {\n        type: 'application/json'\n      });\n      const url = URL.createObjectURL(blob);\n      const link = document.createElement('a');\n      link.href = url;\n      link.download = `music-project-${new Date().toISOString().slice(0, 19).replace(/:/g, '-')}.json`;\n      document.body.appendChild(link);\n      link.click();\n      document.body.removeChild(link);\n      URL.revokeObjectURL(url);\n      console.log('ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä¿å­˜ã—ã¾ã—ãŸ');\n    } catch (error) {\n      console.error('ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¿å­˜ã‚¨ãƒ©ãƒ¼:', error);\n      setError('ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸã€‚');\n    }\n  };\n\n  // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆèª­ã¿è¾¼ã¿æ©Ÿèƒ½\n  const loadProject = event => {\n    const file = event.target.files[0];\n    if (!file) return;\n    const reader = new FileReader();\n    reader.onload = e => {\n      try {\n        const projectData = JSON.parse(e.target.result);\n\n        // ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãƒã‚§ãƒƒã‚¯\n        if (!projectData.version) {\n          throw new Error('ä¸æ­£ãªãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã§ã™');\n        }\n\n        // éŸ³å£°ãƒ‡ãƒ¼ã‚¿å¾©å…ƒç”¨ã®ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°\n        const restoreAudioBlob = soundData => {\n          if (soundData && soundData.audioData) {\n            try {\n              const byteCharacters = atob(soundData.audioData.split(',')[1]);\n              const byteNumbers = new Array(byteCharacters.length);\n              for (let i = 0; i < byteCharacters.length; i++) {\n                byteNumbers[i] = byteCharacters.charCodeAt(i);\n              }\n              const byteArray = new Uint8Array(byteNumbers);\n              const blob = new Blob([byteArray], {\n                type: 'audio/wav'\n              });\n              return {\n                ...soundData,\n                audioBlob: blob\n              };\n            } catch (error) {\n              console.error('éŸ³å£°ãƒ‡ãƒ¼ã‚¿ã®å¾©å…ƒã«å¤±æ•—:', soundData.name || 'unknown', error);\n              return soundData;\n            }\n          }\n          return soundData;\n        };\n\n        // BPMã‚’å¾©å…ƒ\n        setBpm(projectData.bpm || 120);\n\n        // ãƒˆãƒ©ãƒƒã‚¯ã‚’å¾©å…ƒï¼ˆã‚¯ãƒªãƒƒãƒ—å†…ã®éŸ³å£°ãƒ‡ãƒ¼ã‚¿ã‚‚å¾©å…ƒï¼‰\n        if (projectData.tracks) {\n          const restoredTracks = projectData.tracks.map(track => ({\n            ...track,\n            clips: track.clips.map(clip => ({\n              ...clip,\n              soundData: restoreAudioBlob(clip.soundData)\n            }))\n          }));\n          setTracks(restoredTracks);\n          console.log('ãƒˆãƒ©ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ã‚’å¾©å…ƒã—ã¾ã—ãŸ:', restoredTracks.length, 'ãƒˆãƒ©ãƒƒã‚¯');\n        }\n\n        // ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã‚’å¾©å…ƒ\n        if (projectData.trackNameCounter) {\n          trackNameCounterRef.current = projectData.trackNameCounter;\n        }\n        if (projectData.trackIdCounter) {\n          trackIdCounterRef.current = projectData.trackIdCounter;\n        }\n\n        // éŸ³ç´ æã‚’å¾©å…ƒï¼ˆæ—¢å­˜ã®éŸ³ç´ æã«è¿½åŠ ï¼‰\n        if (projectData.sounds) {\n          const restoredSounds = projectData.sounds.map(sound => restoreAudioBlob(sound));\n\n          // æ—¢å­˜ã®éŸ³ç´ æã¨èª­ã¿è¾¼ã‚“ã éŸ³ç´ æã‚’çµåˆ\n          setSounds(prevSounds => {\n            const maxId = prevSounds.length > 0 ? Math.max(...prevSounds.map(s => s.id)) : 0;\n            const existingNames = new Set(prevSounds.map(s => s.name));\n            const newSounds = restoredSounds.map((sound, index) => {\n              let newName = sound.name;\n              let counter = 1;\n\n              // åå‰ã®é‡è¤‡ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ã€é‡è¤‡ã™ã‚‹å ´åˆã¯ç•ªå·ã‚’ä»˜ã‘ã‚‹\n              while (existingNames.has(newName)) {\n                newName = `${sound.name} (${counter})`;\n                counter++;\n              }\n              existingNames.add(newName);\n              return {\n                ...sound,\n                id: maxId + index + 1,\n                // æ–°ã—ã„IDã‚’å‰²ã‚Šå½“ã¦\n                name: newName // é‡è¤‡ã—ãªã„åå‰ã‚’è¨­å®š\n              };\n            });\n            console.log('éŸ³ç´ æã‚’è¿½åŠ ã—ã¾ã—ãŸ:', newSounds.length, 'å€‹ï¼ˆæ—¢å­˜:', prevSounds.length, 'å€‹ï¼‰');\n            return [...prevSounds, ...newSounds];\n          });\n        }\n        console.log('ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ');\n        setError(null);\n      } catch (error) {\n        console.error('ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);\n        setError('ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒ•ã‚¡ã‚¤ãƒ«ãŒæ­£ã—ã„ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚');\n      }\n    };\n    reader.readAsText(file);\n    // ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠã‚’ãƒªã‚»ãƒƒãƒˆ\n    event.target.value = '';\n  };\n\n  // éŸ³æºå‡ºåŠ›æ©Ÿèƒ½\n  const exportAudio = async () => {\n    if (!audioContext) {\n      setError('AudioContextãŒåˆæœŸåŒ–ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚');\n      return;\n    }\n    setIsExporting(true);\n    try {\n      // å…¨ãƒˆãƒ©ãƒƒã‚¯ã®å…¨ã‚¯ãƒªãƒƒãƒ—ã®æœ€å¤§çµ‚äº†æ™‚é–“ã‚’è¨ˆç®—\n      let maxDuration = 0;\n      tracks.forEach(track => {\n        track.clips.forEach(clip => {\n          const pixelsPerSecond = bpm / 60 * 100;\n          const clipStartTimeInSeconds = clip.startTime / pixelsPerSecond;\n          const clipDurationInSeconds = clip.duration / pixelsPerSecond;\n          const clipEndTime = clipStartTimeInSeconds + clipDurationInSeconds;\n          maxDuration = Math.max(maxDuration, clipEndTime);\n        });\n      });\n      if (maxDuration === 0) {\n        setError('å‡ºåŠ›ã™ã‚‹éŸ³å£°ãŒã‚ã‚Šã¾ã›ã‚“ã€‚éŸ³ç´ æã‚’é…ç½®ã—ã¦ãã ã•ã„ã€‚');\n        setIsExporting(false);\n        return;\n      }\n\n      // å‡ºåŠ›ç”¨AudioContextã‚’ä½œæˆï¼ˆ44.1kHzï¼‰\n      const exportContext = new AudioContext({\n        sampleRate: 44100\n      });\n      const bufferLength = Math.ceil(maxDuration * exportContext.sampleRate);\n      const outputBuffer = exportContext.createBuffer(2, bufferLength, exportContext.sampleRate);\n      const leftChannel = outputBuffer.getChannelData(0);\n      const rightChannel = outputBuffer.getChannelData(1);\n\n      // å„ãƒˆãƒ©ãƒƒã‚¯ã®å„ã‚¯ãƒªãƒƒãƒ—ã‚’å‡¦ç†\n      for (const track of tracks) {\n        for (const clip of track.clips) {\n          if (clip.soundData && clip.soundData.audioBlob) {\n            try {\n              const arrayBuffer = await clip.soundData.audioBlob.arrayBuffer();\n              const audioBuffer = await exportContext.decodeAudioData(arrayBuffer);\n              const pixelsPerSecond = bpm / 60 * 100;\n              const startTimeInSamples = Math.floor(clip.startTime / pixelsPerSecond * exportContext.sampleRate);\n\n              // éŸ³å£°ã‚’ãƒŸãƒƒã‚¯ã‚¹\n              for (let channel = 0; channel < Math.min(audioBuffer.numberOfChannels, 2); channel++) {\n                const sourceData = audioBuffer.getChannelData(channel);\n                const targetData = channel === 0 ? leftChannel : rightChannel;\n                for (let i = 0; i < sourceData.length && startTimeInSamples + i < targetData.length; i++) {\n                  targetData[startTimeInSamples + i] += sourceData[i];\n                }\n              }\n\n              // ãƒ¢ãƒãƒ©ãƒ«éŸ³æºã®å ´åˆã¯ä¸¡ãƒãƒ£ãƒ³ãƒãƒ«ã«ã‚³ãƒ”ãƒ¼\n              if (audioBuffer.numberOfChannels === 1) {\n                const sourceData = audioBuffer.getChannelData(0);\n                for (let i = 0; i < sourceData.length && startTimeInSamples + i < rightChannel.length; i++) {\n                  rightChannel[startTimeInSamples + i] += sourceData[i];\n                }\n              }\n            } catch (error) {\n              console.error('ã‚¯ãƒªãƒƒãƒ—ã®å‡¦ç†ã‚¨ãƒ©ãƒ¼:', error);\n            }\n          }\n        }\n      }\n\n      // WAVãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦å‡ºåŠ›\n      const wavBlob = audioBufferToWav(outputBuffer);\n      const url = URL.createObjectURL(wavBlob);\n      const link = document.createElement('a');\n      link.href = url;\n      link.download = `exported-music-${new Date().toISOString().slice(0, 19).replace(/:/g, '-')}.wav`;\n      document.body.appendChild(link);\n      link.click();\n      document.body.removeChild(link);\n      URL.revokeObjectURL(url);\n      console.log('éŸ³æºã‚’å‡ºåŠ›ã—ã¾ã—ãŸ');\n      await exportContext.close();\n    } catch (error) {\n      console.error('éŸ³æºå‡ºåŠ›ã‚¨ãƒ©ãƒ¼:', error);\n      setError('éŸ³æºã®å‡ºåŠ›ã«å¤±æ•—ã—ã¾ã—ãŸã€‚');\n    } finally {\n      setIsExporting(false);\n    }\n  };\n\n  // AudioBufferã‚’WAVãƒ•ã‚¡ã‚¤ãƒ«ã«å¤‰æ›\n  const audioBufferToWav = buffer => {\n    const length = buffer.length;\n    const numberOfChannels = buffer.numberOfChannels;\n    const sampleRate = buffer.sampleRate;\n    const bytesPerSample = 2;\n    const blockAlign = numberOfChannels * bytesPerSample;\n    const byteRate = sampleRate * blockAlign;\n    const dataSize = length * blockAlign;\n    const bufferSize = 44 + dataSize;\n    const arrayBuffer = new ArrayBuffer(bufferSize);\n    const view = new DataView(arrayBuffer);\n\n    // WAVãƒ•ã‚¡ã‚¤ãƒ«ãƒ˜ãƒƒãƒ€ãƒ¼\n    const writeString = (offset, string) => {\n      for (let i = 0; i < string.length; i++) {\n        view.setUint8(offset + i, string.charCodeAt(i));\n      }\n    };\n    writeString(0, 'RIFF');\n    view.setUint32(4, bufferSize - 8, true);\n    writeString(8, 'WAVE');\n    writeString(12, 'fmt ');\n    view.setUint32(16, 16, true);\n    view.setUint16(20, 1, true);\n    view.setUint16(22, numberOfChannels, true);\n    view.setUint32(24, sampleRate, true);\n    view.setUint32(28, byteRate, true);\n    view.setUint16(32, blockAlign, true);\n    view.setUint16(34, bytesPerSample * 8, true);\n    writeString(36, 'data');\n    view.setUint32(40, dataSize, true);\n\n    // éŸ³å£°ãƒ‡ãƒ¼ã‚¿\n    let offset = 44;\n    for (let i = 0; i < length; i++) {\n      for (let channel = 0; channel < numberOfChannels; channel++) {\n        const sample = buffer.getChannelData(channel)[i];\n        const intSample = Math.max(-1, Math.min(1, sample)) * 0x7FFF;\n        view.setInt16(offset, intSample, true);\n        offset += 2;\n      }\n    }\n    return new Blob([arrayBuffer], {\n      type: 'audio/wav'\n    });\n  };\n  const addTrack = () => {\n    // ã‚ˆã‚Šç¢ºå®Ÿã«ãƒ¦ãƒ‹ãƒ¼ã‚¯ãªIDã‚’ç”Ÿæˆ\n    trackIdCounterRef.current += 1;\n    const uniqueId = Date.now() + trackIdCounterRef.current;\n\n    // ãƒˆãƒ©ãƒƒã‚¯åã®ç•ªå·ã‚’å¢—åŠ ï¼ˆå‰Šé™¤ã•ã‚Œã¦ã‚‚ç•ªå·ã¯æˆ»ã‚‰ãªã„ï¼‰\n    trackNameCounterRef.current += 1;\n    const trackName = `ãƒˆãƒ©ãƒƒã‚¯ ${trackNameCounterRef.current}`;\n    const newTrack = {\n      id: uniqueId,\n      name: trackName,\n      clips: []\n    };\n    setTracks(prevTracks => [...prevTracks, newTrack]);\n  };\n  const removeTrack = trackId => {\n    setTracks(prevTracks => {\n      if (prevTracks.length > 1) {\n        return prevTracks.filter(track => track.id !== trackId);\n      }\n      return prevTracks;\n    });\n  };\n  const handleDrop = async (e, trackId, timePosition) => {\n    e.preventDefault();\n    setDragPreview(null);\n    console.log('ãƒ‰ãƒ­ãƒƒãƒ—å‡¦ç†é–‹å§‹:', {\n      trackId,\n      timePosition,\n      draggedClip\n    });\n    try {\n      // 8åˆ†éŸ³ç¬¦ã«åˆã‚ã›ã¦ä½ç½®ã‚’èª¿æ•´ï¼ˆ50pxå˜ä½ï¼‰\n      const snappedPosition = Math.round(timePosition / SUB_BEAT_WIDTH) * SUB_BEAT_WIDTH;\n\n      // æ—¢å­˜ã®ã‚¯ãƒªãƒƒãƒ—ã®ç§»å‹•ã‹ã©ã†ã‹ãƒã‚§ãƒƒã‚¯\n      if (draggedClip) {\n        console.log('æ—¢å­˜ã‚¯ãƒªãƒƒãƒ—ã®ç§»å‹•:', draggedClip.id, 'å…ƒãƒˆãƒ©ãƒƒã‚¯:', draggedClip.originalTrackId, 'æ–°ãƒˆãƒ©ãƒƒã‚¯:', trackId);\n\n        // æ—¢å­˜ã‚¯ãƒªãƒƒãƒ—ã®ç§»å‹•\n        const updatedClip = {\n          ...draggedClip,\n          startTime: snappedPosition,\n          trackId: trackId\n        };\n        setTracks(prevTracks => prevTracks.map(track => {\n          if (track.id === draggedClip.originalTrackId && track.id === trackId) {\n            // åŒã˜ãƒˆãƒ©ãƒƒã‚¯å†…ã§ã®ç§»å‹•\n            console.log('åŒã˜ãƒˆãƒ©ãƒƒã‚¯å†…ã§ã®ç§»å‹•');\n            return {\n              ...track,\n              clips: track.clips.map(clip => clip.id === draggedClip.id ? updatedClip : clip)\n            };\n          } else if (track.id === draggedClip.originalTrackId) {\n            // å…ƒã®ãƒˆãƒ©ãƒƒã‚¯ã‹ã‚‰ã‚¯ãƒªãƒƒãƒ—ã‚’å‰Šé™¤\n            console.log('å…ƒã®ãƒˆãƒ©ãƒƒã‚¯ã‹ã‚‰ã‚¯ãƒªãƒƒãƒ—ã‚’å‰Šé™¤');\n            return {\n              ...track,\n              clips: track.clips.filter(clip => clip.id !== draggedClip.id)\n            };\n          } else if (track.id === trackId) {\n            // æ–°ã—ã„ãƒˆãƒ©ãƒƒã‚¯ã«ã‚¯ãƒªãƒƒãƒ—ã‚’è¿½åŠ \n            console.log('æ–°ã—ã„ãƒˆãƒ©ãƒƒã‚¯ã«ã‚¯ãƒªãƒƒãƒ—ã‚’è¿½åŠ ');\n            return {\n              ...track,\n              clips: [...track.clips, updatedClip]\n            };\n          }\n          return track;\n        }));\n        setDraggedClip(null);\n        return;\n      }\n\n      // æ–°ã—ã„éŸ³ç´ æã®é…ç½®\n      let soundData;\n      try {\n        // dataTransferã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—\n        const jsonData = e.dataTransfer ? e.dataTransfer.getData('application/json') : '';\n        if (jsonData) {\n          soundData = JSON.parse(jsonData);\n        } else {\n          // ãƒ¢ãƒã‚¤ãƒ«ã®å ´åˆã¯ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã‹ã‚‰å–å¾—\n          soundData = window.currentDraggedSound;\n        }\n      } catch (error) {\n        console.error('ãƒ‰ãƒ©ãƒƒã‚°ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—:', error);\n        soundData = window.currentDraggedSound; // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯\n      }\n      if (!soundData) {\n        console.error('éŸ³ç´ æãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');\n        setError('éŸ³ç´ æãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚');\n        return;\n      }\n\n      // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã‹ã‚‰audioBlobã‚’å¾©å…ƒ\n      if (window.currentDraggedSoundBlob) {\n        soundData.audioBlob = window.currentDraggedSoundBlob;\n        window.currentDraggedSoundBlob = null; // ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—\n      }\n\n      // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã‚’ã‚¯ãƒªã‚¢\n      window.currentDraggedSound = null;\n      console.log('æ–°ã—ã„éŸ³ç´ æã®ãƒ‰ãƒ­ãƒƒãƒ—:', {\n        soundData,\n        hasAudioBlob: !!soundData.audioBlob\n      });\n\n      // éŸ³å£°ã®å®Ÿéš›ã®ç¶™ç¶šæ™‚é–“ã‚’å–å¾—ï¼ˆç¾åœ¨ã®BPMã«åŸºã¥ã„ã¦ï¼‰\n      let duration = 400; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ï¼ˆ1å°ç¯€ï¼‰\n      if (soundData.audioBlob) {\n        try {\n          duration = await getAudioDuration(soundData.audioBlob, bpm);\n          console.log('å–å¾—ã—ãŸduration:', duration, 'pixels (BPM:', bpm, ')');\n        } catch (error) {\n          console.warn('éŸ³å£°ç¶™ç¶šæ™‚é–“ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ:', error);\n        }\n      }\n\n      // durationãŒæœ‰åŠ¹ãªå€¤ã‹ãƒã‚§ãƒƒã‚¯\n      if (!isFinite(duration) || duration <= 0) {\n        console.warn('ç„¡åŠ¹ãªduration:', duration, 'ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’ä½¿ç”¨');\n        duration = 400; // 1å°ç¯€åˆ†\n      }\n      const newClip = {\n        id: Date.now() + Math.random(),\n        // ã‚ˆã‚Šç¢ºå®Ÿã«ãƒ¦ãƒ‹ãƒ¼ã‚¯ãªIDã‚’ç”Ÿæˆ\n        soundData: soundData,\n        startTime: snappedPosition,\n        duration: duration,\n        trackId: trackId\n      };\n      console.log('ä½œæˆã•ã‚ŒãŸã‚¯ãƒªãƒƒãƒ—:', newClip);\n      console.log('ç¾åœ¨ã®ãƒˆãƒ©ãƒƒã‚¯æ•°:', tracks.length);\n      console.log('å¯¾è±¡ãƒˆãƒ©ãƒƒã‚¯ID:', trackId);\n      console.log('å¯¾è±¡ãƒˆãƒ©ãƒƒã‚¯:', tracks.find(t => t.id === trackId));\n\n      // é–¢æ•°å‹æ›´æ–°ã‚’ä½¿ç”¨ã—ã¦æœ€æ–°ã®çŠ¶æ…‹ã‚’ç¢ºå®Ÿã«å–å¾—\n      setTracks(prevTracks => {\n        console.log('æ›´æ–°å‰ã®ãƒˆãƒ©ãƒƒã‚¯:', prevTracks.find(t => t.id === trackId));\n        const updatedTracks = prevTracks.map(track => track.id === trackId ? {\n          ...track,\n          clips: [...track.clips, newClip]\n        } : track);\n        console.log('æ›´æ–°å¾Œã®ãƒˆãƒ©ãƒƒã‚¯:', updatedTracks.find(t => t.id === trackId));\n        return updatedTracks;\n      });\n    } catch (error) {\n      console.error('ãƒ‰ãƒ­ãƒƒãƒ—ã‚¨ãƒ©ãƒ¼:', error);\n      setError('éŸ³ç´ æã®é…ç½®ã«å¤±æ•—ã—ã¾ã—ãŸã€‚å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚');\n    }\n  };\n  const handleDragOver = e => {\n    var _timelineRef$current;\n    e.preventDefault();\n\n    // ãƒ‰ãƒ©ãƒƒã‚°ã•ã‚Œã¦ã„ã‚‹ã®ãŒæ—¢å­˜ã‚¯ãƒªãƒƒãƒ—ã‹æ–°ã—ã„éŸ³ç´ æã‹ã§å‡¦ç†ã‚’åˆ†ã‘ã‚‹\n    if (draggedClip) {\n      e.dataTransfer.dropEffect = 'move';\n    } else {\n      e.dataTransfer.dropEffect = 'copy';\n    }\n\n    // ãƒ‰ãƒ©ãƒƒã‚°ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã®æ›´æ–°\n    const rect = e.currentTarget.getBoundingClientRect();\n    const timePosition = e.clientX - rect.left;\n    const snappedPosition = Math.round(timePosition / SUB_BEAT_WIDTH) * SUB_BEAT_WIDTH;\n    const trackElement = e.currentTarget;\n    const trackRect = trackElement.getBoundingClientRect();\n    const tracksAreaRect = (_timelineRef$current = timelineRef.current) === null || _timelineRef$current === void 0 ? void 0 : _timelineRef$current.getBoundingClientRect();\n    if (tracksAreaRect) {\n      const relativeTop = trackRect.top - tracksAreaRect.top;\n      const trackId = parseInt(trackElement.dataset.trackId);\n\n      // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼å¹…ã‚’æ±ºå®š\n      let previewWidth = 400; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ï¼ˆ1å°ç¯€ï¼‰\n\n      if (draggedClip) {\n        // æ—¢å­˜ã‚¯ãƒªãƒƒãƒ—ã®å ´åˆ\n        previewWidth = isFinite(draggedClip.duration) && draggedClip.duration > 0 ? draggedClip.duration : 400;\n        console.log('æ—¢å­˜ã‚¯ãƒªãƒƒãƒ—ã®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼å¹…:', previewWidth);\n      } else {\n        // æ–°ã—ã„éŸ³ç´ æã®å ´åˆã€äº‹å‰ã«è¨ˆç®—ã•ã‚ŒãŸé•·ã•ã‚’ä½¿ç”¨\n        previewWidth = draggedSoundDuration;\n        console.log('æ–°ã—ã„éŸ³ç´ æã®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼å¹…:', previewWidth, '(draggedSoundDuration)');\n      }\n      setDragPreview({\n        left: snappedPosition,\n        top: relativeTop + 10,\n        width: previewWidth,\n        trackId: trackId\n      });\n    }\n  };\n  const removeClip = (trackId, clipId) => {\n    setTracks(prevTracks => prevTracks.map(track => track.id === trackId ? {\n      ...track,\n      clips: track.clips.filter(clip => clip.id !== clipId)\n    } : track));\n  };\n\n  // ã‚¯ãƒªãƒƒãƒ—ã®ãƒ‰ãƒ©ãƒƒã‚°é–‹å§‹\n  const handleClipDragStart = (clip, originalTrackId) => {\n    console.log('ã‚¯ãƒªãƒƒãƒ—ãƒ‰ãƒ©ãƒƒã‚°é–‹å§‹:', clip.id, 'ãƒˆãƒ©ãƒƒã‚¯:', originalTrackId);\n    setDraggedClip({\n      ...clip,\n      originalTrackId\n    });\n  };\n\n  // ãƒ‰ãƒ©ãƒƒã‚°çµ‚äº†æ™‚ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—\n  const handleDragEnd = e => {\n    // ãƒ‰ãƒ­ãƒƒãƒ—ãŒæ­£å¸¸ã«å‡¦ç†ã•ã‚Œãªã‹ã£ãŸå ´åˆã€å…ƒã®çŠ¶æ…‹ã‚’ä¿æŒ\n    if (draggedClip && e && e.dataTransfer && e.dataTransfer.dropEffect === 'none') {\n      console.log('ãƒ‰ãƒ©ãƒƒã‚°ãŒã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã‚Œã¾ã—ãŸã€‚å…ƒã®ä½ç½®ã‚’ä¿æŒã—ã¾ã™ã€‚');\n    }\n    setDraggedClip(null);\n    setDragPreview(null);\n    setDraggedSoundDuration(400); // ãƒªã‚»ãƒƒãƒˆ\n  };\n  const play = async () => {\n    try {\n      // AudioContextãŒä¸­æ–­ã•ã‚Œã¦ã„ã‚‹å ´åˆã¯å†é–‹\n      if (audioContext && audioContext.state === 'suspended') {\n        await audioContext.resume();\n      }\n      setIsPlaying(true);\n\n      // ç¾åœ¨ã®æ™‚é–“ä½ç½®ã«åŸºã¥ã„ã¦ã€å†ç”Ÿã™ã¹ãã‚¯ãƒªãƒƒãƒ—ã‚’è¦‹ã¤ã‘ã‚‹\n      const pixelsPerSecond = bpm / 60 * 100;\n      const currentTimeInSeconds = currentTime / pixelsPerSecond;\n\n      // å„ãƒˆãƒ©ãƒƒã‚¯ã®ã‚¯ãƒªãƒƒãƒ—ã‚’å†ç”Ÿ\n      const newPlayingAudios = new Map();\n      tracks.forEach(track => {\n        track.clips.forEach(clip => {\n          // clip.durationãŒæœ‰åŠ¹ãªå€¤ã‹ãƒã‚§ãƒƒã‚¯\n          if (!isFinite(clip.duration) || clip.duration <= 0) {\n            console.warn('ç„¡åŠ¹ãªclip.duration:', clip.duration, 'ã‚¯ãƒªãƒƒãƒ—ã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã¾ã™');\n            return;\n          }\n          const clipStartTimeInSeconds = clip.startTime / pixelsPerSecond;\n          const clipEndTimeInSeconds = clipStartTimeInSeconds + clip.duration / pixelsPerSecond;\n\n          // è¨ˆç®—çµæœãŒæœ‰åŠ¹ã‹ãƒã‚§ãƒƒã‚¯\n          if (!isFinite(clipStartTimeInSeconds) || !isFinite(clipEndTimeInSeconds)) {\n            console.warn('ç„¡åŠ¹ãªæ™‚é–“è¨ˆç®—:', {\n              clipStartTimeInSeconds,\n              clipEndTimeInSeconds\n            });\n            return;\n          }\n\n          // ç¾åœ¨ã®æ™‚é–“ä½ç½®ãŒã‚¯ãƒªãƒƒãƒ—ã®ç¯„å›²å†…ã¾ãŸã¯ä»Šå¾Œå†ç”Ÿã•ã‚Œã‚‹å ´åˆ\n          if (clipEndTimeInSeconds > currentTimeInSeconds) {\n            const delay = Math.max(0, clipStartTimeInSeconds - currentTimeInSeconds);\n            if (isFinite(delay) && delay >= 0) {\n              scheduleClipPlayback(clip, delay * 1000, newPlayingAudios);\n            }\n          }\n        });\n      });\n      setPlayingAudios(newPlayingAudios);\n    } catch (error) {\n      console.error('å†ç”Ÿã‚¨ãƒ©ãƒ¼:', error);\n      setError('éŸ³å£°ã®å†ç”Ÿã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒ–ãƒ©ã‚¦ã‚¶ã§éŸ³å£°ãŒæœ‰åŠ¹ã«ãªã£ã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚');\n    }\n  };\n  const scheduleClipPlayback = (clip, delayMs, playingAudiosMap) => {\n    var _clip$soundData;\n    console.log('scheduleClipPlayback:', {\n      clip,\n      hasAudioBlob: !!((_clip$soundData = clip.soundData) !== null && _clip$soundData !== void 0 && _clip$soundData.audioBlob)\n    });\n    if (clip.soundData && clip.soundData.audioBlob && clip.soundData.audioBlob instanceof Blob) {\n      try {\n        const audio = new Audio();\n        const audioUrl = URL.createObjectURL(clip.soundData.audioBlob);\n        audio.src = audioUrl;\n        const timeoutId = setTimeout(() => {\n          audio.play().catch(error => {\n            console.error('éŸ³å£°å†ç”Ÿã‚¨ãƒ©ãƒ¼:', error);\n            URL.revokeObjectURL(audioUrl); // ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯ã‚’é˜²ã\n          });\n        }, delayMs);\n\n        // éŸ³å£°çµ‚äº†æ™‚ã«URLã‚’è§£æ”¾\n        audio.addEventListener('ended', () => {\n          URL.revokeObjectURL(audioUrl);\n        });\n        playingAudiosMap.set(clip.id, {\n          audio,\n          timeoutId,\n          audioUrl\n        });\n      } catch (error) {\n        console.error('createObjectURL ã‚¨ãƒ©ãƒ¼:', error, 'audioBlob:', clip.soundData.audioBlob);\n      }\n    } else {\n      var _clip$soundData2, _clip$soundData3, _clip$soundData4, _clip$soundData5, _clip$soundData6;\n      console.warn('audioBlobãŒç„¡åŠ¹ã§ã™ã€‚ã‚¯ãƒªãƒƒãƒ—æƒ…å ±:', {\n        clipId: clip.id,\n        soundDataName: (_clip$soundData2 = clip.soundData) === null || _clip$soundData2 === void 0 ? void 0 : _clip$soundData2.name,\n        hasAudioData: !!((_clip$soundData3 = clip.soundData) !== null && _clip$soundData3 !== void 0 && _clip$soundData3.audioData),\n        hasAudioBlob: !!((_clip$soundData4 = clip.soundData) !== null && _clip$soundData4 !== void 0 && _clip$soundData4.audioBlob),\n        audioBlobType: typeof ((_clip$soundData5 = clip.soundData) === null || _clip$soundData5 === void 0 ? void 0 : _clip$soundData5.audioBlob),\n        isInstanceOfBlob: ((_clip$soundData6 = clip.soundData) === null || _clip$soundData6 === void 0 ? void 0 : _clip$soundData6.audioBlob) instanceof Blob\n      });\n\n      // AudioBlobãŒç„¡åŠ¹ãªå ´åˆã€audioDataã‹ã‚‰å¾©å…ƒã‚’è©¦è¡Œ\n      if (clip.soundData && clip.soundData.audioData && !clip.soundData.audioBlob) {\n        console.log('audioDataã‹ã‚‰Blobã‚’å†ä½œæˆä¸­...');\n        try {\n          const byteCharacters = atob(clip.soundData.audioData.split(',')[1]);\n          const byteNumbers = new Array(byteCharacters.length);\n          for (let i = 0; i < byteCharacters.length; i++) {\n            byteNumbers[i] = byteCharacters.charCodeAt(i);\n          }\n          const byteArray = new Uint8Array(byteNumbers);\n          const blob = new Blob([byteArray], {\n            type: 'audio/wav'\n          });\n\n          // ã‚¯ãƒªãƒƒãƒ—ã®soundDataã‚’æ›´æ–°\n          clip.soundData.audioBlob = blob;\n\n          // å†å¸°çš„ã«å†è©¦è¡Œ\n          scheduleClipPlayback(clip, delayMs, playingAudiosMap);\n          return;\n        } catch (restoreError) {\n          console.error('audioDataã‹ã‚‰ã®Blobå¾©å…ƒã«å¤±æ•—:', restoreError);\n        }\n      }\n    }\n  };\n  const pause = () => {\n    setIsPlaying(false);\n\n    // å†ç”Ÿä¸­ã®éŸ³å£°ã‚’ä¸€æ™‚åœæ­¢\n    playingAudios.forEach(({\n      audio,\n      timeoutId,\n      audioUrl\n    }) => {\n      if (timeoutId) {\n        clearTimeout(timeoutId);\n      }\n      if (!audio.paused) {\n        audio.pause();\n      }\n      // URLã‚’è§£æ”¾\n      if (audioUrl) {\n        URL.revokeObjectURL(audioUrl);\n      }\n    });\n  };\n  const stop = () => {\n    setIsPlaying(false);\n    setCurrentTime(0);\n\n    // å†ç”Ÿä¸­ã®éŸ³å£°ã‚’åœæ­¢\n    playingAudios.forEach(({\n      audio,\n      timeoutId,\n      audioUrl\n    }) => {\n      if (timeoutId) {\n        clearTimeout(timeoutId);\n      }\n      audio.pause();\n      audio.currentTime = 0;\n      // URLã‚’è§£æ”¾\n      if (audioUrl) {\n        URL.revokeObjectURL(audioUrl);\n      }\n    });\n    setPlayingAudios(new Map());\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"daw-page\",\n    children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n      children: \"\\uD83C\\uDFB9 \\u97F3\\u697D\\u3065\\u304F\\u308A\\u30DA\\u30FC\\u30B8\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 878,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n      children: \"\\u97F3\\u7D20\\u6750\\u3092\\u30C9\\u30E9\\u30C3\\u30B0&\\u30C9\\u30ED\\u30C3\\u30D7\\u3057\\u3066\\u97F3\\u697D\\u3092\\u4F5C\\u308A\\u307E\\u3057\\u3087\\u3046\\uFF01\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 879,\n      columnNumber: 7\n    }, this), error && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"error-message\",\n      children: [/*#__PURE__*/_jsxDEV(\"span\", {\n        children: [\"\\u26A0\\uFE0F \", error]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 883,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: () => setError(null),\n        children: \"\\xD7\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 884,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 882,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"daw-controls card\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"transport-controls\",\n        children: [/*#__PURE__*/_jsxDEV(\"button\", {\n          className: `transport-btn play-btn ${isPlaying ? 'playing' : ''}`,\n          onClick: isPlaying ? pause : play,\n          children: isPlaying ? 'â¸ï¸' : 'â–¶ï¸'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 890,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"transport-btn stop-btn\",\n          onClick: stop,\n          children: \"\\u23F9\\uFE0F\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 896,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 889,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"bpm-control\",\n        children: [/*#__PURE__*/_jsxDEV(\"label\", {\n          htmlFor: \"bpm\",\n          children: \"\\uD83C\\uDFB5 BPM:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 902,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          id: \"bpm\",\n          type: \"number\",\n          value: bpm,\n          onChange: e => handleBpmChange(parseInt(e.target.value)),\n          min: \"60\",\n          max: \"200\",\n          className: \"bpm-input\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 903,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 901,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"track-controls\",\n        children: [/*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"button-primary\",\n          onClick: addTrack,\n          children: \"\\u2795 \\u30C8\\u30E9\\u30C3\\u30AF\\u8FFD\\u52A0\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 915,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"button-secondary\",\n          onClick: () => setShowSoundPanel(!showSoundPanel),\n          children: showSoundPanel ? 'ğŸµ éŸ³ç´ æã‚’éš ã™' : 'ğŸµ éŸ³ç´ æã‚’è¡¨ç¤º'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 918,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 914,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"project-controls\",\n        children: [/*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"button-secondary\",\n          onClick: saveProject,\n          children: \"\\uD83D\\uDCBE \\u30D7\\u30ED\\u30B8\\u30A7\\u30AF\\u30C8\\u4FDD\\u5B58\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 927,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n          className: \"button-secondary file-input-label\",\n          children: [\"\\uD83D\\uDCC1 \\u30D7\\u30ED\\u30B8\\u30A7\\u30AF\\u30C8\\u8AAD\\u307F\\u8FBC\\u307F\", /*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"file\",\n            accept: \".json\",\n            onChange: loadProject,\n            style: {\n              display: 'none'\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 932,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 930,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"button-primary\",\n          onClick: exportAudio,\n          disabled: isExporting,\n          children: isExporting ? 'ğŸ”„ å‡ºåŠ›ä¸­...' : 'ğŸ§ éŸ³æºå‡ºåŠ›'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 939,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 926,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 888,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"daw-main-area\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: `sound-panel ${!showSoundPanel ? 'panel-hidden' : ''}`,\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"sound-panel-header\",\n          children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n            children: \"\\uD83C\\uDFB5 \\u97F3\\u7D20\\u6750\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 952,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"sound-panel-close\",\n            onClick: () => setShowSoundPanel(false),\n            title: \"\\u97F3\\u7D20\\u6750\\u30D1\\u30CD\\u30EB\\u3092\\u9589\\u3058\\u308B\",\n            children: \"\\u2715\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 953,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 951,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"sound-list\",\n          children: sounds.length > 0 ? sounds.map(sound => /*#__PURE__*/_jsxDEV(SoundItem, {\n            sound: sound,\n            onDragStart: async sound => {\n              // ãƒ‰ãƒ©ãƒƒã‚°é–‹å§‹æ™‚ã«éŸ³å£°ã®é•·ã•ã‚’è¨ˆç®—\n              console.log('ãƒ‰ãƒ©ãƒƒã‚°é–‹å§‹ - éŸ³å£°é•·ã•è¨ˆç®—ä¸­:', sound.name);\n              if (sound.audioBlob) {\n                try {\n                  const duration = await getAudioDuration(sound.audioBlob, bpm);\n                  console.log('è¨ˆç®—ã•ã‚ŒãŸéŸ³å£°é•·ã•:', duration, 'px');\n                  setDraggedSoundDuration(duration);\n                } catch (error) {\n                  console.warn('ãƒ‰ãƒ©ãƒƒã‚°æ™‚ã®éŸ³å£°é•·ã•è¨ˆç®—ã«å¤±æ•—:', error);\n                  setDraggedSoundDuration(400);\n                }\n              } else {\n                console.log('audioBlob ãŒå­˜åœ¨ã—ã¾ã›ã‚“ - ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ä½¿ç”¨');\n                setDraggedSoundDuration(400);\n              }\n            }\n          }, sound.id, false, {\n            fileName: _jsxFileName,\n            lineNumber: 964,\n            columnNumber: 17\n          }, this)) : /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"no-sounds\",\n            children: [/*#__PURE__*/_jsxDEV(\"p\", {\n              children: \"\\u97F3\\u7D20\\u6750\\u304C\\u3042\\u308A\\u307E\\u305B\\u3093\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 988,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n              children: \"\\u300C\\u97F3\\u3042\\u3064\\u3081\\u300D\\u30DA\\u30FC\\u30B8\\u3067\\u97F3\\u3092\\u9332\\u97F3\\u3057\\u3066\\u304F\\u3060\\u3055\\u3044\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 989,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 987,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 961,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 950,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: `daw-workspace ${!showSoundPanel ? 'panel-hidden' : ''}`,\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"track-headers\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"timeline-header-spacer\",\n            children: \"\\u30BF\\u30A4\\u30E0\\u30E9\\u30A4\\u30F3\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 997,\n            columnNumber: 13\n          }, this), tracks.map(track => /*#__PURE__*/_jsxDEV(TrackHeader, {\n            track: track,\n            onRemove: removeTrack,\n            trackHeight: trackHeight\n          }, track.id, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1001,\n            columnNumber: 15\n          }, this))]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 996,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"timeline-container\",\n          children: [/*#__PURE__*/_jsxDEV(Timeline, {\n            bpm: bpm\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1011,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"tracks-area\",\n            ref: timelineRef,\n            style: {\n              minWidth: TOTAL_MEASURES * MEASURE_WIDTH\n            },\n            children: [/*#__PURE__*/_jsxDEV(Playhead, {\n              currentTime: currentTime\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1013,\n              columnNumber: 15\n            }, this), dragPreview && /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"drag-preview\",\n              style: {\n                left: dragPreview.left,\n                top: dragPreview.top,\n                width: dragPreview.width\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1015,\n              columnNumber: 17\n            }, this), tracks.map(track => /*#__PURE__*/_jsxDEV(Track, {\n              track: track,\n              onDrop: handleDrop,\n              onDragOver: handleDragOver,\n              onRemoveClip: removeClip,\n              onClipDragStart: handleClipDragStart,\n              onDragEnd: handleDragEnd,\n              trackHeight: trackHeight,\n              bpm: bpm\n            }, track.id, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1025,\n              columnNumber: 17\n            }, this))]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1012,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1010,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 995,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 949,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"instructions card\",\n      children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n        children: \"\\uD83D\\uDCD6 \\u4F7F\\u3044\\u65B9\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1043,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"ul\", {\n        children: [/*#__PURE__*/_jsxDEV(\"li\", {\n          children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n            children: \"\\uD83D\\uDDA5\\uFE0F PC:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1045,\n            columnNumber: 15\n          }, this), \" \\u5DE6\\u5074\\u306E\\u97F3\\u7D20\\u6750\\u30D1\\u30CD\\u30EB\\u304B\\u3089\\u97F3\\u7D20\\u6750\\u3092\\u30C8\\u30E9\\u30C3\\u30AF\\u306B\\u30C9\\u30E9\\u30C3\\u30B0&\\u30C9\\u30ED\\u30C3\\u30D7\\u3057\\u3066\\u914D\\u7F6E\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1045,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n          children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n            children: \"\\uD83D\\uDCF1 \\u30B9\\u30DE\\u30DB/\\u30BF\\u30D6\\u30EC\\u30C3\\u30C8:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1046,\n            columnNumber: 15\n          }, this), \" \\u97F3\\u7D20\\u6750\\u3092\\u9577\\u62BC\\u3057\\u3057\\u3066\\u304B\\u3089\\u30C8\\u30E9\\u30C3\\u30AF\\u307E\\u3067\\u30C9\\u30E9\\u30C3\\u30B0\\u3057\\u3066\\u914D\\u7F6E\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1046,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n          children: \"\\u914D\\u7F6E\\u6E08\\u307F\\u306E\\u97F3\\u7D20\\u6750\\u3082\\u30C9\\u30E9\\u30C3\\u30B0\\u3057\\u3066\\u5225\\u306E\\u5834\\u6240\\u306B\\u79FB\\u52D5\\u3067\\u304D\\u307E\\u3059\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1047,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n          children: \"\\u30C9\\u30E9\\u30C3\\u30B0\\u4E2D\\u306F\\u914D\\u7F6E\\u4E88\\u5B9A\\u4F4D\\u7F6E\\u306B\\u9752\\u3044\\u5F71\\u304C\\u8868\\u793A\\u3055\\u308C\\u307E\\u3059\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1048,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n          children: \"\\u97F3\\u7D20\\u6750\\u306F8\\u5206\\u97F3\\u7B26\\uFF08\\u88CF\\u62CD\\u542B\\u3080\\uFF09\\u306B\\u5408\\u308F\\u305B\\u3066\\u81EA\\u52D5\\u7684\\u306B\\u914D\\u7F6E\\u3055\\u308C\\u307E\\u3059\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1049,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n          children: \"\\u97F3\\u7D20\\u6750\\u30D1\\u30CD\\u30EB\\u306E\\u25B6\\uFE0F\\u30DC\\u30BF\\u30F3\\u3067\\u500B\\u5225\\u306B\\u97F3\\u3092\\u78BA\\u8A8D\\u3067\\u304D\\u307E\\u3059\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1050,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n          children: \"\\u25B6\\uFE0F\\u30DC\\u30BF\\u30F3\\u3067\\u518D\\u751F\\u3001\\u23F8\\uFE0F\\u30DC\\u30BF\\u30F3\\u3067\\u4E00\\u6642\\u505C\\u6B62\\u3001\\u23F9\\uFE0F\\u30DC\\u30BF\\u30F3\\u3067\\u505C\\u6B62\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1051,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n          children: \"BPM\\u3092\\u5909\\u66F4\\u3057\\u3066\\u97F3\\u697D\\u306E\\u901F\\u3055\\u3092\\u8ABF\\u6574\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1052,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n          children: \"\\u30C8\\u30E9\\u30C3\\u30AF\\u3092\\u8FFD\\u52A0\\u3057\\u3066\\u8907\\u6570\\u306E\\u97F3\\u3092\\u91CD\\u306D\\u308B\\u3053\\u3068\\u304C\\u3067\\u304D\\u307E\\u3059\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1053,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n          children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n            children: \"\\uD83D\\uDCBE \\u30D7\\u30ED\\u30B8\\u30A7\\u30AF\\u30C8\\u4FDD\\u5B58:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1054,\n            columnNumber: 15\n          }, this), \" \\u7DE8\\u96C6\\u4E2D\\u306E\\u30C7\\u30FC\\u30BF\\u3092JSON\\u30D5\\u30A1\\u30A4\\u30EB\\u3068\\u3057\\u3066\\u4FDD\\u5B58\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1054,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n          children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n            children: \"\\uD83D\\uDCC1 \\u30D7\\u30ED\\u30B8\\u30A7\\u30AF\\u30C8\\u8AAD\\u307F\\u8FBC\\u307F:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1055,\n            columnNumber: 15\n          }, this), \" \\u4FDD\\u5B58\\u3057\\u305F\\u30D7\\u30ED\\u30B8\\u30A7\\u30AF\\u30C8\\u30D5\\u30A1\\u30A4\\u30EB\\u3092\\u8AAD\\u307F\\u8FBC\\u3093\\u3067\\u7DE8\\u96C6\\u3092\\u518D\\u958B\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1055,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n          children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n            children: \"\\uD83C\\uDFA7 \\u97F3\\u6E90\\u51FA\\u529B:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1056,\n            columnNumber: 15\n          }, this), \" \\u5B8C\\u6210\\u3057\\u305F\\u697D\\u66F2\\u3092WAV\\u30D5\\u30A1\\u30A4\\u30EB\\u3068\\u3057\\u3066\\u51FA\\u529B\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1056,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1044,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"mobile-tips\",\n        children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n          children: \"\\uD83D\\uDCF1 \\u30B9\\u30DE\\u30FC\\u30C8\\u30D5\\u30A9\\u30F3\\u5229\\u7528\\u306E\\u30B3\\u30C4\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1059,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"ul\", {\n          children: [/*#__PURE__*/_jsxDEV(\"li\", {\n            children: \"\\u97F3\\u7D20\\u6750\\u3092\\u8EFD\\u304F\\u9577\\u62BC\\u3057\\u3059\\u308B\\u3068\\u30C9\\u30E9\\u30C3\\u30B0\\u30E2\\u30FC\\u30C9\\u306B\\u306A\\u308A\\u307E\\u3059\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1061,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n            children: \"\\u30C9\\u30E9\\u30C3\\u30B0\\u4E2D\\u306F\\u753B\\u9762\\u304C\\u30B9\\u30AF\\u30ED\\u30FC\\u30EB\\u3057\\u306A\\u3044\\u3088\\u3046\\u5236\\u5FA1\\u3055\\u308C\\u307E\\u3059\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1062,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n            children: \"\\u9752\\u304F\\u30CF\\u30A4\\u30E9\\u30A4\\u30C8\\u3055\\u308C\\u305F\\u30C8\\u30E9\\u30C3\\u30AF\\u3067\\u6307\\u3092\\u96E2\\u3059\\u3068\\u97F3\\u7D20\\u6750\\u304C\\u914D\\u7F6E\\u3055\\u308C\\u307E\\u3059\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1063,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n            children: \"\\u6A2A\\u753B\\u9762\\u8868\\u793A\\u306B\\u3059\\u308B\\u3068\\u3088\\u308A\\u4F7F\\u3044\\u3084\\u3059\\u304F\\u306A\\u308A\\u307E\\u3059\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1064,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1060,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1058,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 1042,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 877,\n    columnNumber: 5\n  }, this);\n};\n_s(DAWPage, \"p3/MRDsc9DTOjvad4k5XzbTJqsY=\");\n_c = DAWPage;\nconst SoundItem = ({\n  sound,\n  onDragStart\n}) => {\n  _s2();\n  const [isPlaying, setIsPlaying] = useState(false);\n  const [isDragging, setIsDragging] = useState(false);\n  const [touchStart, setTouchStart] = useState(null);\n  const [touchMove, setTouchMove] = useState(null);\n  const handleDragStart = e => {\n    // audioBlobä»¥å¤–ã®ãƒ‡ãƒ¼ã‚¿ã‚’JSONæ–‡å­—åˆ—ã¨ã—ã¦è¨­å®š\n    const soundDataForTransfer = {\n      ...sound,\n      audioBlob: null // Blobã¯ç›´æ¥ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºã§ããªã„ãŸã‚ä¸€æ™‚çš„ã«nullã«\n    };\n    e.dataTransfer.setData('application/json', JSON.stringify(soundDataForTransfer));\n    e.dataTransfer.effectAllowed = 'copy';\n\n    // å®Ÿéš›ã®audioBlobã¯åˆ¥é€”ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã§ä¿æŒ\n    window.currentDraggedSoundBlob = sound.audioBlob;\n\n    // è¦ªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®onDragStarté–¢æ•°ã‚’å‘¼ã³å‡ºã—ï¼ˆéŸ³å£°ã®é•·ã•ã‚’è¨ˆç®—ï¼‰\n    if (onDragStart) {\n      onDragStart(sound);\n    }\n  };\n\n  // ã‚¿ãƒƒãƒã‚¤ãƒ™ãƒ³ãƒˆå¯¾å¿œ\n  const handleTouchStart = e => {\n    const touch = e.touches[0];\n    setTouchStart({\n      x: touch.clientX,\n      y: touch.clientY\n    });\n    setIsDragging(false);\n\n    // é•·æŠ¼ã—åˆ¤å®šç”¨ã®ã‚¿ã‚¤ãƒãƒ¼\n    setTimeout(() => {\n      if (touchStart && !isDragging) {\n        setIsDragging(true);\n        // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’ä¸€æ™‚çš„ã«ç„¡åŠ¹åŒ–\n        document.body.classList.add('dragging');\n\n        // è¦ªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®onDragStarté–¢æ•°ã‚’å‘¼ã³å‡ºã—\n        if (onDragStart) {\n          onDragStart(sound);\n        }\n        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã«è¨­å®š\n        window.currentDraggedSoundBlob = sound.audioBlob;\n        window.currentDraggedSound = sound;\n      }\n    }, 200); // 200msé•·æŠ¼ã—ã§é–‹å§‹\n  };\n  const handleTouchMove = e => {\n    if (!touchStart) return;\n    const touch = e.touches[0];\n    const currentPos = {\n      x: touch.clientX,\n      y: touch.clientY\n    };\n    setTouchMove(currentPos);\n\n    // ãƒ‰ãƒ©ãƒƒã‚°é–‹å§‹ã®åˆ¤å®šï¼ˆ10pxä»¥ä¸Šç§»å‹•ï¼‰\n    const deltaX = Math.abs(currentPos.x - touchStart.x);\n    const deltaY = Math.abs(currentPos.y - touchStart.y);\n    if (!isDragging && (deltaX > 10 || deltaY > 10)) {\n      setIsDragging(true);\n      // è¦ªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®onDragStarté–¢æ•°ã‚’å‘¼ã³å‡ºã—\n      if (onDragStart) {\n        onDragStart(sound);\n      }\n      // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã«è¨­å®š\n      window.currentDraggedSoundBlob = sound.audioBlob;\n      window.currentDraggedSound = sound;\n    }\n    if (isDragging) {\n      // passiveã‚¤ãƒ™ãƒ³ãƒˆã§ã¯preventDefaultãŒä½¿ãˆãªã„ã®ã§ã€ä»£ã‚ã‚Šã«touchActionã§ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’åˆ¶å¾¡\n\n      // ãƒ‰ãƒ©ãƒƒã‚°ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã®ä½ç½®ã‚’æ›´æ–°\n      const dragPreview = document.querySelector('.mobile-drag-preview');\n      if (dragPreview) {\n        dragPreview.style.left = `${currentPos.x - 50}px`;\n        dragPreview.style.top = `${currentPos.y - 20}px`;\n      }\n\n      // ãƒ‰ãƒ­ãƒƒãƒ—ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã®ãƒã‚¤ãƒ©ã‚¤ãƒˆ\n      const elementBelow = document.elementFromPoint(currentPos.x, currentPos.y);\n      const trackElement = elementBelow === null || elementBelow === void 0 ? void 0 : elementBelow.closest('.track');\n\n      // æ—¢å­˜ã®ãƒã‚¤ãƒ©ã‚¤ãƒˆã‚’å‰Šé™¤\n      document.querySelectorAll('.track').forEach(track => {\n        track.classList.remove('drag-over');\n      });\n\n      // æ–°ã—ã„ãƒã‚¤ãƒ©ã‚¤ãƒˆã‚’è¿½åŠ \n      if (trackElement) {\n        trackElement.classList.add('drag-over');\n      }\n    }\n  };\n  const handleTouchEnd = e => {\n    if (isDragging && touchMove) {\n      // ãƒ‰ãƒ­ãƒƒãƒ—å‡¦ç†\n      const elementBelow = document.elementFromPoint(touchMove.x, touchMove.y);\n      const trackElement = elementBelow === null || elementBelow === void 0 ? void 0 : elementBelow.closest('.track');\n      if (trackElement) {\n        const trackId = parseInt(trackElement.dataset.trackId);\n        const rect = trackElement.getBoundingClientRect();\n        const timePosition = touchMove.x - rect.left;\n\n        // ãƒ‰ãƒ­ãƒƒãƒ—ã‚¤ãƒ™ãƒ³ãƒˆã‚’ç™ºç«\n        const dropEvent = new CustomEvent('mobileDrop', {\n          detail: {\n            trackId,\n            timePosition,\n            sound: sound\n          }\n        });\n        trackElement.dispatchEvent(dropEvent);\n      }\n    }\n\n    // ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—\n    setTouchStart(null);\n    setTouchMove(null);\n    setIsDragging(false);\n    document.body.classList.remove('dragging');\n\n    // ãƒã‚¤ãƒ©ã‚¤ãƒˆã‚’å‰Šé™¤\n    document.querySelectorAll('.track').forEach(track => {\n      track.classList.remove('drag-over');\n    });\n\n    // ãƒ‰ãƒ©ãƒƒã‚°ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’å‰Šé™¤\n    const dragPreview = document.querySelector('.mobile-drag-preview');\n    if (dragPreview) {\n      dragPreview.remove();\n    }\n\n    // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã‚’ã‚¯ãƒªã‚¢\n    window.currentDraggedSoundBlob = null;\n    window.currentDraggedSound = null;\n  };\n  const playSound = () => {\n    if (sound.audioBlob && !isPlaying && !isDragging) {\n      const audio = new Audio();\n      const audioUrl = URL.createObjectURL(sound.audioBlob);\n      audio.src = audioUrl;\n      audio.play().then(() => {\n        setIsPlaying(true);\n        const handleEnded = () => {\n          setIsPlaying(false);\n          URL.revokeObjectURL(audioUrl); // URLã‚’ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—\n          audio.removeEventListener('ended', handleEnded);\n        };\n        audio.addEventListener('ended', handleEnded);\n      }).catch(error => {\n        console.error('éŸ³å£°å†ç”Ÿã‚¨ãƒ©ãƒ¼:', error);\n        URL.revokeObjectURL(audioUrl); // ã‚¨ãƒ©ãƒ¼æ™‚ã‚‚ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—\n        setIsPlaying(false);\n      });\n    }\n  };\n\n  // ãƒ‰ãƒ©ãƒƒã‚°ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’ä½œæˆ\n  const createDragPreview = useCallback(() => {\n    if (isDragging && touchMove) {\n      let dragPreview = document.querySelector('.mobile-drag-preview');\n      if (!dragPreview) {\n        dragPreview = document.createElement('div');\n        dragPreview.className = 'mobile-drag-preview';\n        dragPreview.textContent = sound.name;\n        dragPreview.style.cssText = `\n          position: fixed;\n          background: rgba(0, 123, 255, 0.8);\n          color: white;\n          padding: 5px 10px;\n          border-radius: 4px;\n          font-size: 12px;\n          pointer-events: none;\n          z-index: 1000;\n          left: ${touchMove.x - 50}px;\n          top: ${touchMove.y - 20}px;\n        `;\n        document.body.appendChild(dragPreview);\n      }\n    }\n  }, [isDragging, touchMove, sound.name]);\n\n  // ãƒ‰ãƒ©ãƒƒã‚°ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã®æ›´æ–°\n  React.useEffect(() => {\n    if (isDragging) {\n      createDragPreview();\n    }\n  }, [isDragging, touchMove, createDragPreview]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: `sound-item ${isDragging ? 'dragging' : ''}`,\n    draggable: \"true\",\n    onDragStart: handleDragStart,\n    onTouchStart: handleTouchStart,\n    onTouchMove: handleTouchMove,\n    onTouchEnd: handleTouchEnd,\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"sound-info\",\n      children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n        children: sound.name\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1282,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"sound-tags\",\n        children: sound.tags.map((tag, index) => /*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"sound-tag\",\n          children: tag\n        }, index, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1285,\n          columnNumber: 13\n        }, this))\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1283,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 1281,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"sound-actions\",\n      children: /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"play-sound-btn\",\n        onClick: playSound,\n        disabled: isPlaying,\n        children: isPlaying ? 'â¸ï¸' : 'â–¶ï¸'\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1290,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 1289,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 1273,\n    columnNumber: 5\n  }, this);\n};\n_s2(SoundItem, \"RkxO1xburwD1wlHDqN3nCO+JHik=\");\n_c2 = SoundItem;\nconst TrackHeader = ({\n  track,\n  onRemove,\n  trackHeight\n}) => {\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"track-header\",\n    style: {\n      height: trackHeight\n    },\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"track-info\",\n      children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n        children: track.name\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1306,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"track-actions\",\n        children: /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"remove-track-btn\",\n          onClick: () => onRemove(track.id),\n          title: \"\\u30C8\\u30E9\\u30C3\\u30AF\\u3092\\u524A\\u9664\",\n          children: \"\\uD83D\\uDDD1\\uFE0F\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1308,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1307,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 1305,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 1304,\n    columnNumber: 5\n  }, this);\n};\n_c3 = TrackHeader;\nconst Timeline = ({\n  bpm\n}) => {\n  const measures = TOTAL_MEASURES; // 16å°ç¯€è¡¨ç¤º\n  const beatsPerMeasure = BEATS_PER_MEASURE; // 4/4æ‹å­\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"timeline\",\n    style: {\n      minWidth: TOTAL_MEASURES * MEASURE_WIDTH\n    },\n    children: Array.from({\n      length: measures\n    }, (_, measureIndex) => /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"measure\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"measure-number\",\n        children: measureIndex + 1\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1329,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"beats\",\n        children: Array.from({\n          length: beatsPerMeasure\n        }, (_, beatIndex) => /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"beat\",\n          style: {\n            width: BEAT_WIDTH\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"beat-main\",\n            children: beatIndex + 1\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1337,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"beat-sub\",\n            children: /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"sub-beat-marker\",\n              children: \"\\u30FB\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1341,\n              columnNumber: 19\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1340,\n            columnNumber: 17\n          }, this)]\n        }, beatIndex, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1332,\n          columnNumber: 15\n        }, this))\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1330,\n        columnNumber: 11\n      }, this)]\n    }, measureIndex, true, {\n      fileName: _jsxFileName,\n      lineNumber: 1328,\n      columnNumber: 9\n    }, this))\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 1326,\n    columnNumber: 5\n  }, this);\n};\n_c4 = Timeline;\nconst Track = ({\n  track,\n  onDrop,\n  onDragOver,\n  onRemoveClip,\n  onClipDragStart,\n  onDragEnd,\n  trackHeight,\n  bpm\n}) => {\n  _s3();\n  const handleDrop = e => {\n    const rect = e.currentTarget.getBoundingClientRect();\n    const timePosition = e.clientX - rect.left;\n    onDrop(e, track.id, timePosition);\n  };\n\n  // ãƒ¢ãƒã‚¤ãƒ«ãƒ‰ãƒ­ãƒƒãƒ—ã‚¤ãƒ™ãƒ³ãƒˆã®å‡¦ç†\n  const handleMobileDrop = useCallback(e => {\n    const {\n      trackId,\n      timePosition,\n      sound\n    } = e.detail;\n\n    // æ¨¡æ“¬çš„ãªãƒ‰ãƒ­ãƒƒãƒ—ã‚¤ãƒ™ãƒ³ãƒˆã‚’ä½œæˆ\n    const mockDropEvent = {\n      preventDefault: () => {},\n      dataTransfer: {\n        getData: type => {\n          if (type === 'application/json') {\n            return JSON.stringify(sound);\n          }\n          return '';\n        }\n      }\n    };\n    onDrop(mockDropEvent, trackId, timePosition);\n  }, [onDrop]);\n\n  // ãƒ¢ãƒã‚¤ãƒ«ã‚¯ãƒªãƒƒãƒ—ç§»å‹•ã‚¤ãƒ™ãƒ³ãƒˆã®å‡¦ç†\n  const handleMobileClipMove = useCallback(e => {\n    const {\n      clip,\n      newTrackId,\n      timePosition\n    } = e.detail;\n\n    // æ¨¡æ“¬çš„ãªãƒ‰ãƒ­ãƒƒãƒ—ã‚¤ãƒ™ãƒ³ãƒˆã‚’ä½œæˆ\n    const mockDropEvent = {\n      preventDefault: () => {},\n      dataTransfer: {\n        getData: type => {\n          if (type === 'text/plain') {\n            return `existing-clip-${clip.id}`;\n          }\n          return '';\n        }\n      }\n    };\n    onDrop(mockDropEvent, newTrackId, timePosition);\n  }, [onDrop]);\n  React.useEffect(() => {\n    const trackElement = document.querySelector(`[data-track-id=\"${track.id}\"]`);\n    if (trackElement) {\n      trackElement.addEventListener('mobileDrop', handleMobileDrop);\n      trackElement.addEventListener('mobileClipMove', handleMobileClipMove);\n      return () => {\n        trackElement.removeEventListener('mobileDrop', handleMobileDrop);\n        trackElement.removeEventListener('mobileClipMove', handleMobileClipMove);\n      };\n    }\n  }, [track.id, handleMobileDrop, handleMobileClipMove]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"track\",\n    style: {\n      height: trackHeight\n    },\n    \"data-track-id\": track.id,\n    onDrop: handleDrop,\n    onDragOver: onDragOver,\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"track-grid\",\n      children: [Array.from({\n        length: TOTAL_BEATS\n      }, (_, index) => {\n        const isFirstBeat = index === 0;\n        const isMeasureStart = index % BEATS_PER_MEASURE === 0;\n        const className = `beat-line beat-line-main ${isFirstBeat ? 'first-beat' : ''} ${isMeasureStart ? 'measure-start' : ''}`;\n        return /*#__PURE__*/_jsxDEV(\"div\", {\n          className: className,\n          style: {\n            left: index * BEAT_WIDTH\n          }\n        }, `main-${index}`, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1426,\n          columnNumber: 13\n        }, this);\n      }), Array.from({\n        length: TOTAL_BEATS\n      }, (_, index) => /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"beat-line beat-line-sub\",\n        style: {\n          left: index * BEAT_WIDTH + SUB_BEAT_WIDTH\n        }\n      }, `sub-${index}`, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1431,\n        columnNumber: 11\n      }, this))]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 1419,\n      columnNumber: 7\n    }, this), track.clips.map(clip => /*#__PURE__*/_jsxDEV(AudioClip, {\n      clip: clip,\n      trackId: track.id,\n      onRemove: () => onRemoveClip(track.id, clip.id),\n      onDragStart: onClipDragStart,\n      onDragEnd: onDragEnd\n    }, clip.id, false, {\n      fileName: _jsxFileName,\n      lineNumber: 1436,\n      columnNumber: 9\n    }, this))]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 1412,\n    columnNumber: 5\n  }, this);\n};\n_s3(Track, \"+PNnKtwbfdVN4ND8buII9hSRziA=\");\n_c5 = Track;\nconst AudioClip = ({\n  clip,\n  trackId,\n  onRemove,\n  onDragStart,\n  onDragEnd\n}) => {\n  _s4();\n  const [waveformData, setWaveformData] = React.useState([]);\n  const [isDragging, setIsDragging] = React.useState(false);\n  const [touchStart, setTouchStart] = React.useState(null);\n  const [touchMove, setTouchMove] = React.useState(null);\n  React.useEffect(() => {\n    // ç°¡å˜ãªæ³¢å½¢ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆï¼ˆå®Ÿéš›ã®å®Ÿè£…ã§ã¯éŸ³å£°è§£æãŒå¿…è¦ï¼‰\n    const generateWaveform = () => {\n      const points = 20; // æ³¢å½¢ã®ãƒã‚¤ãƒ³ãƒˆæ•°\n      const data = [];\n      for (let i = 0; i < points; i++) {\n        data.push(Math.random() * 0.8 + 0.2); // 0.2-1.0ã®é–“ã®ãƒ©ãƒ³ãƒ€ãƒ å€¤\n      }\n      setWaveformData(data);\n    };\n    generateWaveform();\n  }, [clip.soundData]);\n  const handleDragStart = e => {\n    e.stopPropagation(); // ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ–ãƒªãƒ³ã‚°ã‚’é˜²ã\n\n    // ãƒ‰ãƒ©ãƒƒã‚°ãƒ‡ãƒ¼ã‚¿ã«æ—¢å­˜ã‚¯ãƒªãƒƒãƒ—ã®æƒ…å ±ã‚’è¨­å®š\n    e.dataTransfer.setData('text/plain', `existing-clip-${clip.id}`);\n    e.dataTransfer.effectAllowed = 'move';\n\n    // onDragStartã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’å‘¼ã³å‡ºã—\n    onDragStart(clip, trackId);\n  };\n\n  // ã‚¿ãƒƒãƒã‚¤ãƒ™ãƒ³ãƒˆå¯¾å¿œï¼ˆã‚¯ãƒªãƒƒãƒ—ã®ç§»å‹•ï¼‰\n  const handleTouchStart = e => {\n    e.stopPropagation();\n    const touch = e.touches[0];\n    setTouchStart({\n      x: touch.clientX,\n      y: touch.clientY\n    });\n    setIsDragging(false);\n\n    // ãƒ‰ãƒ©ãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰ã‚’æœ‰åŠ¹åŒ–\n    document.body.classList.add('dragging');\n  };\n  const handleTouchMove = e => {\n    if (!touchStart) return;\n    const touch = e.touches[0];\n    const currentPos = {\n      x: touch.clientX,\n      y: touch.clientY\n    };\n    setTouchMove(currentPos);\n\n    // ãƒ‰ãƒ©ãƒƒã‚°é–‹å§‹ã®åˆ¤å®šï¼ˆ5pxä»¥ä¸Šç§»å‹•ï¼‰\n    const deltaX = Math.abs(currentPos.x - touchStart.x);\n    const deltaY = Math.abs(currentPos.y - touchStart.y);\n    if (!isDragging && (deltaX > 5 || deltaY > 5)) {\n      setIsDragging(true);\n      onDragStart(clip, trackId);\n    }\n    if (isDragging) {\n      // passiveã‚¤ãƒ™ãƒ³ãƒˆã§ã¯preventDefaultãŒä½¿ãˆãªã„ã®ã§ã€touchActionã§åˆ¶å¾¡\n\n      // ãƒ‰ãƒ­ãƒƒãƒ—ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã®ãƒã‚¤ãƒ©ã‚¤ãƒˆ\n      const elementBelow = document.elementFromPoint(currentPos.x, currentPos.y);\n      const trackElement = elementBelow === null || elementBelow === void 0 ? void 0 : elementBelow.closest('.track');\n\n      // æ—¢å­˜ã®ãƒã‚¤ãƒ©ã‚¤ãƒˆã‚’å‰Šé™¤\n      document.querySelectorAll('.track').forEach(track => {\n        track.classList.remove('drag-over');\n      });\n\n      // æ–°ã—ã„ãƒã‚¤ãƒ©ã‚¤ãƒˆã‚’è¿½åŠ ï¼ˆè‡ªåˆ†ã®ãƒˆãƒ©ãƒƒã‚¯ä»¥å¤–ã‚‚å«ã‚€ï¼‰\n      if (trackElement) {\n        trackElement.classList.add('drag-over');\n      }\n    }\n  };\n  const handleTouchEnd = e => {\n    if (isDragging && touchMove) {\n      // ãƒ‰ãƒ­ãƒƒãƒ—å‡¦ç†\n      const elementBelow = document.elementFromPoint(touchMove.x, touchMove.y);\n      const trackElement = elementBelow === null || elementBelow === void 0 ? void 0 : elementBelow.closest('.track');\n      if (trackElement) {\n        const newTrackId = parseInt(trackElement.dataset.trackId);\n        const rect = trackElement.getBoundingClientRect();\n        const timePosition = touchMove.x - rect.left;\n\n        // æ—¢å­˜ã‚¯ãƒªãƒƒãƒ—ã®ç§»å‹•ã‚¤ãƒ™ãƒ³ãƒˆã‚’ç™ºç«\n        const moveEvent = new CustomEvent('mobileClipMove', {\n          detail: {\n            clip,\n            originalTrackId: trackId,\n            newTrackId,\n            timePosition\n          }\n        });\n        trackElement.dispatchEvent(moveEvent);\n      }\n    }\n\n    // ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—\n    setTouchStart(null);\n    setTouchMove(null);\n    setIsDragging(false);\n    document.body.classList.remove('dragging');\n\n    // ãƒã‚¤ãƒ©ã‚¤ãƒˆã‚’å‰Šé™¤\n    document.querySelectorAll('.track').forEach(track => {\n      track.classList.remove('drag-over');\n    });\n    if (onDragEnd) {\n      onDragEnd(null); // nullã‚’æ¸¡ã—ã¦ã‚¬ãƒ¼ãƒ‰æ¡ä»¶ã‚’æº€ãŸã™\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: `audio-clip ${isDragging ? 'dragging' : ''}`,\n    draggable: \"true\",\n    onDragStart: handleDragStart,\n    onDragEnd: onDragEnd,\n    onTouchStart: handleTouchStart,\n    onTouchMove: handleTouchMove,\n    onTouchEnd: handleTouchEnd,\n    style: {\n      left: clip.startTime,\n      width: isFinite(clip.duration) && clip.duration > 0 ? clip.duration : 400 // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ1å°ç¯€\n    },\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"clip-header\",\n      children: [/*#__PURE__*/_jsxDEV(\"span\", {\n        className: \"clip-name\",\n        children: clip.soundData.name\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1581,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"remove-clip-btn\",\n        onClick: onRemove,\n        title: \"\\u30AF\\u30EA\\u30C3\\u30D7\\u3092\\u524A\\u9664\",\n        children: \"\\xD7\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1582,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 1580,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"clip-waveform\",\n      children: waveformData.length > 0 ? /*#__PURE__*/_jsxDEV(\"svg\", {\n        className: \"waveform-svg\",\n        width: \"100%\",\n        height: \"30\",\n        children: waveformData.map((height, index) => /*#__PURE__*/_jsxDEV(\"rect\", {\n          x: `${index / waveformData.length * 100}%`,\n          y: `${(1 - height) * 15}`,\n          width: `${80 / waveformData.length}%`,\n          height: `${height * 30}`,\n          fill: \"rgba(255, 255, 255, 0.8)\"\n        }, index, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1594,\n          columnNumber: 15\n        }, this))\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1592,\n        columnNumber: 11\n      }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"waveform-placeholder\",\n        children: \"\\uD83D\\uDD0A\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1605,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 1590,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 1567,\n    columnNumber: 5\n  }, this);\n};\n_s4(AudioClip, \"NeAysvgdzDwGIytG3p5NplFZv3M=\");\n_c6 = AudioClip;\nconst Playhead = ({\n  currentTime\n}) => {\n  // currentTimeãŒæœ‰åŠ¹ãªæ•°å€¤ã‹ãƒã‚§ãƒƒã‚¯\n  const safeCurrentTime = isFinite(currentTime) && currentTime >= 0 ? currentTime : 0;\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"playhead\",\n    style: {\n      left: safeCurrentTime\n    }\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 1617,\n    columnNumber: 5\n  }, this);\n};\n_c7 = Playhead;\nexport default DAWPage;\nvar _c, _c2, _c3, _c4, _c5, _c6, _c7;\n$RefreshReg$(_c, \"DAWPage\");\n$RefreshReg$(_c2, \"SoundItem\");\n$RefreshReg$(_c3, \"TrackHeader\");\n$RefreshReg$(_c4, \"Timeline\");\n$RefreshReg$(_c5, \"Track\");\n$RefreshReg$(_c6, \"AudioClip\");\n$RefreshReg$(_c7, \"Playhead\");","map":{"version":3,"names":["React","useState","useRef","useEffect","useCallback","jsxDEV","_jsxDEV","BEAT_WIDTH","BEATS_PER_MEASURE","MEASURE_WIDTH","SUB_BEAT_WIDTH","TOTAL_MEASURES","TOTAL_BEATS","DAWPage","_s","trackIdCounterRef","trackNameCounterRef","tracks","setTracks","id","Date","now","name","clips","bpm","setBpm","isPlaying","setIsPlaying","currentTime","setCurrentTime","audioContext","setAudioContext","trackHeight","playingAudios","setPlayingAudios","Map","startPlayTime","setStartPlayTime","error","setError","sounds","setSounds","showSoundPanel","setShowSoundPanel","draggedClip","setDraggedClip","dragPreview","setDragPreview","draggedSoundDuration","setDraggedSoundDuration","isExporting","setIsExporting","timelineRef","animationFrameRef","ctx","window","AudioContext","webkitAudioContext","savedSounds","JSON","parse","localStorage","getItem","console","log","length","soundsWithBlob","map","sound","audioData","byteCharacters","atob","split","byteNumbers","Array","i","charCodeAt","byteArray","Uint8Array","blob","Blob","type","size","audioBlob","close","current","cancelAnimationFrame","currentDraggedSoundBlob","getAudioDuration","currentBpm","Promise","resolve","arrayBuffer","audioBuffer","decodeAudioData","durationInSeconds","duration","isFinite","pixelsPerSecond","widthInPixels","updatePlayhead","animate","elapsed","newCurrentTime","warn","requestAnimationFrame","timeInSeconds","handleBpmChange","newBpm","updatedTracks","all","track","updatedClips","clip","soundData","newDuration","saveProject","projectData","version","timestamp","trackNameCounter","trackIdCounter","projectJson","stringify","url","URL","createObjectURL","link","document","createElement","href","download","toISOString","slice","replace","body","appendChild","click","removeChild","revokeObjectURL","loadProject","event","file","target","files","reader","FileReader","onload","e","result","Error","restoreAudioBlob","restoredTracks","restoredSounds","prevSounds","maxId","Math","max","s","existingNames","Set","newSounds","index","newName","counter","has","add","readAsText","value","exportAudio","maxDuration","forEach","clipStartTimeInSeconds","startTime","clipDurationInSeconds","clipEndTime","exportContext","sampleRate","bufferLength","ceil","outputBuffer","createBuffer","leftChannel","getChannelData","rightChannel","startTimeInSamples","floor","channel","min","numberOfChannels","sourceData","targetData","wavBlob","audioBufferToWav","buffer","bytesPerSample","blockAlign","byteRate","dataSize","bufferSize","ArrayBuffer","view","DataView","writeString","offset","string","setUint8","setUint32","setUint16","sample","intSample","setInt16","addTrack","uniqueId","trackName","newTrack","prevTracks","removeTrack","trackId","filter","handleDrop","timePosition","preventDefault","snappedPosition","round","originalTrackId","updatedClip","jsonData","dataTransfer","getData","currentDraggedSound","hasAudioBlob","newClip","random","find","t","handleDragOver","_timelineRef$current","dropEffect","rect","currentTarget","getBoundingClientRect","clientX","left","trackElement","trackRect","tracksAreaRect","relativeTop","top","parseInt","dataset","previewWidth","width","removeClip","clipId","handleClipDragStart","handleDragEnd","play","state","resume","currentTimeInSeconds","newPlayingAudios","clipEndTimeInSeconds","delay","scheduleClipPlayback","delayMs","playingAudiosMap","_clip$soundData","audio","Audio","audioUrl","src","timeoutId","setTimeout","catch","addEventListener","set","_clip$soundData2","_clip$soundData3","_clip$soundData4","_clip$soundData5","_clip$soundData6","soundDataName","hasAudioData","audioBlobType","isInstanceOfBlob","restoreError","pause","clearTimeout","paused","stop","className","children","fileName","_jsxFileName","lineNumber","columnNumber","onClick","htmlFor","onChange","accept","style","display","disabled","title","SoundItem","onDragStart","TrackHeader","onRemove","Timeline","ref","minWidth","Playhead","Track","onDrop","onDragOver","onRemoveClip","onClipDragStart","onDragEnd","_c","_s2","isDragging","setIsDragging","touchStart","setTouchStart","touchMove","setTouchMove","handleDragStart","soundDataForTransfer","setData","effectAllowed","handleTouchStart","touch","touches","x","y","clientY","classList","handleTouchMove","currentPos","deltaX","abs","deltaY","querySelector","elementBelow","elementFromPoint","closest","querySelectorAll","remove","handleTouchEnd","dropEvent","CustomEvent","detail","dispatchEvent","playSound","then","handleEnded","removeEventListener","createDragPreview","textContent","cssText","draggable","onTouchStart","onTouchMove","onTouchEnd","tags","tag","_c2","height","_c3","measures","beatsPerMeasure","from","_","measureIndex","beatIndex","_c4","_s3","handleMobileDrop","mockDropEvent","handleMobileClipMove","newTrackId","isFirstBeat","isMeasureStart","AudioClip","_c5","_s4","waveformData","setWaveformData","generateWaveform","points","data","push","stopPropagation","moveEvent","fill","_c6","safeCurrentTime","_c7","$RefreshReg$"],"sources":["/Users/nakataniyuutomo/Desktop/Programing/ã‚»ã‚™ãƒŸé–‹ç™º/sound-library2/src/pages/DAWPage.js"],"sourcesContent":["import React, { useState, useRef, useEffect, useCallback } from 'react';\nimport './DAWPage.css';\n\n// DAWã®å®šæ•°\nconst BEAT_WIDTH = 100; // 1æ‹ã®å¹…ï¼ˆpxï¼‰\nconst BEATS_PER_MEASURE = 4; // 1å°ç¯€ã‚ãŸã‚Šã®æ‹æ•°\nconst MEASURE_WIDTH = BEAT_WIDTH * BEATS_PER_MEASURE; // 1å°ç¯€ã®å¹…ï¼ˆ400pxï¼‰\nconst SUB_BEAT_WIDTH = BEAT_WIDTH / 2; // 8åˆ†éŸ³ç¬¦ã®å¹…ï¼ˆ50pxï¼‰\nconst TOTAL_MEASURES = 16; // è¡¨ç¤ºã™ã‚‹å°ç¯€æ•°\nconst TOTAL_BEATS = TOTAL_MEASURES * BEATS_PER_MEASURE; // ç·æ‹æ•°\n\nconst DAWPage = () => {\n  // ãƒ¦ãƒ‹ãƒ¼ã‚¯IDç”Ÿæˆç”¨ã®ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼\n  const trackIdCounterRef = useRef(1);\n  // ãƒˆãƒ©ãƒƒã‚¯åã®ç•ªå·ç®¡ç†ç”¨ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼\n  const trackNameCounterRef = useRef(1);\n  \n  const [tracks, setTracks] = useState(() => [{ \n    id: Date.now(), \n    name: 'ãƒˆãƒ©ãƒƒã‚¯ 1', \n    clips: [] \n  }]);\n  const [bpm, setBpm] = useState(120);\n  const [isPlaying, setIsPlaying] = useState(false);\n  const [currentTime, setCurrentTime] = useState(0);\n  const [audioContext, setAudioContext] = useState(null);\n  const [trackHeight] = useState(80);\n  const [playingAudios, setPlayingAudios] = useState(new Map());\n  const [startPlayTime, setStartPlayTime] = useState(null);\n  const [error, setError] = useState(null);\n  const [sounds, setSounds] = useState([]);\n  const [showSoundPanel, setShowSoundPanel] = useState(true);\n  const [draggedClip, setDraggedClip] = useState(null);\n  const [dragPreview, setDragPreview] = useState(null);\n  const [draggedSoundDuration, setDraggedSoundDuration] = useState(400); // ãƒ‰ãƒ©ãƒƒã‚°ä¸­ã®éŸ³ç´ æã®é•·ã•\n  const [isExporting, setIsExporting] = useState(false); // éŸ³æºå‡ºåŠ›ä¸­ãƒ•ãƒ©ã‚°\n  const timelineRef = useRef(null);\n  const animationFrameRef = useRef(null);\n\n  useEffect(() => {\n    // Web Audio API ã®åˆæœŸåŒ–\n    const ctx = new (window.AudioContext || window.webkitAudioContext)();\n    setAudioContext(ctx);\n    \n    // LocalStorageã‹ã‚‰éŸ³ç´ æã‚’èª­ã¿è¾¼ã¿\n    const savedSounds = JSON.parse(localStorage.getItem('soundRecordings') || '[]');\n    console.log('LocalStorageã‹ã‚‰èª­ã¿è¾¼ã‚“ã éŸ³ç´ ææ•°:', savedSounds.length);\n    \n    // audioDataã‹ã‚‰Blobã‚’å¾©å…ƒ\n    const soundsWithBlob = savedSounds.map(sound => {\n      if (sound.audioData) {\n        try {\n          console.log('éŸ³å£°ãƒ‡ãƒ¼ã‚¿å¾©å…ƒä¸­:', sound.name, 'ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚º:', sound.audioData.length);\n          const byteCharacters = atob(sound.audioData.split(',')[1]);\n          const byteNumbers = new Array(byteCharacters.length);\n          for (let i = 0; i < byteCharacters.length; i++) {\n            byteNumbers[i] = byteCharacters.charCodeAt(i);\n          }\n          const byteArray = new Uint8Array(byteNumbers);\n          const blob = new Blob([byteArray], { type: 'audio/wav' });\n          console.log('Blobå¾©å…ƒæˆåŠŸ:', sound.name, 'ã‚µã‚¤ã‚º:', blob.size, 'ã‚¿ã‚¤ãƒ—:', blob.type);\n          return { ...sound, audioBlob: blob };\n        } catch (error) {\n          console.error('éŸ³å£°ãƒ‡ãƒ¼ã‚¿ã®å¾©å…ƒã«å¤±æ•—:', sound.name, error);\n          return sound;\n        }\n      }\n      return sound;\n    });\n    \n    setSounds(soundsWithBlob);\n    \n    return () => {\n      if (ctx) {\n        ctx.close();\n      }\n      if (animationFrameRef.current) {\n        cancelAnimationFrame(animationFrameRef.current);\n      }\n      // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã‚’ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—\n      if (window.currentDraggedSoundBlob) {\n        window.currentDraggedSoundBlob = null;\n      }\n    };\n  }, []);\n\n  // éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã®ç¶™ç¶šæ™‚é–“ã‚’å–å¾—ã—ã¦ãƒ”ã‚¯ã‚»ãƒ«å¹…ã«å¤‰æ›\n  const getAudioDuration = useCallback((audioBlob, currentBpm = bpm) => {\n    return new Promise(async (resolve) => {\n      if (!audioBlob || !(audioBlob instanceof Blob)) {\n        console.log('ç„¡åŠ¹ãªaudioBlob - ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’ä½¿ç”¨');\n        resolve(400);\n        return;\n      }\n\n      console.log('audioBlobè©³ç´°:', {\n        size: audioBlob.size,\n        type: audioBlob.type,\n        bpm: currentBpm\n      });\n\n      // AudioContextã‚’ä½¿ç”¨ã—ãŸæ–¹æ³•ã‚’å„ªå…ˆ\n      if (audioContext) {\n        try {\n          console.log('AudioContextæ–¹å¼ã§éŸ³å£°é•·ã•ã‚’å–å¾—ä¸­...');\n          const arrayBuffer = await audioBlob.arrayBuffer();\n          const audioBuffer = await audioContext.decodeAudioData(arrayBuffer);\n          const durationInSeconds = audioBuffer.duration;\n          \n          console.log('AudioContextæ–¹å¼ã§å–å¾—ã—ãŸé•·ã•:', durationInSeconds, 'ç§’');\n          \n          if (isFinite(durationInSeconds) && durationInSeconds > 0) {\n            const pixelsPerSecond = (currentBpm / 60) * 100;\n            const widthInPixels = durationInSeconds * pixelsPerSecond;\n            console.log('AudioContextè¨ˆç®—çµæœ - BPM:', currentBpm, 'æ‹/ç§’:', currentBpm/60, 'ãƒ”ã‚¯ã‚»ãƒ«/ç§’:', pixelsPerSecond, 'æœ€çµ‚å¹…:', widthInPixels, 'px');\n            resolve(widthInPixels);\n            return;\n          }\n        } catch (error) {\n          console.log('AudioContextæ–¹å¼ã§ã‚¨ãƒ©ãƒ¼:', error);\n        }\n      }\n\n      // AudioContextãŒå¤±æ•—ã—ãŸå ´åˆã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’ä½¿ç”¨\n      console.log('AudioContextãŒåˆ©ç”¨ã§ããªã„ãŸã‚ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’ä½¿ç”¨');\n      resolve(400);\n    });\n  }, [audioContext, bpm]);\n\n  // ãƒ—ãƒ¬ã‚¤ãƒ˜ãƒƒãƒ‰ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³æ›´æ–°\n  const updatePlayhead = useCallback(() => {\n    const animate = () => {\n      if (isPlaying && startPlayTime) {\n        const elapsed = (Date.now() - startPlayTime) / 1000; // çµŒéæ™‚é–“ï¼ˆç§’ï¼‰\n        const pixelsPerSecond = (bpm / 60) * 100; // BPMã«åŸºã¥ã„ãŸãƒ”ã‚¯ã‚»ãƒ«/ç§’\n        const newCurrentTime = elapsed * pixelsPerSecond;\n        \n        // æœ‰åŠ¹ãªæ•°å€¤ã‹ãƒã‚§ãƒƒã‚¯\n        if (isFinite(newCurrentTime) && newCurrentTime >= 0) {\n          setCurrentTime(newCurrentTime);\n        } else {\n          console.warn('ç„¡åŠ¹ãªcurrentTime:', newCurrentTime, 'elapsed:', elapsed, 'pixelsPerSecond:', pixelsPerSecond);\n        }\n        \n        // æ¬¡ã®ãƒ•ãƒ¬ãƒ¼ãƒ ã‚’è¦æ±‚\n        animationFrameRef.current = requestAnimationFrame(animate);\n      }\n    };\n    \n    if (isPlaying && startPlayTime) {\n      animate();\n    }\n  }, [isPlaying, startPlayTime, bpm]);\n\n  useEffect(() => {\n    if (isPlaying) {\n      if (!startPlayTime) {\n        // å†ç”Ÿé–‹å§‹æ™‚ã«startPlayTimeã‚’è¨­å®š\n        const pixelsPerSecond = (bpm / 60) * 100;\n        if (isFinite(pixelsPerSecond) && pixelsPerSecond > 0) {\n          const timeInSeconds = currentTime / pixelsPerSecond;\n          if (isFinite(timeInSeconds) && timeInSeconds >= 0) {\n            setStartPlayTime(Date.now() - (timeInSeconds * 1000));\n          } else {\n            setStartPlayTime(Date.now());\n          }\n        } else {\n          setStartPlayTime(Date.now());\n        }\n      }\n    } else {\n      // å†ç”Ÿåœæ­¢æ™‚ã«ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ã‚¯ãƒªã‚¢\n      if (animationFrameRef.current) {\n        cancelAnimationFrame(animationFrameRef.current);\n        animationFrameRef.current = null;\n      }\n      setStartPlayTime(null);\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [isPlaying, bpm, currentTime]);\n\n  // startPlayTimeãŒè¨­å®šã•ã‚ŒãŸã¨ãã«ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é–‹å§‹\n  useEffect(() => {\n    if (isPlaying && startPlayTime) {\n      updatePlayhead();\n    }\n  }, [isPlaying, startPlayTime, updatePlayhead]);\n\n  // BPMå¤‰æ›´æ™‚ã®ãƒãƒ³ãƒ‰ãƒ©ãƒ¼\n  const handleBpmChange = useCallback(async (newBpm) => {\n    setBpm(newBpm);\n    \n    // æ—¢å­˜ã®ã‚¯ãƒªãƒƒãƒ—ã®durationã‚’æ–°ã—ã„BPMã§å†è¨ˆç®—\n    const updatedTracks = await Promise.all(\n      tracks.map(async (track) => {\n        const updatedClips = await Promise.all(\n          track.clips.map(async (clip) => {\n            if (clip.soundData && clip.soundData.audioBlob) {\n              try {\n                const newDuration = await getAudioDuration(clip.soundData.audioBlob, newBpm);\n                return { ...clip, duration: newDuration };\n              } catch (error) {\n                console.warn('ã‚¯ãƒªãƒƒãƒ—ã®durationæ›´æ–°ã«å¤±æ•—:', error);\n                return clip;\n              }\n            }\n            return clip;\n          })\n        );\n        return { ...track, clips: updatedClips };\n      })\n    );\n    \n    setTracks(updatedTracks);\n  }, [tracks, getAudioDuration]);\n\n  // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¿å­˜æ©Ÿèƒ½\n  const saveProject = () => {\n    try {\n      const projectData = {\n        version: '1.0',\n        bpm: bpm,\n        tracks: tracks,\n        sounds: sounds.map(sound => ({\n          ...sound,\n          audioBlob: null, // Blobã¯åˆ¥é€”ä¿å­˜\n          audioData: sound.audioData // base64ãƒ‡ãƒ¼ã‚¿ã‚’ä¿æŒ\n        })),\n        timestamp: Date.now(),\n        trackNameCounter: trackNameCounterRef.current,\n        trackIdCounter: trackIdCounterRef.current\n      };\n\n      const projectJson = JSON.stringify(projectData, null, 2);\n      const blob = new Blob([projectJson], { type: 'application/json' });\n      const url = URL.createObjectURL(blob);\n      \n      const link = document.createElement('a');\n      link.href = url;\n      link.download = `music-project-${new Date().toISOString().slice(0, 19).replace(/:/g, '-')}.json`;\n      document.body.appendChild(link);\n      link.click();\n      document.body.removeChild(link);\n      URL.revokeObjectURL(url);\n      \n      console.log('ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä¿å­˜ã—ã¾ã—ãŸ');\n    } catch (error) {\n      console.error('ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¿å­˜ã‚¨ãƒ©ãƒ¼:', error);\n      setError('ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸã€‚');\n    }\n  };\n\n  // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆèª­ã¿è¾¼ã¿æ©Ÿèƒ½\n  const loadProject = (event) => {\n    const file = event.target.files[0];\n    if (!file) return;\n\n    const reader = new FileReader();\n    reader.onload = (e) => {\n      try {\n        const projectData = JSON.parse(e.target.result);\n        \n        // ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãƒã‚§ãƒƒã‚¯\n        if (!projectData.version) {\n          throw new Error('ä¸æ­£ãªãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã§ã™');\n        }\n\n        // éŸ³å£°ãƒ‡ãƒ¼ã‚¿å¾©å…ƒç”¨ã®ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°\n        const restoreAudioBlob = (soundData) => {\n          if (soundData && soundData.audioData) {\n            try {\n              const byteCharacters = atob(soundData.audioData.split(',')[1]);\n              const byteNumbers = new Array(byteCharacters.length);\n              for (let i = 0; i < byteCharacters.length; i++) {\n                byteNumbers[i] = byteCharacters.charCodeAt(i);\n              }\n              const byteArray = new Uint8Array(byteNumbers);\n              const blob = new Blob([byteArray], { type: 'audio/wav' });\n              return { ...soundData, audioBlob: blob };\n            } catch (error) {\n              console.error('éŸ³å£°ãƒ‡ãƒ¼ã‚¿ã®å¾©å…ƒã«å¤±æ•—:', soundData.name || 'unknown', error);\n              return soundData;\n            }\n          }\n          return soundData;\n        };\n\n        // BPMã‚’å¾©å…ƒ\n        setBpm(projectData.bpm || 120);\n        \n        // ãƒˆãƒ©ãƒƒã‚¯ã‚’å¾©å…ƒï¼ˆã‚¯ãƒªãƒƒãƒ—å†…ã®éŸ³å£°ãƒ‡ãƒ¼ã‚¿ã‚‚å¾©å…ƒï¼‰\n        if (projectData.tracks) {\n          const restoredTracks = projectData.tracks.map(track => ({\n            ...track,\n            clips: track.clips.map(clip => ({\n              ...clip,\n              soundData: restoreAudioBlob(clip.soundData)\n            }))\n          }));\n          setTracks(restoredTracks);\n          console.log('ãƒˆãƒ©ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ã‚’å¾©å…ƒã—ã¾ã—ãŸ:', restoredTracks.length, 'ãƒˆãƒ©ãƒƒã‚¯');\n        }\n        \n        // ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã‚’å¾©å…ƒ\n        if (projectData.trackNameCounter) {\n          trackNameCounterRef.current = projectData.trackNameCounter;\n        }\n        if (projectData.trackIdCounter) {\n          trackIdCounterRef.current = projectData.trackIdCounter;\n        }\n        \n        // éŸ³ç´ æã‚’å¾©å…ƒï¼ˆæ—¢å­˜ã®éŸ³ç´ æã«è¿½åŠ ï¼‰\n        if (projectData.sounds) {\n          const restoredSounds = projectData.sounds.map(sound => restoreAudioBlob(sound));\n          \n          // æ—¢å­˜ã®éŸ³ç´ æã¨èª­ã¿è¾¼ã‚“ã éŸ³ç´ æã‚’çµåˆ\n          setSounds(prevSounds => {\n            const maxId = prevSounds.length > 0 ? Math.max(...prevSounds.map(s => s.id)) : 0;\n            const existingNames = new Set(prevSounds.map(s => s.name));\n            \n            const newSounds = restoredSounds.map((sound, index) => {\n              let newName = sound.name;\n              let counter = 1;\n              \n              // åå‰ã®é‡è¤‡ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ã€é‡è¤‡ã™ã‚‹å ´åˆã¯ç•ªå·ã‚’ä»˜ã‘ã‚‹\n              while (existingNames.has(newName)) {\n                newName = `${sound.name} (${counter})`;\n                counter++;\n              }\n              existingNames.add(newName);\n              \n              return {\n                ...sound,\n                id: maxId + index + 1, // æ–°ã—ã„IDã‚’å‰²ã‚Šå½“ã¦\n                name: newName // é‡è¤‡ã—ãªã„åå‰ã‚’è¨­å®š\n              };\n            });\n            \n            console.log('éŸ³ç´ æã‚’è¿½åŠ ã—ã¾ã—ãŸ:', newSounds.length, 'å€‹ï¼ˆæ—¢å­˜:', prevSounds.length, 'å€‹ï¼‰');\n            return [...prevSounds, ...newSounds];\n          });\n        }\n        \n        console.log('ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ');\n        setError(null);\n      } catch (error) {\n        console.error('ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);\n        setError('ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒ•ã‚¡ã‚¤ãƒ«ãŒæ­£ã—ã„ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚');\n      }\n    };\n    \n    reader.readAsText(file);\n    // ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠã‚’ãƒªã‚»ãƒƒãƒˆ\n    event.target.value = '';\n  };\n\n  // éŸ³æºå‡ºåŠ›æ©Ÿèƒ½\n  const exportAudio = async () => {\n    if (!audioContext) {\n      setError('AudioContextãŒåˆæœŸåŒ–ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚');\n      return;\n    }\n\n    setIsExporting(true);\n    try {\n      // å…¨ãƒˆãƒ©ãƒƒã‚¯ã®å…¨ã‚¯ãƒªãƒƒãƒ—ã®æœ€å¤§çµ‚äº†æ™‚é–“ã‚’è¨ˆç®—\n      let maxDuration = 0;\n      tracks.forEach(track => {\n        track.clips.forEach(clip => {\n          const pixelsPerSecond = (bpm / 60) * 100;\n          const clipStartTimeInSeconds = clip.startTime / pixelsPerSecond;\n          const clipDurationInSeconds = clip.duration / pixelsPerSecond;\n          const clipEndTime = clipStartTimeInSeconds + clipDurationInSeconds;\n          maxDuration = Math.max(maxDuration, clipEndTime);\n        });\n      });\n\n      if (maxDuration === 0) {\n        setError('å‡ºåŠ›ã™ã‚‹éŸ³å£°ãŒã‚ã‚Šã¾ã›ã‚“ã€‚éŸ³ç´ æã‚’é…ç½®ã—ã¦ãã ã•ã„ã€‚');\n        setIsExporting(false);\n        return;\n      }\n\n      // å‡ºåŠ›ç”¨AudioContextã‚’ä½œæˆï¼ˆ44.1kHzï¼‰\n      const exportContext = new AudioContext({ sampleRate: 44100 });\n      const bufferLength = Math.ceil(maxDuration * exportContext.sampleRate);\n      const outputBuffer = exportContext.createBuffer(2, bufferLength, exportContext.sampleRate);\n      \n      const leftChannel = outputBuffer.getChannelData(0);\n      const rightChannel = outputBuffer.getChannelData(1);\n\n      // å„ãƒˆãƒ©ãƒƒã‚¯ã®å„ã‚¯ãƒªãƒƒãƒ—ã‚’å‡¦ç†\n      for (const track of tracks) {\n        for (const clip of track.clips) {\n          if (clip.soundData && clip.soundData.audioBlob) {\n            try {\n              const arrayBuffer = await clip.soundData.audioBlob.arrayBuffer();\n              const audioBuffer = await exportContext.decodeAudioData(arrayBuffer);\n              \n              const pixelsPerSecond = (bpm / 60) * 100;\n              const startTimeInSamples = Math.floor((clip.startTime / pixelsPerSecond) * exportContext.sampleRate);\n              \n              // éŸ³å£°ã‚’ãƒŸãƒƒã‚¯ã‚¹\n              for (let channel = 0; channel < Math.min(audioBuffer.numberOfChannels, 2); channel++) {\n                const sourceData = audioBuffer.getChannelData(channel);\n                const targetData = channel === 0 ? leftChannel : rightChannel;\n                \n                for (let i = 0; i < sourceData.length && (startTimeInSamples + i) < targetData.length; i++) {\n                  targetData[startTimeInSamples + i] += sourceData[i];\n                }\n              }\n              \n              // ãƒ¢ãƒãƒ©ãƒ«éŸ³æºã®å ´åˆã¯ä¸¡ãƒãƒ£ãƒ³ãƒãƒ«ã«ã‚³ãƒ”ãƒ¼\n              if (audioBuffer.numberOfChannels === 1) {\n                const sourceData = audioBuffer.getChannelData(0);\n                for (let i = 0; i < sourceData.length && (startTimeInSamples + i) < rightChannel.length; i++) {\n                  rightChannel[startTimeInSamples + i] += sourceData[i];\n                }\n              }\n            } catch (error) {\n              console.error('ã‚¯ãƒªãƒƒãƒ—ã®å‡¦ç†ã‚¨ãƒ©ãƒ¼:', error);\n            }\n          }\n        }\n      }\n\n      // WAVãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦å‡ºåŠ›\n      const wavBlob = audioBufferToWav(outputBuffer);\n      const url = URL.createObjectURL(wavBlob);\n      \n      const link = document.createElement('a');\n      link.href = url;\n      link.download = `exported-music-${new Date().toISOString().slice(0, 19).replace(/:/g, '-')}.wav`;\n      document.body.appendChild(link);\n      link.click();\n      document.body.removeChild(link);\n      URL.revokeObjectURL(url);\n      \n      console.log('éŸ³æºã‚’å‡ºåŠ›ã—ã¾ã—ãŸ');\n      await exportContext.close();\n    } catch (error) {\n      console.error('éŸ³æºå‡ºåŠ›ã‚¨ãƒ©ãƒ¼:', error);\n      setError('éŸ³æºã®å‡ºåŠ›ã«å¤±æ•—ã—ã¾ã—ãŸã€‚');\n    } finally {\n      setIsExporting(false);\n    }\n  };\n\n  // AudioBufferã‚’WAVãƒ•ã‚¡ã‚¤ãƒ«ã«å¤‰æ›\n  const audioBufferToWav = (buffer) => {\n    const length = buffer.length;\n    const numberOfChannels = buffer.numberOfChannels;\n    const sampleRate = buffer.sampleRate;\n    const bytesPerSample = 2;\n    const blockAlign = numberOfChannels * bytesPerSample;\n    const byteRate = sampleRate * blockAlign;\n    const dataSize = length * blockAlign;\n    const bufferSize = 44 + dataSize;\n    \n    const arrayBuffer = new ArrayBuffer(bufferSize);\n    const view = new DataView(arrayBuffer);\n    \n    // WAVãƒ•ã‚¡ã‚¤ãƒ«ãƒ˜ãƒƒãƒ€ãƒ¼\n    const writeString = (offset, string) => {\n      for (let i = 0; i < string.length; i++) {\n        view.setUint8(offset + i, string.charCodeAt(i));\n      }\n    };\n    \n    writeString(0, 'RIFF');\n    view.setUint32(4, bufferSize - 8, true);\n    writeString(8, 'WAVE');\n    writeString(12, 'fmt ');\n    view.setUint32(16, 16, true);\n    view.setUint16(20, 1, true);\n    view.setUint16(22, numberOfChannels, true);\n    view.setUint32(24, sampleRate, true);\n    view.setUint32(28, byteRate, true);\n    view.setUint16(32, blockAlign, true);\n    view.setUint16(34, bytesPerSample * 8, true);\n    writeString(36, 'data');\n    view.setUint32(40, dataSize, true);\n    \n    // éŸ³å£°ãƒ‡ãƒ¼ã‚¿\n    let offset = 44;\n    for (let i = 0; i < length; i++) {\n      for (let channel = 0; channel < numberOfChannels; channel++) {\n        const sample = buffer.getChannelData(channel)[i];\n        const intSample = Math.max(-1, Math.min(1, sample)) * 0x7FFF;\n        view.setInt16(offset, intSample, true);\n        offset += 2;\n      }\n    }\n    \n    return new Blob([arrayBuffer], { type: 'audio/wav' });\n  };\n\n  const addTrack = () => {\n    // ã‚ˆã‚Šç¢ºå®Ÿã«ãƒ¦ãƒ‹ãƒ¼ã‚¯ãªIDã‚’ç”Ÿæˆ\n    trackIdCounterRef.current += 1;\n    const uniqueId = Date.now() + trackIdCounterRef.current;\n    \n    // ãƒˆãƒ©ãƒƒã‚¯åã®ç•ªå·ã‚’å¢—åŠ ï¼ˆå‰Šé™¤ã•ã‚Œã¦ã‚‚ç•ªå·ã¯æˆ»ã‚‰ãªã„ï¼‰\n    trackNameCounterRef.current += 1;\n    const trackName = `ãƒˆãƒ©ãƒƒã‚¯ ${trackNameCounterRef.current}`;\n    \n    const newTrack = {\n      id: uniqueId,\n      name: trackName,\n      clips: []\n    };\n    setTracks(prevTracks => [...prevTracks, newTrack]);\n  };\n\n  const removeTrack = (trackId) => {\n    setTracks(prevTracks => {\n      if (prevTracks.length > 1) {\n        return prevTracks.filter(track => track.id !== trackId);\n      }\n      return prevTracks;\n    });\n  };\n\n  const handleDrop = async (e, trackId, timePosition) => {\n    e.preventDefault();\n    setDragPreview(null);\n    \n    console.log('ãƒ‰ãƒ­ãƒƒãƒ—å‡¦ç†é–‹å§‹:', { trackId, timePosition, draggedClip });\n    \n    try {\n      // 8åˆ†éŸ³ç¬¦ã«åˆã‚ã›ã¦ä½ç½®ã‚’èª¿æ•´ï¼ˆ50pxå˜ä½ï¼‰\n      const snappedPosition = Math.round(timePosition / SUB_BEAT_WIDTH) * SUB_BEAT_WIDTH;\n      \n      // æ—¢å­˜ã®ã‚¯ãƒªãƒƒãƒ—ã®ç§»å‹•ã‹ã©ã†ã‹ãƒã‚§ãƒƒã‚¯\n      if (draggedClip) {\n        console.log('æ—¢å­˜ã‚¯ãƒªãƒƒãƒ—ã®ç§»å‹•:', draggedClip.id, 'å…ƒãƒˆãƒ©ãƒƒã‚¯:', draggedClip.originalTrackId, 'æ–°ãƒˆãƒ©ãƒƒã‚¯:', trackId);\n        \n        // æ—¢å­˜ã‚¯ãƒªãƒƒãƒ—ã®ç§»å‹•\n        const updatedClip = {\n          ...draggedClip,\n          startTime: snappedPosition,\n          trackId: trackId\n        };\n\n        setTracks(prevTracks => prevTracks.map(track => {\n          if (track.id === draggedClip.originalTrackId && track.id === trackId) {\n            // åŒã˜ãƒˆãƒ©ãƒƒã‚¯å†…ã§ã®ç§»å‹•\n            console.log('åŒã˜ãƒˆãƒ©ãƒƒã‚¯å†…ã§ã®ç§»å‹•');\n            return {\n              ...track,\n              clips: track.clips.map(clip => \n                clip.id === draggedClip.id ? updatedClip : clip\n              )\n            };\n          } else if (track.id === draggedClip.originalTrackId) {\n            // å…ƒã®ãƒˆãƒ©ãƒƒã‚¯ã‹ã‚‰ã‚¯ãƒªãƒƒãƒ—ã‚’å‰Šé™¤\n            console.log('å…ƒã®ãƒˆãƒ©ãƒƒã‚¯ã‹ã‚‰ã‚¯ãƒªãƒƒãƒ—ã‚’å‰Šé™¤');\n            return {\n              ...track,\n              clips: track.clips.filter(clip => clip.id !== draggedClip.id)\n            };\n          } else if (track.id === trackId) {\n            // æ–°ã—ã„ãƒˆãƒ©ãƒƒã‚¯ã«ã‚¯ãƒªãƒƒãƒ—ã‚’è¿½åŠ \n            console.log('æ–°ã—ã„ãƒˆãƒ©ãƒƒã‚¯ã«ã‚¯ãƒªãƒƒãƒ—ã‚’è¿½åŠ ');\n            return {\n              ...track,\n              clips: [...track.clips, updatedClip]\n            };\n          }\n          return track;\n        }));\n        setDraggedClip(null);\n        return;\n      }\n      \n      // æ–°ã—ã„éŸ³ç´ æã®é…ç½®\n      let soundData;\n      try {\n        // dataTransferã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—\n        const jsonData = e.dataTransfer ? e.dataTransfer.getData('application/json') : '';\n        if (jsonData) {\n          soundData = JSON.parse(jsonData);\n        } else {\n          // ãƒ¢ãƒã‚¤ãƒ«ã®å ´åˆã¯ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã‹ã‚‰å–å¾—\n          soundData = window.currentDraggedSound;\n        }\n      } catch (error) {\n        console.error('ãƒ‰ãƒ©ãƒƒã‚°ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—:', error);\n        soundData = window.currentDraggedSound; // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯\n      }\n      \n      if (!soundData) {\n        console.error('éŸ³ç´ æãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');\n        setError('éŸ³ç´ æãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚');\n        return;\n      }\n      \n      // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã‹ã‚‰audioBlobã‚’å¾©å…ƒ\n      if (window.currentDraggedSoundBlob) {\n        soundData.audioBlob = window.currentDraggedSoundBlob;\n        window.currentDraggedSoundBlob = null; // ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—\n      }\n      \n      // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã‚’ã‚¯ãƒªã‚¢\n      window.currentDraggedSound = null;\n      \n      console.log('æ–°ã—ã„éŸ³ç´ æã®ãƒ‰ãƒ­ãƒƒãƒ—:', { soundData, hasAudioBlob: !!soundData.audioBlob });\n      \n      // éŸ³å£°ã®å®Ÿéš›ã®ç¶™ç¶šæ™‚é–“ã‚’å–å¾—ï¼ˆç¾åœ¨ã®BPMã«åŸºã¥ã„ã¦ï¼‰\n      let duration = 400; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ï¼ˆ1å°ç¯€ï¼‰\n      if (soundData.audioBlob) {\n        try {\n          duration = await getAudioDuration(soundData.audioBlob, bpm);\n          console.log('å–å¾—ã—ãŸduration:', duration, 'pixels (BPM:', bpm, ')');\n        } catch (error) {\n          console.warn('éŸ³å£°ç¶™ç¶šæ™‚é–“ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ:', error);\n        }\n      }\n\n      // durationãŒæœ‰åŠ¹ãªå€¤ã‹ãƒã‚§ãƒƒã‚¯\n      if (!isFinite(duration) || duration <= 0) {\n        console.warn('ç„¡åŠ¹ãªduration:', duration, 'ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’ä½¿ç”¨');\n        duration = 400; // 1å°ç¯€åˆ†\n      }\n\n      const newClip = {\n        id: Date.now() + Math.random(), // ã‚ˆã‚Šç¢ºå®Ÿã«ãƒ¦ãƒ‹ãƒ¼ã‚¯ãªIDã‚’ç”Ÿæˆ\n        soundData: soundData,\n        startTime: snappedPosition,\n        duration: duration,\n        trackId: trackId\n      };\n\n      console.log('ä½œæˆã•ã‚ŒãŸã‚¯ãƒªãƒƒãƒ—:', newClip);\n      console.log('ç¾åœ¨ã®ãƒˆãƒ©ãƒƒã‚¯æ•°:', tracks.length);\n      console.log('å¯¾è±¡ãƒˆãƒ©ãƒƒã‚¯ID:', trackId);\n      console.log('å¯¾è±¡ãƒˆãƒ©ãƒƒã‚¯:', tracks.find(t => t.id === trackId));\n\n      // é–¢æ•°å‹æ›´æ–°ã‚’ä½¿ç”¨ã—ã¦æœ€æ–°ã®çŠ¶æ…‹ã‚’ç¢ºå®Ÿã«å–å¾—\n      setTracks(prevTracks => {\n        console.log('æ›´æ–°å‰ã®ãƒˆãƒ©ãƒƒã‚¯:', prevTracks.find(t => t.id === trackId));\n        const updatedTracks = prevTracks.map(track => \n          track.id === trackId \n            ? { ...track, clips: [...track.clips, newClip] }\n            : track\n        );\n        console.log('æ›´æ–°å¾Œã®ãƒˆãƒ©ãƒƒã‚¯:', updatedTracks.find(t => t.id === trackId));\n        return updatedTracks;\n      });\n    } catch (error) {\n      console.error('ãƒ‰ãƒ­ãƒƒãƒ—ã‚¨ãƒ©ãƒ¼:', error);\n      setError('éŸ³ç´ æã®é…ç½®ã«å¤±æ•—ã—ã¾ã—ãŸã€‚å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚');\n    }\n  };\n\n  const handleDragOver = (e) => {\n    e.preventDefault();\n    \n    // ãƒ‰ãƒ©ãƒƒã‚°ã•ã‚Œã¦ã„ã‚‹ã®ãŒæ—¢å­˜ã‚¯ãƒªãƒƒãƒ—ã‹æ–°ã—ã„éŸ³ç´ æã‹ã§å‡¦ç†ã‚’åˆ†ã‘ã‚‹\n    if (draggedClip) {\n      e.dataTransfer.dropEffect = 'move';\n    } else {\n      e.dataTransfer.dropEffect = 'copy';\n    }\n    \n    // ãƒ‰ãƒ©ãƒƒã‚°ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã®æ›´æ–°\n    const rect = e.currentTarget.getBoundingClientRect();\n    const timePosition = e.clientX - rect.left;\n    const snappedPosition = Math.round(timePosition / SUB_BEAT_WIDTH) * SUB_BEAT_WIDTH;\n    \n    const trackElement = e.currentTarget;\n    const trackRect = trackElement.getBoundingClientRect();\n    const tracksAreaRect = timelineRef.current?.getBoundingClientRect();\n    \n    if (tracksAreaRect) {\n      const relativeTop = trackRect.top - tracksAreaRect.top;\n      const trackId = parseInt(trackElement.dataset.trackId);\n      \n      // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼å¹…ã‚’æ±ºå®š\n      let previewWidth = 400; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ï¼ˆ1å°ç¯€ï¼‰\n      \n      if (draggedClip) {\n        // æ—¢å­˜ã‚¯ãƒªãƒƒãƒ—ã®å ´åˆ\n        previewWidth = isFinite(draggedClip.duration) && draggedClip.duration > 0 \n          ? draggedClip.duration \n          : 400;\n        console.log('æ—¢å­˜ã‚¯ãƒªãƒƒãƒ—ã®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼å¹…:', previewWidth);\n      } else {\n        // æ–°ã—ã„éŸ³ç´ æã®å ´åˆã€äº‹å‰ã«è¨ˆç®—ã•ã‚ŒãŸé•·ã•ã‚’ä½¿ç”¨\n        previewWidth = draggedSoundDuration;\n        console.log('æ–°ã—ã„éŸ³ç´ æã®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼å¹…:', previewWidth, '(draggedSoundDuration)');\n      }\n      \n      setDragPreview({\n        left: snappedPosition,\n        top: relativeTop + 10,\n        width: previewWidth,\n        trackId: trackId\n      });\n    }\n  };\n\n  const removeClip = (trackId, clipId) => {\n    setTracks(prevTracks => prevTracks.map(track => \n      track.id === trackId \n        ? { ...track, clips: track.clips.filter(clip => clip.id !== clipId) }\n        : track\n    ));\n  };\n\n  // ã‚¯ãƒªãƒƒãƒ—ã®ãƒ‰ãƒ©ãƒƒã‚°é–‹å§‹\n  const handleClipDragStart = (clip, originalTrackId) => {\n    console.log('ã‚¯ãƒªãƒƒãƒ—ãƒ‰ãƒ©ãƒƒã‚°é–‹å§‹:', clip.id, 'ãƒˆãƒ©ãƒƒã‚¯:', originalTrackId);\n    setDraggedClip({ ...clip, originalTrackId });\n  };\n\n  // ãƒ‰ãƒ©ãƒƒã‚°çµ‚äº†æ™‚ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—\n  const handleDragEnd = (e) => {\n    // ãƒ‰ãƒ­ãƒƒãƒ—ãŒæ­£å¸¸ã«å‡¦ç†ã•ã‚Œãªã‹ã£ãŸå ´åˆã€å…ƒã®çŠ¶æ…‹ã‚’ä¿æŒ\n    if (draggedClip && e && e.dataTransfer && e.dataTransfer.dropEffect === 'none') {\n      console.log('ãƒ‰ãƒ©ãƒƒã‚°ãŒã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã‚Œã¾ã—ãŸã€‚å…ƒã®ä½ç½®ã‚’ä¿æŒã—ã¾ã™ã€‚');\n    }\n    setDraggedClip(null);\n    setDragPreview(null);\n    setDraggedSoundDuration(400); // ãƒªã‚»ãƒƒãƒˆ\n  };\n\n  const play = async () => {\n    try {\n      // AudioContextãŒä¸­æ–­ã•ã‚Œã¦ã„ã‚‹å ´åˆã¯å†é–‹\n      if (audioContext && audioContext.state === 'suspended') {\n        await audioContext.resume();\n      }\n      \n      setIsPlaying(true);\n      \n      // ç¾åœ¨ã®æ™‚é–“ä½ç½®ã«åŸºã¥ã„ã¦ã€å†ç”Ÿã™ã¹ãã‚¯ãƒªãƒƒãƒ—ã‚’è¦‹ã¤ã‘ã‚‹\n      const pixelsPerSecond = (bpm / 60) * 100;\n      const currentTimeInSeconds = currentTime / pixelsPerSecond;\n      \n      // å„ãƒˆãƒ©ãƒƒã‚¯ã®ã‚¯ãƒªãƒƒãƒ—ã‚’å†ç”Ÿ\n      const newPlayingAudios = new Map();\n      \n      tracks.forEach(track => {\n        track.clips.forEach(clip => {\n          // clip.durationãŒæœ‰åŠ¹ãªå€¤ã‹ãƒã‚§ãƒƒã‚¯\n          if (!isFinite(clip.duration) || clip.duration <= 0) {\n            console.warn('ç„¡åŠ¹ãªclip.duration:', clip.duration, 'ã‚¯ãƒªãƒƒãƒ—ã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã¾ã™');\n            return;\n          }\n          \n          const clipStartTimeInSeconds = clip.startTime / pixelsPerSecond;\n          const clipEndTimeInSeconds = clipStartTimeInSeconds + (clip.duration / pixelsPerSecond);\n          \n          // è¨ˆç®—çµæœãŒæœ‰åŠ¹ã‹ãƒã‚§ãƒƒã‚¯\n          if (!isFinite(clipStartTimeInSeconds) || !isFinite(clipEndTimeInSeconds)) {\n            console.warn('ç„¡åŠ¹ãªæ™‚é–“è¨ˆç®—:', { clipStartTimeInSeconds, clipEndTimeInSeconds });\n            return;\n          }\n          \n          // ç¾åœ¨ã®æ™‚é–“ä½ç½®ãŒã‚¯ãƒªãƒƒãƒ—ã®ç¯„å›²å†…ã¾ãŸã¯ä»Šå¾Œå†ç”Ÿã•ã‚Œã‚‹å ´åˆ\n          if (clipEndTimeInSeconds > currentTimeInSeconds) {\n            const delay = Math.max(0, clipStartTimeInSeconds - currentTimeInSeconds);\n            if (isFinite(delay) && delay >= 0) {\n              scheduleClipPlayback(clip, delay * 1000, newPlayingAudios);\n            }\n          }\n        });\n      });\n      \n      setPlayingAudios(newPlayingAudios);\n    } catch (error) {\n      console.error('å†ç”Ÿã‚¨ãƒ©ãƒ¼:', error);\n      setError('éŸ³å£°ã®å†ç”Ÿã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒ–ãƒ©ã‚¦ã‚¶ã§éŸ³å£°ãŒæœ‰åŠ¹ã«ãªã£ã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚');\n    }\n  };\n\n  const scheduleClipPlayback = (clip, delayMs, playingAudiosMap) => {\n    console.log('scheduleClipPlayback:', { clip, hasAudioBlob: !!clip.soundData?.audioBlob });\n    \n    if (clip.soundData && clip.soundData.audioBlob && clip.soundData.audioBlob instanceof Blob) {\n      try {\n        const audio = new Audio();\n        const audioUrl = URL.createObjectURL(clip.soundData.audioBlob);\n        audio.src = audioUrl;\n        \n        const timeoutId = setTimeout(() => {\n          audio.play().catch(error => {\n            console.error('éŸ³å£°å†ç”Ÿã‚¨ãƒ©ãƒ¼:', error);\n            URL.revokeObjectURL(audioUrl); // ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯ã‚’é˜²ã\n          });\n        }, delayMs);\n        \n        // éŸ³å£°çµ‚äº†æ™‚ã«URLã‚’è§£æ”¾\n        audio.addEventListener('ended', () => {\n          URL.revokeObjectURL(audioUrl);\n        });\n        \n        playingAudiosMap.set(clip.id, { audio, timeoutId, audioUrl });\n      } catch (error) {\n        console.error('createObjectURL ã‚¨ãƒ©ãƒ¼:', error, 'audioBlob:', clip.soundData.audioBlob);\n      }\n    } else {\n      console.warn('audioBlobãŒç„¡åŠ¹ã§ã™ã€‚ã‚¯ãƒªãƒƒãƒ—æƒ…å ±:', {\n        clipId: clip.id,\n        soundDataName: clip.soundData?.name,\n        hasAudioData: !!clip.soundData?.audioData,\n        hasAudioBlob: !!clip.soundData?.audioBlob,\n        audioBlobType: typeof clip.soundData?.audioBlob,\n        isInstanceOfBlob: clip.soundData?.audioBlob instanceof Blob\n      });\n      \n      // AudioBlobãŒç„¡åŠ¹ãªå ´åˆã€audioDataã‹ã‚‰å¾©å…ƒã‚’è©¦è¡Œ\n      if (clip.soundData && clip.soundData.audioData && !clip.soundData.audioBlob) {\n        console.log('audioDataã‹ã‚‰Blobã‚’å†ä½œæˆä¸­...');\n        try {\n          const byteCharacters = atob(clip.soundData.audioData.split(',')[1]);\n          const byteNumbers = new Array(byteCharacters.length);\n          for (let i = 0; i < byteCharacters.length; i++) {\n            byteNumbers[i] = byteCharacters.charCodeAt(i);\n          }\n          const byteArray = new Uint8Array(byteNumbers);\n          const blob = new Blob([byteArray], { type: 'audio/wav' });\n          \n          // ã‚¯ãƒªãƒƒãƒ—ã®soundDataã‚’æ›´æ–°\n          clip.soundData.audioBlob = blob;\n          \n          // å†å¸°çš„ã«å†è©¦è¡Œ\n          scheduleClipPlayback(clip, delayMs, playingAudiosMap);\n          return;\n        } catch (restoreError) {\n          console.error('audioDataã‹ã‚‰ã®Blobå¾©å…ƒã«å¤±æ•—:', restoreError);\n        }\n      }\n    }\n  };\n\n  const pause = () => {\n    setIsPlaying(false);\n    \n    // å†ç”Ÿä¸­ã®éŸ³å£°ã‚’ä¸€æ™‚åœæ­¢\n    playingAudios.forEach(({ audio, timeoutId, audioUrl }) => {\n      if (timeoutId) {\n        clearTimeout(timeoutId);\n      }\n      if (!audio.paused) {\n        audio.pause();\n      }\n      // URLã‚’è§£æ”¾\n      if (audioUrl) {\n        URL.revokeObjectURL(audioUrl);\n      }\n    });\n  };\n\n  const stop = () => {\n    setIsPlaying(false);\n    setCurrentTime(0);\n    \n    // å†ç”Ÿä¸­ã®éŸ³å£°ã‚’åœæ­¢\n    playingAudios.forEach(({ audio, timeoutId, audioUrl }) => {\n      if (timeoutId) {\n        clearTimeout(timeoutId);\n      }\n      audio.pause();\n      audio.currentTime = 0;\n      // URLã‚’è§£æ”¾\n      if (audioUrl) {\n        URL.revokeObjectURL(audioUrl);\n      }\n    });\n    \n    setPlayingAudios(new Map());\n  };\n\n  return (\n    <div className=\"daw-page\">\n      <h2>ğŸ¹ éŸ³æ¥½ã¥ãã‚Šãƒšãƒ¼ã‚¸</h2>\n      <p>éŸ³ç´ æã‚’ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ã—ã¦éŸ³æ¥½ã‚’ä½œã‚Šã¾ã—ã‚‡ã†ï¼</p>\n\n      {error && (\n        <div className=\"error-message\">\n          <span>âš ï¸ {error}</span>\n          <button onClick={() => setError(null)}>Ã—</button>\n        </div>\n      )}\n\n      <div className=\"daw-controls card\">\n        <div className=\"transport-controls\">\n          <button \n            className={`transport-btn play-btn ${isPlaying ? 'playing' : ''}`}\n            onClick={isPlaying ? pause : play}\n          >\n            {isPlaying ? 'â¸ï¸' : 'â–¶ï¸'}\n          </button>\n          <button className=\"transport-btn stop-btn\" onClick={stop}>\n            â¹ï¸\n          </button>\n        </div>\n\n        <div className=\"bpm-control\">\n          <label htmlFor=\"bpm\">ğŸµ BPM:</label>\n          <input\n            id=\"bpm\"\n            type=\"number\"\n            value={bpm}\n            onChange={(e) => handleBpmChange(parseInt(e.target.value))}\n            min=\"60\"\n            max=\"200\"\n            className=\"bpm-input\"\n          />\n        </div>\n\n        <div className=\"track-controls\">\n          <button className=\"button-primary\" onClick={addTrack}>\n            â• ãƒˆãƒ©ãƒƒã‚¯è¿½åŠ \n          </button>\n          <button \n            className=\"button-secondary\" \n            onClick={() => setShowSoundPanel(!showSoundPanel)}\n          >\n            {showSoundPanel ? 'ğŸµ éŸ³ç´ æã‚’éš ã™' : 'ğŸµ éŸ³ç´ æã‚’è¡¨ç¤º'}\n          </button>\n        </div>\n\n        <div className=\"project-controls\">\n          <button className=\"button-secondary\" onClick={saveProject}>\n            ğŸ’¾ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¿å­˜\n          </button>\n          <label className=\"button-secondary file-input-label\">\n            ğŸ“ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆèª­ã¿è¾¼ã¿\n            <input\n              type=\"file\"\n              accept=\".json\"\n              onChange={loadProject}\n              style={{ display: 'none' }}\n            />\n          </label>\n          <button \n            className=\"button-primary\" \n            onClick={exportAudio}\n            disabled={isExporting}\n          >\n            {isExporting ? 'ğŸ”„ å‡ºåŠ›ä¸­...' : 'ğŸ§ éŸ³æºå‡ºåŠ›'}\n          </button>\n        </div>\n      </div>\n\n      <div className=\"daw-main-area\">\n        <div className={`sound-panel ${!showSoundPanel ? 'panel-hidden' : ''}`}>\n          <div className=\"sound-panel-header\">\n            <h3>ğŸµ éŸ³ç´ æ</h3>\n            <button \n              className=\"sound-panel-close\"\n              onClick={() => setShowSoundPanel(false)}\n              title=\"éŸ³ç´ æãƒ‘ãƒãƒ«ã‚’é–‰ã˜ã‚‹\"\n            >\n              âœ•\n            </button>\n          </div>\n          <div className=\"sound-list\">\n            {sounds.length > 0 ? (\n              sounds.map(sound => (\n                <SoundItem \n                  key={sound.id} \n                  sound={sound} \n                  onDragStart={async (sound) => {\n                    // ãƒ‰ãƒ©ãƒƒã‚°é–‹å§‹æ™‚ã«éŸ³å£°ã®é•·ã•ã‚’è¨ˆç®—\n                    console.log('ãƒ‰ãƒ©ãƒƒã‚°é–‹å§‹ - éŸ³å£°é•·ã•è¨ˆç®—ä¸­:', sound.name);\n                    if (sound.audioBlob) {\n                      try {\n                        const duration = await getAudioDuration(sound.audioBlob, bpm);\n                        console.log('è¨ˆç®—ã•ã‚ŒãŸéŸ³å£°é•·ã•:', duration, 'px');\n                        setDraggedSoundDuration(duration);\n                      } catch (error) {\n                        console.warn('ãƒ‰ãƒ©ãƒƒã‚°æ™‚ã®éŸ³å£°é•·ã•è¨ˆç®—ã«å¤±æ•—:', error);\n                        setDraggedSoundDuration(400);\n                      }\n                    } else {\n                      console.log('audioBlob ãŒå­˜åœ¨ã—ã¾ã›ã‚“ - ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ä½¿ç”¨');\n                      setDraggedSoundDuration(400);\n                    }\n                  }}\n                />\n              ))\n            ) : (\n              <div className=\"no-sounds\">\n                <p>éŸ³ç´ æãŒã‚ã‚Šã¾ã›ã‚“</p>\n                <p>ã€ŒéŸ³ã‚ã¤ã‚ã€ãƒšãƒ¼ã‚¸ã§éŸ³ã‚’éŒ²éŸ³ã—ã¦ãã ã•ã„</p>\n              </div>\n            )}\n          </div>\n        </div>\n\n        <div className={`daw-workspace ${!showSoundPanel ? 'panel-hidden' : ''}`}>\n          <div className=\"track-headers\">\n            <div className=\"timeline-header-spacer\">\n              ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³\n            </div>\n            {tracks.map(track => (\n              <TrackHeader \n                key={track.id} \n                track={track} \n                onRemove={removeTrack}\n                trackHeight={trackHeight}\n              />\n            ))}\n          </div>\n\n          <div className=\"timeline-container\">\n            <Timeline bpm={bpm} />\n            <div className=\"tracks-area\" ref={timelineRef} style={{ minWidth: TOTAL_MEASURES * MEASURE_WIDTH }}>\n              <Playhead currentTime={currentTime} />\n              {dragPreview && (\n                <div \n                  className=\"drag-preview\"\n                  style={{\n                    left: dragPreview.left,\n                    top: dragPreview.top,\n                    width: dragPreview.width\n                  }}\n                />\n              )}\n              {tracks.map(track => (\n                <Track\n                  key={track.id}\n                  track={track}\n                  onDrop={handleDrop}\n                  onDragOver={handleDragOver}\n                  onRemoveClip={removeClip}\n                  onClipDragStart={handleClipDragStart}\n                  onDragEnd={handleDragEnd}\n                  trackHeight={trackHeight}\n                  bpm={bpm}\n                />\n              ))}\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"instructions card\">\n        <h3>ğŸ“– ä½¿ã„æ–¹</h3>\n        <ul>\n          <li><strong>ğŸ–¥ï¸ PC:</strong> å·¦å´ã®éŸ³ç´ æãƒ‘ãƒãƒ«ã‹ã‚‰éŸ³ç´ æã‚’ãƒˆãƒ©ãƒƒã‚¯ã«ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ã—ã¦é…ç½®</li>\n          <li><strong>ğŸ“± ã‚¹ãƒãƒ›/ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆ:</strong> éŸ³ç´ æã‚’é•·æŠ¼ã—ã—ã¦ã‹ã‚‰ãƒˆãƒ©ãƒƒã‚¯ã¾ã§ãƒ‰ãƒ©ãƒƒã‚°ã—ã¦é…ç½®</li>\n          <li>é…ç½®æ¸ˆã¿ã®éŸ³ç´ æã‚‚ãƒ‰ãƒ©ãƒƒã‚°ã—ã¦åˆ¥ã®å ´æ‰€ã«ç§»å‹•ã§ãã¾ã™</li>\n          <li>ãƒ‰ãƒ©ãƒƒã‚°ä¸­ã¯é…ç½®äºˆå®šä½ç½®ã«é’ã„å½±ãŒè¡¨ç¤ºã•ã‚Œã¾ã™</li>\n          <li>éŸ³ç´ æã¯8åˆ†éŸ³ç¬¦ï¼ˆè£æ‹å«ã‚€ï¼‰ã«åˆã‚ã›ã¦è‡ªå‹•çš„ã«é…ç½®ã•ã‚Œã¾ã™</li>\n          <li>éŸ³ç´ æãƒ‘ãƒãƒ«ã®â–¶ï¸ãƒœã‚¿ãƒ³ã§å€‹åˆ¥ã«éŸ³ã‚’ç¢ºèªã§ãã¾ã™</li>\n          <li>â–¶ï¸ãƒœã‚¿ãƒ³ã§å†ç”Ÿã€â¸ï¸ãƒœã‚¿ãƒ³ã§ä¸€æ™‚åœæ­¢ã€â¹ï¸ãƒœã‚¿ãƒ³ã§åœæ­¢</li>\n          <li>BPMã‚’å¤‰æ›´ã—ã¦éŸ³æ¥½ã®é€Ÿã•ã‚’èª¿æ•´</li>\n          <li>ãƒˆãƒ©ãƒƒã‚¯ã‚’è¿½åŠ ã—ã¦è¤‡æ•°ã®éŸ³ã‚’é‡ã­ã‚‹ã“ã¨ãŒã§ãã¾ã™</li>\n          <li><strong>ğŸ’¾ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¿å­˜:</strong> ç·¨é›†ä¸­ã®ãƒ‡ãƒ¼ã‚¿ã‚’JSONãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦ä¿å­˜</li>\n          <li><strong>ğŸ“ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆèª­ã¿è¾¼ã¿:</strong> ä¿å­˜ã—ãŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚“ã§ç·¨é›†ã‚’å†é–‹</li>\n          <li><strong>ğŸ§ éŸ³æºå‡ºåŠ›:</strong> å®Œæˆã—ãŸæ¥½æ›²ã‚’WAVãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦å‡ºåŠ›</li>\n        </ul>\n        <div className=\"mobile-tips\">\n          <h4>ğŸ“± ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³åˆ©ç”¨ã®ã‚³ãƒ„</h4>\n          <ul>\n            <li>éŸ³ç´ æã‚’è»½ãé•·æŠ¼ã—ã™ã‚‹ã¨ãƒ‰ãƒ©ãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰ã«ãªã‚Šã¾ã™</li>\n            <li>ãƒ‰ãƒ©ãƒƒã‚°ä¸­ã¯ç”»é¢ãŒã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã—ãªã„ã‚ˆã†åˆ¶å¾¡ã•ã‚Œã¾ã™</li>\n            <li>é’ããƒã‚¤ãƒ©ã‚¤ãƒˆã•ã‚ŒãŸãƒˆãƒ©ãƒƒã‚¯ã§æŒ‡ã‚’é›¢ã™ã¨éŸ³ç´ æãŒé…ç½®ã•ã‚Œã¾ã™</li>\n            <li>æ¨ªç”»é¢è¡¨ç¤ºã«ã™ã‚‹ã¨ã‚ˆã‚Šä½¿ã„ã‚„ã™ããªã‚Šã¾ã™</li>\n          </ul>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nconst SoundItem = ({ sound, onDragStart }) => {\n  const [isPlaying, setIsPlaying] = useState(false);\n  const [isDragging, setIsDragging] = useState(false);\n  const [touchStart, setTouchStart] = useState(null);\n  const [touchMove, setTouchMove] = useState(null);\n\n  const handleDragStart = (e) => {\n    // audioBlobä»¥å¤–ã®ãƒ‡ãƒ¼ã‚¿ã‚’JSONæ–‡å­—åˆ—ã¨ã—ã¦è¨­å®š\n    const soundDataForTransfer = {\n      ...sound,\n      audioBlob: null // Blobã¯ç›´æ¥ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºã§ããªã„ãŸã‚ä¸€æ™‚çš„ã«nullã«\n    };\n    \n    e.dataTransfer.setData('application/json', JSON.stringify(soundDataForTransfer));\n    e.dataTransfer.effectAllowed = 'copy';\n    \n    // å®Ÿéš›ã®audioBlobã¯åˆ¥é€”ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã§ä¿æŒ\n    window.currentDraggedSoundBlob = sound.audioBlob;\n    \n    // è¦ªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®onDragStarté–¢æ•°ã‚’å‘¼ã³å‡ºã—ï¼ˆéŸ³å£°ã®é•·ã•ã‚’è¨ˆç®—ï¼‰\n    if (onDragStart) {\n      onDragStart(sound);\n    }\n  };\n\n  // ã‚¿ãƒƒãƒã‚¤ãƒ™ãƒ³ãƒˆå¯¾å¿œ\n  const handleTouchStart = (e) => {\n    const touch = e.touches[0];\n    setTouchStart({ x: touch.clientX, y: touch.clientY });\n    setIsDragging(false);\n    \n    // é•·æŠ¼ã—åˆ¤å®šç”¨ã®ã‚¿ã‚¤ãƒãƒ¼\n    setTimeout(() => {\n      if (touchStart && !isDragging) {\n        setIsDragging(true);\n        // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’ä¸€æ™‚çš„ã«ç„¡åŠ¹åŒ–\n        document.body.classList.add('dragging');\n        \n        // è¦ªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®onDragStarté–¢æ•°ã‚’å‘¼ã³å‡ºã—\n        if (onDragStart) {\n          onDragStart(sound);\n        }\n        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã«è¨­å®š\n        window.currentDraggedSoundBlob = sound.audioBlob;\n        window.currentDraggedSound = sound;\n      }\n    }, 200); // 200msé•·æŠ¼ã—ã§é–‹å§‹\n  };\n\n  const handleTouchMove = (e) => {\n    if (!touchStart) return;\n    \n    const touch = e.touches[0];\n    const currentPos = { x: touch.clientX, y: touch.clientY };\n    setTouchMove(currentPos);\n    \n    // ãƒ‰ãƒ©ãƒƒã‚°é–‹å§‹ã®åˆ¤å®šï¼ˆ10pxä»¥ä¸Šç§»å‹•ï¼‰\n    const deltaX = Math.abs(currentPos.x - touchStart.x);\n    const deltaY = Math.abs(currentPos.y - touchStart.y);\n    \n    if (!isDragging && (deltaX > 10 || deltaY > 10)) {\n      setIsDragging(true);\n      // è¦ªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®onDragStarté–¢æ•°ã‚’å‘¼ã³å‡ºã—\n      if (onDragStart) {\n        onDragStart(sound);\n      }\n      // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã«è¨­å®š\n      window.currentDraggedSoundBlob = sound.audioBlob;\n      window.currentDraggedSound = sound;\n    }\n    \n    if (isDragging) {\n      // passiveã‚¤ãƒ™ãƒ³ãƒˆã§ã¯preventDefaultãŒä½¿ãˆãªã„ã®ã§ã€ä»£ã‚ã‚Šã«touchActionã§ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’åˆ¶å¾¡\n      \n      // ãƒ‰ãƒ©ãƒƒã‚°ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã®ä½ç½®ã‚’æ›´æ–°\n      const dragPreview = document.querySelector('.mobile-drag-preview');\n      if (dragPreview) {\n        dragPreview.style.left = `${currentPos.x - 50}px`;\n        dragPreview.style.top = `${currentPos.y - 20}px`;\n      }\n      \n      // ãƒ‰ãƒ­ãƒƒãƒ—ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã®ãƒã‚¤ãƒ©ã‚¤ãƒˆ\n      const elementBelow = document.elementFromPoint(currentPos.x, currentPos.y);\n      const trackElement = elementBelow?.closest('.track');\n      \n      // æ—¢å­˜ã®ãƒã‚¤ãƒ©ã‚¤ãƒˆã‚’å‰Šé™¤\n      document.querySelectorAll('.track').forEach(track => {\n        track.classList.remove('drag-over');\n      });\n      \n      // æ–°ã—ã„ãƒã‚¤ãƒ©ã‚¤ãƒˆã‚’è¿½åŠ \n      if (trackElement) {\n        trackElement.classList.add('drag-over');\n      }\n    }\n  };\n\n  const handleTouchEnd = (e) => {\n    if (isDragging && touchMove) {\n      // ãƒ‰ãƒ­ãƒƒãƒ—å‡¦ç†\n      const elementBelow = document.elementFromPoint(touchMove.x, touchMove.y);\n      const trackElement = elementBelow?.closest('.track');\n      \n      if (trackElement) {\n        const trackId = parseInt(trackElement.dataset.trackId);\n        const rect = trackElement.getBoundingClientRect();\n        const timePosition = touchMove.x - rect.left;\n        \n        // ãƒ‰ãƒ­ãƒƒãƒ—ã‚¤ãƒ™ãƒ³ãƒˆã‚’ç™ºç«\n        const dropEvent = new CustomEvent('mobileDrop', {\n          detail: {\n            trackId,\n            timePosition,\n            sound: sound\n          }\n        });\n        trackElement.dispatchEvent(dropEvent);\n      }\n    }\n    \n    // ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—\n    setTouchStart(null);\n    setTouchMove(null);\n    setIsDragging(false);\n    document.body.classList.remove('dragging');\n    \n    // ãƒã‚¤ãƒ©ã‚¤ãƒˆã‚’å‰Šé™¤\n    document.querySelectorAll('.track').forEach(track => {\n      track.classList.remove('drag-over');\n    });\n    \n    // ãƒ‰ãƒ©ãƒƒã‚°ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’å‰Šé™¤\n    const dragPreview = document.querySelector('.mobile-drag-preview');\n    if (dragPreview) {\n      dragPreview.remove();\n    }\n    \n    // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã‚’ã‚¯ãƒªã‚¢\n    window.currentDraggedSoundBlob = null;\n    window.currentDraggedSound = null;\n  };\n\n  const playSound = () => {\n    if (sound.audioBlob && !isPlaying && !isDragging) {\n      const audio = new Audio();\n      const audioUrl = URL.createObjectURL(sound.audioBlob);\n      audio.src = audioUrl;\n      \n      audio.play()\n        .then(() => {\n          setIsPlaying(true);\n          \n          const handleEnded = () => {\n            setIsPlaying(false);\n            URL.revokeObjectURL(audioUrl); // URLã‚’ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—\n            audio.removeEventListener('ended', handleEnded);\n          };\n          \n          audio.addEventListener('ended', handleEnded);\n        })\n        .catch(error => {\n          console.error('éŸ³å£°å†ç”Ÿã‚¨ãƒ©ãƒ¼:', error);\n          URL.revokeObjectURL(audioUrl); // ã‚¨ãƒ©ãƒ¼æ™‚ã‚‚ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—\n          setIsPlaying(false);\n        });\n    }\n  };\n\n  // ãƒ‰ãƒ©ãƒƒã‚°ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’ä½œæˆ\n  const createDragPreview = useCallback(() => {\n    if (isDragging && touchMove) {\n      let dragPreview = document.querySelector('.mobile-drag-preview');\n      if (!dragPreview) {\n        dragPreview = document.createElement('div');\n        dragPreview.className = 'mobile-drag-preview';\n        dragPreview.textContent = sound.name;\n        dragPreview.style.cssText = `\n          position: fixed;\n          background: rgba(0, 123, 255, 0.8);\n          color: white;\n          padding: 5px 10px;\n          border-radius: 4px;\n          font-size: 12px;\n          pointer-events: none;\n          z-index: 1000;\n          left: ${touchMove.x - 50}px;\n          top: ${touchMove.y - 20}px;\n        `;\n        document.body.appendChild(dragPreview);\n      }\n    }\n  }, [isDragging, touchMove, sound.name]);\n\n  // ãƒ‰ãƒ©ãƒƒã‚°ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã®æ›´æ–°\n  React.useEffect(() => {\n    if (isDragging) {\n      createDragPreview();\n    }\n  }, [isDragging, touchMove, createDragPreview]);\n\n  return (\n    <div\n      className={`sound-item ${isDragging ? 'dragging' : ''}`}\n      draggable=\"true\"\n      onDragStart={handleDragStart}\n      onTouchStart={handleTouchStart}\n      onTouchMove={handleTouchMove}\n      onTouchEnd={handleTouchEnd}\n    >\n      <div className=\"sound-info\">\n        <h4>{sound.name}</h4>\n        <div className=\"sound-tags\">\n          {sound.tags.map((tag, index) => (\n            <span key={index} className=\"sound-tag\">{tag}</span>\n          ))}\n        </div>\n      </div>\n      <div className=\"sound-actions\">\n        <button \n          className=\"play-sound-btn\"\n          onClick={playSound}\n          disabled={isPlaying}\n        >\n          {isPlaying ? 'â¸ï¸' : 'â–¶ï¸'}\n        </button>\n      </div>\n    </div>\n  );\n};\n\nconst TrackHeader = ({ track, onRemove, trackHeight }) => {\n  return (\n    <div className=\"track-header\" style={{ height: trackHeight }}>\n      <div className=\"track-info\">\n        <h4>{track.name}</h4>\n        <div className=\"track-actions\">\n          <button \n            className=\"remove-track-btn\"\n            onClick={() => onRemove(track.id)}\n            title=\"ãƒˆãƒ©ãƒƒã‚¯ã‚’å‰Šé™¤\"\n          >\n            ğŸ—‘ï¸\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nconst Timeline = ({ bpm }) => {\n  const measures = TOTAL_MEASURES; // 16å°ç¯€è¡¨ç¤º\n  const beatsPerMeasure = BEATS_PER_MEASURE; // 4/4æ‹å­\n\n  return (\n    <div className=\"timeline\" style={{ minWidth: TOTAL_MEASURES * MEASURE_WIDTH }}>\n      {Array.from({ length: measures }, (_, measureIndex) => (\n        <div key={measureIndex} className=\"measure\">\n          <div className=\"measure-number\">{measureIndex + 1}</div>\n          <div className=\"beats\">\n            {Array.from({ length: beatsPerMeasure }, (_, beatIndex) => (\n              <div \n                key={beatIndex} \n                className=\"beat\"\n                style={{ width: BEAT_WIDTH }}\n              >\n                <div className=\"beat-main\">\n                  {beatIndex + 1}\n                </div>\n                <div className=\"beat-sub\">\n                  <div className=\"sub-beat-marker\">ãƒ»</div>\n                </div>\n              </div>\n            ))}\n          </div>\n        </div>\n      ))}\n    </div>\n  );\n};\n\nconst Track = ({ track, onDrop, onDragOver, onRemoveClip, onClipDragStart, onDragEnd, trackHeight, bpm }) => {\n  const handleDrop = (e) => {\n    const rect = e.currentTarget.getBoundingClientRect();\n    const timePosition = e.clientX - rect.left;\n    onDrop(e, track.id, timePosition);\n  };\n\n  // ãƒ¢ãƒã‚¤ãƒ«ãƒ‰ãƒ­ãƒƒãƒ—ã‚¤ãƒ™ãƒ³ãƒˆã®å‡¦ç†\n  const handleMobileDrop = useCallback((e) => {\n    const { trackId, timePosition, sound } = e.detail;\n    \n    // æ¨¡æ“¬çš„ãªãƒ‰ãƒ­ãƒƒãƒ—ã‚¤ãƒ™ãƒ³ãƒˆã‚’ä½œæˆ\n    const mockDropEvent = {\n      preventDefault: () => {},\n      dataTransfer: {\n        getData: (type) => {\n          if (type === 'application/json') {\n            return JSON.stringify(sound);\n          }\n          return '';\n        }\n      }\n    };\n    \n    onDrop(mockDropEvent, trackId, timePosition);\n  }, [onDrop]);\n\n  // ãƒ¢ãƒã‚¤ãƒ«ã‚¯ãƒªãƒƒãƒ—ç§»å‹•ã‚¤ãƒ™ãƒ³ãƒˆã®å‡¦ç†\n  const handleMobileClipMove = useCallback((e) => {\n    const { clip, newTrackId, timePosition } = e.detail;\n    \n    // æ¨¡æ“¬çš„ãªãƒ‰ãƒ­ãƒƒãƒ—ã‚¤ãƒ™ãƒ³ãƒˆã‚’ä½œæˆ\n    const mockDropEvent = {\n      preventDefault: () => {},\n      dataTransfer: {\n        getData: (type) => {\n          if (type === 'text/plain') {\n            return `existing-clip-${clip.id}`;\n          }\n          return '';\n        }\n      }\n    };\n    \n    onDrop(mockDropEvent, newTrackId, timePosition);\n  }, [onDrop]);\n\n  React.useEffect(() => {\n    const trackElement = document.querySelector(`[data-track-id=\"${track.id}\"]`);\n    if (trackElement) {\n      trackElement.addEventListener('mobileDrop', handleMobileDrop);\n      trackElement.addEventListener('mobileClipMove', handleMobileClipMove);\n      return () => {\n        trackElement.removeEventListener('mobileDrop', handleMobileDrop);\n        trackElement.removeEventListener('mobileClipMove', handleMobileClipMove);\n      };\n    }\n  }, [track.id, handleMobileDrop, handleMobileClipMove]);\n\n  return (\n    <div \n      className=\"track\"\n      style={{ height: trackHeight }}\n      data-track-id={track.id}\n      onDrop={handleDrop}\n      onDragOver={onDragOver}\n    >\n      <div className=\"track-grid\">\n        {/* è¡¨æ‹ï¼ˆä¸»è¦ãªæ‹ï¼‰ã®å¢ƒç•Œç·šã‚’è¡¨ç¤º */}\n        {Array.from({ length: TOTAL_BEATS }, (_, index) => {\n          const isFirstBeat = index === 0;\n          const isMeasureStart = index % BEATS_PER_MEASURE === 0;\n          const className = `beat-line beat-line-main ${isFirstBeat ? 'first-beat' : ''} ${isMeasureStart ? 'measure-start' : ''}`;\n          return (\n            <div key={`main-${index}`} className={className} style={{ left: index * BEAT_WIDTH }} />\n          );\n        })}\n        {/* è£æ‹ï¼ˆ8åˆ†éŸ³ç¬¦ï¼‰ã®å¢ƒç•Œç·šã‚’è¡¨ç¤º */}\n        {Array.from({ length: TOTAL_BEATS }, (_, index) => (\n          <div key={`sub-${index}`} className=\"beat-line beat-line-sub\" style={{ left: index * BEAT_WIDTH + SUB_BEAT_WIDTH }} />\n        ))}\n      </div>\n      \n      {track.clips.map(clip => (\n        <AudioClip\n          key={clip.id}\n          clip={clip}\n          trackId={track.id}\n          onRemove={() => onRemoveClip(track.id, clip.id)}\n          onDragStart={onClipDragStart}\n          onDragEnd={onDragEnd}\n        />\n      ))}\n    </div>\n  );\n};\n\nconst AudioClip = ({ clip, trackId, onRemove, onDragStart, onDragEnd }) => {\n  const [waveformData, setWaveformData] = React.useState([]);\n  const [isDragging, setIsDragging] = React.useState(false);\n  const [touchStart, setTouchStart] = React.useState(null);\n  const [touchMove, setTouchMove] = React.useState(null);\n\n  React.useEffect(() => {\n    // ç°¡å˜ãªæ³¢å½¢ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆï¼ˆå®Ÿéš›ã®å®Ÿè£…ã§ã¯éŸ³å£°è§£æãŒå¿…è¦ï¼‰\n    const generateWaveform = () => {\n      const points = 20; // æ³¢å½¢ã®ãƒã‚¤ãƒ³ãƒˆæ•°\n      const data = [];\n      for (let i = 0; i < points; i++) {\n        data.push(Math.random() * 0.8 + 0.2); // 0.2-1.0ã®é–“ã®ãƒ©ãƒ³ãƒ€ãƒ å€¤\n      }\n      setWaveformData(data);\n    };\n\n    generateWaveform();\n  }, [clip.soundData]);\n\n  const handleDragStart = (e) => {\n    e.stopPropagation(); // ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ–ãƒªãƒ³ã‚°ã‚’é˜²ã\n    \n    // ãƒ‰ãƒ©ãƒƒã‚°ãƒ‡ãƒ¼ã‚¿ã«æ—¢å­˜ã‚¯ãƒªãƒƒãƒ—ã®æƒ…å ±ã‚’è¨­å®š\n    e.dataTransfer.setData('text/plain', `existing-clip-${clip.id}`);\n    e.dataTransfer.effectAllowed = 'move';\n    \n    // onDragStartã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’å‘¼ã³å‡ºã—\n    onDragStart(clip, trackId);\n  };\n\n  // ã‚¿ãƒƒãƒã‚¤ãƒ™ãƒ³ãƒˆå¯¾å¿œï¼ˆã‚¯ãƒªãƒƒãƒ—ã®ç§»å‹•ï¼‰\n  const handleTouchStart = (e) => {\n    e.stopPropagation();\n    const touch = e.touches[0];\n    setTouchStart({ x: touch.clientX, y: touch.clientY });\n    setIsDragging(false);\n    \n    // ãƒ‰ãƒ©ãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰ã‚’æœ‰åŠ¹åŒ–\n    document.body.classList.add('dragging');\n  };\n\n  const handleTouchMove = (e) => {\n    if (!touchStart) return;\n    \n    const touch = e.touches[0];\n    const currentPos = { x: touch.clientX, y: touch.clientY };\n    setTouchMove(currentPos);\n    \n    // ãƒ‰ãƒ©ãƒƒã‚°é–‹å§‹ã®åˆ¤å®šï¼ˆ5pxä»¥ä¸Šç§»å‹•ï¼‰\n    const deltaX = Math.abs(currentPos.x - touchStart.x);\n    const deltaY = Math.abs(currentPos.y - touchStart.y);\n    \n    if (!isDragging && (deltaX > 5 || deltaY > 5)) {\n      setIsDragging(true);\n      onDragStart(clip, trackId);\n    }\n    \n    if (isDragging) {\n      // passiveã‚¤ãƒ™ãƒ³ãƒˆã§ã¯preventDefaultãŒä½¿ãˆãªã„ã®ã§ã€touchActionã§åˆ¶å¾¡\n      \n      // ãƒ‰ãƒ­ãƒƒãƒ—ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã®ãƒã‚¤ãƒ©ã‚¤ãƒˆ\n      const elementBelow = document.elementFromPoint(currentPos.x, currentPos.y);\n      const trackElement = elementBelow?.closest('.track');\n      \n      // æ—¢å­˜ã®ãƒã‚¤ãƒ©ã‚¤ãƒˆã‚’å‰Šé™¤\n      document.querySelectorAll('.track').forEach(track => {\n        track.classList.remove('drag-over');\n      });\n      \n      // æ–°ã—ã„ãƒã‚¤ãƒ©ã‚¤ãƒˆã‚’è¿½åŠ ï¼ˆè‡ªåˆ†ã®ãƒˆãƒ©ãƒƒã‚¯ä»¥å¤–ã‚‚å«ã‚€ï¼‰\n      if (trackElement) {\n        trackElement.classList.add('drag-over');\n      }\n    }\n  };\n\n  const handleTouchEnd = (e) => {\n    if (isDragging && touchMove) {\n      // ãƒ‰ãƒ­ãƒƒãƒ—å‡¦ç†\n      const elementBelow = document.elementFromPoint(touchMove.x, touchMove.y);\n      const trackElement = elementBelow?.closest('.track');\n      \n      if (trackElement) {\n        const newTrackId = parseInt(trackElement.dataset.trackId);\n        const rect = trackElement.getBoundingClientRect();\n        const timePosition = touchMove.x - rect.left;\n        \n        // æ—¢å­˜ã‚¯ãƒªãƒƒãƒ—ã®ç§»å‹•ã‚¤ãƒ™ãƒ³ãƒˆã‚’ç™ºç«\n        const moveEvent = new CustomEvent('mobileClipMove', {\n          detail: {\n            clip,\n            originalTrackId: trackId,\n            newTrackId,\n            timePosition\n          }\n        });\n        trackElement.dispatchEvent(moveEvent);\n      }\n    }\n    \n    // ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—\n    setTouchStart(null);\n    setTouchMove(null);\n    setIsDragging(false);\n    document.body.classList.remove('dragging');\n    \n    // ãƒã‚¤ãƒ©ã‚¤ãƒˆã‚’å‰Šé™¤\n    document.querySelectorAll('.track').forEach(track => {\n      track.classList.remove('drag-over');\n    });\n    \n    if (onDragEnd) {\n      onDragEnd(null); // nullã‚’æ¸¡ã—ã¦ã‚¬ãƒ¼ãƒ‰æ¡ä»¶ã‚’æº€ãŸã™\n    }\n  };\n\n  return (\n    <div \n      className={`audio-clip ${isDragging ? 'dragging' : ''}`}\n      draggable=\"true\"\n      onDragStart={handleDragStart}\n      onDragEnd={onDragEnd}\n      onTouchStart={handleTouchStart}\n      onTouchMove={handleTouchMove}\n      onTouchEnd={handleTouchEnd}\n      style={{\n        left: clip.startTime,\n        width: isFinite(clip.duration) && clip.duration > 0 ? clip.duration : 400 // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ1å°ç¯€\n      }}\n    >\n      <div className=\"clip-header\">\n        <span className=\"clip-name\">{clip.soundData.name}</span>\n        <button \n          className=\"remove-clip-btn\"\n          onClick={onRemove}\n          title=\"ã‚¯ãƒªãƒƒãƒ—ã‚’å‰Šé™¤\"\n        >\n          Ã—\n        </button>\n      </div>\n      <div className=\"clip-waveform\">\n        {waveformData.length > 0 ? (\n          <svg className=\"waveform-svg\" width=\"100%\" height=\"30\">\n            {waveformData.map((height, index) => (\n              <rect\n                key={index}\n                x={`${(index / waveformData.length) * 100}%`}\n                y={`${(1 - height) * 15}`}\n                width={`${80 / waveformData.length}%`}\n                height={`${height * 30}`}\n                fill=\"rgba(255, 255, 255, 0.8)\"\n              />\n            ))}\n          </svg>\n        ) : (\n          <div className=\"waveform-placeholder\">ğŸ”Š</div>\n        )}\n      </div>\n    </div>\n  );\n};\n\nconst Playhead = ({ currentTime }) => {\n  // currentTimeãŒæœ‰åŠ¹ãªæ•°å€¤ã‹ãƒã‚§ãƒƒã‚¯\n  const safeCurrentTime = isFinite(currentTime) && currentTime >= 0 ? currentTime : 0;\n  \n  return (\n    <div \n      className=\"playhead\"\n      style={{ left: safeCurrentTime }}\n    />\n  );\n};\n\nexport default DAWPage;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}